System.register("chunks:///_virtual/Mafia_AudioManager.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(i){var e,o,t,n,a,u,l,r,s,c,d,p,f,h,b,y;return{setters:[function(i){e=i.applyDecoratedDescriptor,o=i.inheritsLoose,t=i.initializerDefineProperty,n=i.assertThisInitialized,a=i.createClass},function(i){u=i.cclegacy,l=i._decorator,r=i.CCString,s=i.AudioClip,c=i.CCFloat,d=i.CCBoolean,p=i.AudioSource,f=i.Prefab,h=i.sys,b=i.instantiate,y=i.Component}],execute:function(){var g,A,S,C,m,E,v,P,w,I,L,D,M,z,_,k,B,T,x,F,K,R,O;u._RF.push({},"583b9vAPVFLKIWeORwwOp7K","Mafia_AudioManager",void 0);var W=l.ccclass,G=l.property,U=(g=W("MafiaAudioClipData"),A=G({type:r}),S=G({type:s}),C=G({type:c}),m=G({type:c}),E=G({type:d}),g((w=e((P=function(){function i(){t(this,"name",w,this),t(this,"audioClips",I,this),t(this,"delayBetweenClips",L,this),t(this,"volume",D,this),t(this,"loop",M,this),this.isLoopPlaying=void 0,this.lastPlayedTime=0,this.clipIndex=0}var e=i.prototype;return e.GetClip=function(){var i=this.audioClips[this.clipIndex];if(this.clipIndex=(this.clipIndex+1)%this.audioClips.length,this.CanPlay())return this.lastPlayedTime=Date.now(),i},e.CanPlay=function(){return Date.now()-this.lastPlayedTime>1e3*this.delayBetweenClips},i}()).prototype,"name",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I=e(P.prototype,"audioClips",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),L=e(P.prototype,"delayBetweenClips",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),D=e(P.prototype,"volume",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),M=e(P.prototype,"loop",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v=P))||v);i("MafiaAudioManager",(z=W("MafiaAudioManager"),_=G({type:U}),k=G({type:p}),B=G({type:f}),z(((O=function(i){function e(){for(var e,o=arguments.length,a=new Array(o),u=0;u<o;u++)a[u]=arguments[u];return e=i.call.apply(i,[this].concat(a))||this,t(e,"audioClipData",F,n(e)),t(e,"backgroundAudioSource",K,n(e)),e.localStorageAudioEnabledKey="SNLAudioEnabled",t(e,"audioSourcePrefab",R,n(e)),e.audioSources=[],e._isAudioEnabled="true",e}o(e,i);var u=e.prototype;return u.onLoad=function(){e.instance=this,this.ReadAudioEnabledFromLocalStorage()},u.onDestroy=function(){e.instance===this&&(e.instance=null)},u.start=function(){this.SetAudioEnabled(this.IsAudioEnabled)},u.playSound=function(i){if("false"!=this.IsAudioEnabled){var e=this.audioClipData.find((function(e){return e.name==i}));if(null!=e){var o=e.GetClip();if(o){if(e.isLoopPlaying)return;var t=this.getEmptyAudioSource();t.loop=e.loop,e.isLoopPlaying=e.loop,t.volume=e.volume,t.clip=o,e.loop?t.play():t.playOneShot(o)}else console.warn("Audio Clip is in use ",i)}}},u.stopSound=function(i){var e=this.audioClipData.find((function(e){return e.name==i}));e?this.audioSources.forEach((function(i){i.clip==e.audioClips[e.clipIndex]&&(e.isLoopPlaying=!1,i.stop())})):console.warn("Audio Clip not found for ",i)},u.stopAllSounds=function(){this.audioSources.forEach((function(i){i.stop()})),this.audioClipData.forEach((function(i){i.isLoopPlaying=!1}))},u.ToggleAudio=function(){"true"==this.IsAudioEnabled?this.SetAudioEnabled("false"):this.SetAudioEnabled("true")},u.SetAudioEnabled=function(i){this._isAudioEnabled=i,this.UpdateBackgroundMusic(),this.WriteAudioEnabledToLocalStorage()},u.WriteAudioEnabledToLocalStorage=function(){h.localStorage.setItem(this.localStorageAudioEnabledKey,this.IsAudioEnabled)},u.ReadAudioEnabledFromLocalStorage=function(){var i=h.localStorage.getItem(this.localStorageAudioEnabledKey);this._isAudioEnabled=null==i?"true":i},u.UpdateBackgroundMusic=function(){var i,e;"true"==this.IsAudioEnabled?null==(i=this.backgroundAudioSource)||i.play():null==(e=this.backgroundAudioSource)||e.stop()},u.printAllPlayingAudioSources=function(){this.audioSources.forEach((function(i){i.playing&&console.log("Playing audio source: ",i.playing,i.clip.name,i.uuid)}))},u.getEmptyAudioSource=function(){var i=this.audioSources.find((function(i){return!i.playing}));return null==i&&(i=this.createAudioSource()),i},u.createAudioSource=function(){var i=b(this.audioSourcePrefab).getComponent(p);return i.node.setParent(this.node),this.audioSources.push(i),console.log("==== Created new audio source: ",this.audioSources.length),i},a(e,[{key:"IsAudioEnabled",get:function(){return this._isAudioEnabled}}]),e}(y)).instance=null,F=e((x=O).prototype,"audioClipData",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),K=e(x.prototype,"backgroundAudioSource",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=e(x.prototype,"audioSourcePrefab",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=x))||T));u._RF.pop()}}}));

System.register("chunks:///_virtual/Mafia_BasePlayerData.ts",["cc"],(function(i){var s;return{setters:[function(i){s=i.cclegacy}],execute:function(){s._RF.push({},"8b000DlStVJ5rYkCs5GQBAQ","Mafia_BasePlayerData",void 0);i("MafiaBasePlayerData",function(){function i(){this.userId=void 0,this.name=void 0,this.avatar=void 0,this.sessionId=void 0,this.playerNumber=void 0,this.type=void 0,this.isOnline=void 0,this.isConnected=void 0,this.isReplacedByBot=void 0,this.isKickedOut=void 0,this.isReady=void 0,this.score=void 0}return i.prototype.copyFrom=function(i){this.userId=i.userId,this.name=i.name,this.avatar=i.avatar,this.sessionId=i.sessionId,this.playerNumber=i.playerNumber,this.type=i.type,this.isOnline=i.isOnline,this.isConnected=i.isConnected,this.isReplacedByBot=i.isReplacedByBot,this.isKickedOut=i.isKickedOut,this.isReady=i.isReady,this.score=i.score},i}());s._RF.pop()}}}));

System.register("chunks:///_virtual/Mafia_BaseRoomSettings.ts",["cc"],(function(e){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"deb605Z3CxFvIWP3DgiTvl4","Mafia_BaseRoomSettings",void 0);e("DefaultRoomSettings",{maxPlayers:8,minPlayers:2,maxClients:8,countdownTimeInSeconds:3,allowLateJoin:!0,maxReconnectionAttempts:3,reconnectionAttemptInterval:1e3,reconnectionTime:1e4,gameFPS:30,serverFPS:30,patchRate:1e3}),e("MafiaBaseRoomSettings",function(){function e(){this.maxPlayers=void 0,this.minPlayers=void 0,this.maxClients=void 0,this.countdownTimeInSeconds=void 0,this.allowLateJoin=void 0,this.maxReconnectionAttempts=void 0,this.reconnectionAttemptInterval=void 0,this.reconnectionTime=void 0,this.gameFPS=void 0,this.serverFPS=void 0,this.patchRate=void 0}return e.prototype.copyFrom=function(e){this.maxPlayers=e.maxPlayers,this.minPlayers=e.minPlayers,this.maxClients=e.maxClients,this.countdownTimeInSeconds=e.countdownTimeInSeconds,this.allowLateJoin=e.allowLateJoin,this.reconnectionTime=e.reconnectionTime,this.gameFPS=e.gameFPS,this.serverFPS=e.serverFPS,this.patchRate=e.patchRate},e}());t._RF.pop()}}}));

System.register("chunks:///_virtual/Mafia_BaseRoomState.ts",["cc","./Mafia_RoomTypes.ts"],(function(t){var o,s;return{setters:[function(t){o=t.cclegacy},function(t){s=t.MafiaRoomStatus}],execute:function(){o._RF.push({},"127b1osQO9JAak5yTMMaFTV","Mafia_BaseRoomState",void 0);t("MafiaBaseRoomState",function(){function t(t,o){this.currentRoomStatus=s.WAITING_FOR_PLAYERS,this.previousRoomStatus=s.NONE,this.roomSettings=void 0,this.playersData=void 0,this.spectatorsData=void 0,this.roomSettings=t,this.playersData=o,this.spectatorsData=[]}return t.prototype.copyFrom=function(t){this.currentRoomStatus=t.currentRoomStatus,this.previousRoomStatus=t.previousRoomStatus,this.roomSettings.copyFrom(t.roomSettings)},t}());o._RF.pop()}}}));

System.register("chunks:///_virtual/Mafia_CameraManger.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,i,n,r,o,a,s,h,c,d,l,u,g;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,n=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){o=e.cclegacy,a=e._decorator,s=e.UITransform,h=e.Camera,c=e.screen,d=e.sys,l=e.view,u=e.math,g=e.Component}],execute:function(){var f,p,w,m,H,b,A,S,v,z,y,O;o._RF.push({},"150f90QrSRP7bztAHTo8GP7","Mafia_CameraManger",void 0);var R=a.ccclass,C=a.property;(0,a.executionOrder)(-1);e("MafiaCameraManger",(f=R("MafiaCameraManger"),p=C({type:s}),f(((O=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return t=e.call.apply(e,[this].concat(o))||this,n(t,"canvasUITransform",H,r(t)),n(t,"designHeight",b,r(t)),n(t,"designWidth",A,r(t)),n(t,"defaultOrthoHeight",S,r(t)),n(t,"minOrthoHeight",v,r(t)),n(t,"maxOrthoHeight",z,r(t)),n(t,"safeAreaPadding",y,r(t)),t.designAspectRatio=void 0,t.currentAspectRatio=void 0,t.camera=null,t.windowWidth=1080,t.windowHeight=1920,t}i(t,e);var o=t.prototype;return o.onLoad=function(){t.instance=this,this.designAspectRatio=this.designWidth/this.designHeight,this.camera=this.node.getComponent(h)},o.start=function(){var e=this;this.updateScreenSize(),this.adaptCameraToScreen(),window.addEventListener("resize",(function(){e.updateScreenSize(),e.adaptCameraToScreen()}))},o.update=function(e){},o.updateScreenSize=function(){this.windowWidth=c.windowSize.width||window.innerWidth,this.windowHeight=c.windowSize.height||window.innerHeight,this.currentAspectRatio=this.windowWidth/this.windowHeight,console.log("Window Size: "+this.windowWidth+"x"+this.windowHeight+", Aspect Ratio: "+this.currentAspectRatio.toFixed(2))},o.adaptCameraToScreen=function(){if(this.camera){var e=0,t=0,i=0,n=0;if(d.os===d.OS.IOS||d.os===d.OS.ANDROID){var r=l.getVisibleSize(),o=l.getVisibleOrigin();r&&(e=o.y,t=this.windowHeight-(o.y+r.height),i=o.x,n=this.windowWidth-(o.x+r.width))}console.log("safeAreaTop",e),console.log("safeAreaBottom",t),console.log("safeAreaLeft",i),console.log("safeAreaRight",n);var a=this.windowHeight-e-t-2*this.safeAreaPadding,s=this.windowWidth-i-n-2*this.safeAreaPadding,h=s/a;console.log("windowWidth",this.windowWidth),console.log("windowHeight",this.windowHeight),console.log("Effective Size: "+s+"x"+a+", Aspect Ratio: "+h.toFixed(2));var c=this.currentAspectRatio>=1,g=this.defaultOrthoHeight;if(c)console.log("=== Landscape Mode ==="),g=this.defaultOrthoHeight*(1/this.currentAspectRatio)*1.5;else{console.log("=== Portrait Mode ===");var f=.6/Math.min(this.currentAspectRatio,.6);g=this.defaultOrthoHeight*f}g=u.clamp(g,this.minOrthoHeight,this.maxOrthoHeight),this.camera.orthoHeight=g,console.log("Camera Ortho Height: "+g.toFixed(2))}},o.getWidth=function(){return 2*this.camera.orthoHeight*this.currentAspectRatio},o.getCurrentOrthoHeight=function(){return this.camera.orthoHeight},o.refreshCameraAdaptation=function(){this.updateScreenSize(),this.adaptCameraToScreen()},t}(g)).instance=null,H=t((m=O).prototype,"canvasUITransform",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=t(m.prototype,"designHeight",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1920}}),A=t(m.prototype,"designWidth",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1080}}),S=t(m.prototype,"defaultOrthoHeight",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 820}}),v=t(m.prototype,"minOrthoHeight",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 750}}),z=t(m.prototype,"maxOrthoHeight",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1080}}),y=t(m.prototype,"safeAreaPadding",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),w=m))||w));o._RF.pop()}}}));

System.register("chunks:///_virtual/Mafia_CountDownScreen.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Mafia_Menu.ts"],(function(n){var t,e,o,i,c,a,r,u,l,s;return{setters:[function(n){t=n.applyDecoratedDescriptor,e=n.inheritsLoose,o=n.initializerDefineProperty,i=n.assertThisInitialized},function(n){c=n.cclegacy,a=n._decorator,r=n.Label,u=n.tween,l=n.Vec3},function(n){s=n.MafiaMenu}],execute:function(){var d,w,p,f,h;c._RF.push({},"3dc1dnlbAFCt5Kw25yShK3d","Mafia_CountDownScreen",void 0);var y=a.ccclass,T=a.property;n("MafiaCountdownScreen",(d=y("MafiaCountdownScreen"),w=T({type:r}),d((h=t((f=function(n){function t(){for(var t,e=arguments.length,c=new Array(e),a=0;a<e;a++)c[a]=arguments[a];return(t=n.call.apply(n,[this].concat(c))||this)._countdownTween=null,o(t,"countdownText",h,i(t)),t}e(t,n);var c=t.prototype;return c.onLoad=function(){n.prototype.onLoad.call(this)},c.onDestroy=function(){},c.Open=function(){n.prototype.Open.call(this),this.initialization()},c.Close=function(){n.prototype.Close.call(this),null!=this._countdownTween&&this._countdownTween.stop()},c.initCountdownTween=function(){var n=this;this.countdownText.node.active=!0,this._countdownTween=u(this.countdownText.node);for(var t=function(t){n._countdownTween.call((function(){n.countdownText.string=t.toString(),n.countdownText.node.scale=l.ONE.clone().multiplyScalar(2)})).to(.4,{scale:l.ONE.clone().multiplyScalar(1)},{easing:"sineIn"}).delay(.6).start()},e=3;e>=1;e--)t(e);this._countdownTween.call((function(){n.deactivateScreen()}))},c.deactivateScreen=function(){this.countdownText.string="",this.countdownText.node.active=!1},c.initialization=function(){this.initCountdownTween(),this._countdownTween.start()},t}(s)).prototype,"countdownText",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),p=f))||p));c._RF.pop()}}}));

System.register("chunks:///_virtual/Mafia_DiscussionScreen.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Mafia_Menu.ts","./Mafia_Player.ts","./MafiaGameHandler.ts","./Mafia_NetworkManager.ts","./Mafia_NetworkTypes.ts","./Mafia_GameMessageType.ts"],(function(e){var t,i,n,r,o,a,l,s,c,u,d,f,p,h,y,b,g,m,v,C;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,n=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){o=e.cclegacy,a=e._decorator,l=e.Node,s=e.Prefab,c=e.RichText,u=e.Label,d=e.instantiate,f=e.Sprite,p=e.UITransform},function(e){h=e.MafiaMenu},function(e){y=e.MafiaPlayer},function(e){b=e.MafiaGameHandler},function(e){g=e.ServerRoomStateChangeEvent,m=e.MafiaNetworkManager},function(e){v=e.MafiaNetworkEvents},function(e){C=e.MafiaGameMessageType}],execute:function(){var S,R,M,w,A,z,I,L,W,_,T,B,D,P,E,F,N,U,k,O,G;o._RF.push({},"47039CR7v5KoaYOeQVhReMr","Mafia_DiscussionScreen",void 0);var H=a.ccclass,V=a.property;e("MafiaDiscussionScreen",(S=H("MafiaDiscussionScreen"),R=V({type:l,tooltip:"Container for first row of players"}),M=V({type:l,tooltip:"Container for second row of players"}),w=V({type:s,tooltip:"Prefab for player"}),A=V({type:l,tooltip:"Container for role and word display"}),z=V({type:l,tooltip:"Container to resize for role and word"}),I=V({type:c,tooltip:"Label for role and word"}),L=V({type:u,tooltip:"Timer label"}),W=V({type:l,tooltip:"Continue Button"}),_=V({type:l,tooltip:"Info Label"}),S((D=t((B=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return t=e.call.apply(e,[this].concat(o))||this,n(t,"playersFirstRow",D,r(t)),n(t,"playersSecondRow",P,r(t)),n(t,"playerPrefab",E,r(t)),n(t,"roleAndWordContainerBg",F,r(t)),n(t,"roleAndWordContainer",N,r(t)),n(t,"roleAndWordLabel",U,r(t)),n(t,"timerLabel",k,r(t)),n(t,"continueButton",O,r(t)),n(t,"infoLabel",G,r(t)),t.menuName="DiscussionScreen",t.players=[],t.isInitialized=!1,t.timer=0,t.hasMarkedReady=!1,t}i(t,e);var o=t.prototype;return o.onEnable=function(){this.resetUI(),g.on(v.SERVER_ROOM_STATE_CHANGE,this.onServerRoomStateChange,this);var e=b.Instance.getRoomState();e&&this.initializeScreen(e)},o.onDisable=function(){g.off(v.SERVER_ROOM_STATE_CHANGE,this.onServerRoomStateChange,this),this.isInitialized=!1,this.players=[]},o.update=function(e){this.updateTimer(e),this.updateTimerDisplay()},o.onServerRoomStateChange=function(e){var t=b.Instance.getRoomState();t?this.initializeScreen(t):(console.warn("[DiscussionScreen] Processed state not available, falling back to raw state"),this.initializeScreen(e))},o.initializeScreen=function(e){this.isInitialized?this.players.forEach((function(t){return t.onServerRoomStateChange(e)})):(this.initializePlayers(e),this.isInitialized=!0),this.timer=e.discussionTimer,this.updateRoleAndWordUI(e),b.Instance.isLocalUserSpectator()&&this.continueButton&&(this.continueButton.active=!1)},o.initializePlayers=function(e){var t=this;this.playersFirstRow.removeAllChildren(),this.playersSecondRow.removeAllChildren(),this.players=[],[].concat(e.playersData).sort((function(e,t){return e.playerNumber-t.playerNumber})).forEach((function(i,n){var r=d(t.playerPrefab);n<4?t.playersFirstRow.addChild(r):t.playersSecondRow.addChild(r);var o=r.getComponent(y);o?(o.initialize(e,i),t.players.push(o),b.Instance.registerPlayer(o)):console.error("Player prefab missing MafiaPlayer component")}))},o.updateRoleAndWordUI=function(e){var t=this;if(this.roleAndWordContainerBg&&this.roleAndWordLabel){var i=b.Instance.getLocalUserId(),n=i===e.currentSpyUserId,r=this.roleAndWordContainerBg.getComponent(f);if(n)this.roleAndWordLabel.string="YOU ARE THE SPY",r&&(r.color=b.Instance.spyColor);else{var o,a="WAITING",l=null==(o=e.playersData)?void 0:o.find((function(e){return e.userId===i}));if(l)a=l.describingWord;else{var s,c=null==(s=e.playersData)?void 0:s.filter((function(t){return t.userId!==e.currentSpyUserId})),u=null==c?void 0:c.find((function(e){return e.describingWord&&e.describingWord.length>0}));u&&(a=u.describingWord)}this.roleAndWordLabel.string="<color=#FFFFFFB3><size=35>WORD: </size></color><b><size=45>"+a.toUpperCase()+"</size></b>",r&&(r.color=b.Instance.villagersColor)}this.scheduleOnce((function(){if(t.roleAndWordContainer&&t.roleAndWordLabel&&t.roleAndWordContainerBg){var e=t.roleAndWordLabel.node.getComponent(p),i=t.roleAndWordContainer.getComponent(p),n=t.roleAndWordContainerBg.getComponent(p);if(e&&i&&n){var r=e.width+80;r>i.width&&(i.setContentSize(r,i.height),n.setContentSize(r,n.height))}}}),0),this.roleAndWordContainerBg.active=!0}},o.updateTimer=function(e){this.timer=Math.max(0,this.timer-e)},o.updateTimerDisplay=function(){if(this.timerLabel){var e=Math.floor(this.timer),t=e%60,i=Math.floor(e/60)+":"+(t<10?"0"+t:""+t);this.timerLabel.string=i}},o.onContinueClicked=function(){this.hasMarkedReady||b.Instance.isLocalUserSpectator()||(this.hasMarkedReady=!0,this.continueButton&&(this.continueButton.active=!1),this.infoLabel&&(this.infoLabel.active=!0),m.Instance.sendMessage(C.PLAYER_READY_FOR_VOTING,{}),console.log("[MafiaDiscussionScreen] Player Ready for Voting sent"))},o.resetUI=function(){this.hasMarkedReady=!1,this.continueButton&&(this.continueButton.active=!0),this.infoLabel&&(this.infoLabel.active=!1)},t}(h)).prototype,"playersFirstRow",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=t(B.prototype,"playersSecondRow",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=t(B.prototype,"playerPrefab",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=t(B.prototype,"roleAndWordContainerBg",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=t(B.prototype,"roleAndWordContainer",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=t(B.prototype,"roleAndWordLabel",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=t(B.prototype,"timerLabel",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=t(B.prototype,"continueButton",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=t(B.prototype,"infoLabel",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=B))||T));o._RF.pop()}}}));

System.register("chunks:///_virtual/Mafia_EndRoundScreen.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Mafia_Menu.ts","./Mafia_UIManager.ts","./Mafia_AudioManager.ts","./MafiaGameHandler.ts","./Mafia_Player.ts","./Mafia_PlayerAvatar.ts","./MiloGameSDK.ts","./index.ts","./Mafia_GameManager.ts","./events.ts"],(function(t){var e,n,i,a,o,r,l,s,u,c,p,y,S,f,d,I,h,C,b,L,g,v,m,N,_;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.initializerDefineProperty,a=t.assertThisInitialized},function(t){o=t.cclegacy,r=t._decorator,l=t.Sprite,s=t.SpriteFrame,u=t.Label,c=t.Node,p=t.Prefab,y=t.Color,S=t.Layout,f=t.UITransform,d=t.instantiate,I=t.Size},function(t){h=t.MafiaMenu},function(t){C=t.MafiaUIManager},function(t){b=t.MafiaAudioManager},function(t){L=t.MafiaGameHandler},function(t){g=t.MafiaPlayer},function(t){v=t.MafiaPlayerAvatar},function(t){m=t.HostChangeEvent},null,function(t){N=t.MafiaGameManager},function(t){_=t.InternalGameSdkEvents}],execute:function(){var O,P,A,W,T,w,D,M,z,Y,V,H,R,E,U,B,G,F,k,x,K,j,Z,q,J,Q,X,$,tt,et,nt,it,at,ot,rt,lt,st,ut,ct,pt,yt,St,ft,dt,It,ht,Ct,bt,Lt,gt,vt;o._RF.push({},"623bfmdNW1Ds6bkt4iZR28n","Mafia_EndRoundScreen",void 0);var mt=r.ccclass,Nt=r.property,_t="[EndRoundScreen]",Ot=function(t){return t[t.CIVILIAN_WON=0]="CIVILIAN_WON",t[t.CIVILIAN_LOST=1]="CIVILIAN_LOST",t[t.SPY_WON=2]="SPY_WON",t[t.SPY_LOST=3]="SPY_LOST",t}(Ot||{});t("MafiaEndRoundScreen",(O=mt("MafiaEndRoundScreen"),P=Nt({type:l,tooltip:"Header Icon"}),A=Nt({type:s,tooltip:"Icon: Civilian Won"}),W=Nt({type:s,tooltip:"Icon: Civilian Lost"}),T=Nt({type:s,tooltip:"Icon: Spy Won"}),w=Nt({type:s,tooltip:"Icon: Spy Lost"}),D=Nt({type:u,tooltip:"Header Title"}),M=Nt({type:u,tooltip:"Header Description"}),z=Nt({type:l,tooltip:"Result State Background"}),Y=Nt({type:c,tooltip:"Result State Container"}),V=Nt({type:c,tooltip:"Result State Content Container"}),H=Nt({type:l,tooltip:"Result State Icon"}),R=Nt({type:s,tooltip:"Result Icon: Civilian Won"}),E=Nt({type:s,tooltip:"Result Icon: Civilian Lost"}),U=Nt({type:s,tooltip:"Result Icon: Spy Won"}),B=Nt({type:s,tooltip:"Result Icon: Spy Lost"}),G=Nt({type:u,tooltip:"Result State Label"}),F=Nt({type:u,tooltip:"Spy Word Label"}),k=Nt({type:u,tooltip:"Spy Description Label"}),x=Nt({type:u,tooltip:"Civilians State Label"}),K=Nt({type:c,tooltip:"Players Container"}),j=Nt({type:p,tooltip:"Player Avatar Prefab"}),Z=Nt({type:c,tooltip:"Container for host actions"}),q=Nt({type:c,tooltip:"Container for non-host info"}),J=Nt({type:g,tooltip:"Spy Player Node"}),O(($=e((X=function(t){function e(){for(var e,n,o,r,l,s,u,c,p=arguments.length,S=new Array(p),f=0;f<p;f++)S[f]=arguments[f];return c=t.call.apply(t,[this].concat(S))||this,i(c,"headerIcon",$,a(c)),i(c,"iconCivilianWon",tt,a(c)),i(c,"iconCivilianLost",et,a(c)),i(c,"iconSpyWon",nt,a(c)),i(c,"iconSpyLost",it,a(c)),i(c,"headerTitle",at,a(c)),i(c,"headerDescription",ot,a(c)),i(c,"resultStateNodeBg",rt,a(c)),i(c,"resultStateContainer",lt,a(c)),i(c,"resultStateContentContainer",st,a(c)),i(c,"resultStateIcon",ut,a(c)),i(c,"resultIconCivilianWon",ct,a(c)),i(c,"resultIconCivilianLost",pt,a(c)),i(c,"resultIconSpyWon",yt,a(c)),i(c,"resultIconSpyLost",St,a(c)),i(c,"resultStateLabel",ft,a(c)),i(c,"spyWordLabel",dt,a(c)),i(c,"spyDescriptionLabel",It,a(c)),i(c,"civiliansStateLabel",ht,a(c)),i(c,"playersContainer",Ct,a(c)),i(c,"playerAvatarPrefab",bt,a(c)),i(c,"actionsButtonContainer",Lt,a(c)),i(c,"infoContainer",gt,a(c)),i(c,"spyPlayerNode",vt,a(c)),c.playerAvatars=[],c.hasPlayedSound=!1,c.titles=((e={})[Ot.CIVILIAN_WON]="Victory!",e[Ot.CIVILIAN_LOST]="Imposter Escaped",e[Ot.SPY_WON]="Victory!",e[Ot.SPY_LOST]="You Got Caught!",e),c.descriptions=((n={})[Ot.CIVILIAN_WON]="You caught the spy!",n[Ot.CIVILIAN_LOST]="You couldnâ€™t find them in time",n[Ot.SPY_WON]="You escaped!",n[Ot.SPY_LOST]="The civilians found you out",n),c.spyDescriptionTexts=((o={})[Ot.CIVILIAN_WON]="was the spy",o[Ot.CIVILIAN_LOST]="was the imposter all along",o[Ot.SPY_WON]="escaped undetected",o[Ot.SPY_LOST]="were caught as the Imposter",o),c.civiliansStateTexts=((r={})[Ot.CIVILIAN_WON]="YOUR TEAM WON!",r[Ot.CIVILIAN_LOST]="Better luck next time",r[Ot.SPY_WON]="YOU FOOLED THEM ALL!",r[Ot.SPY_LOST]="Civilians Won",r),c.resultStateLabels=((l={})[Ot.CIVILIAN_WON]="BUSTED",l[Ot.CIVILIAN_LOST]="UNDETECTED",l[Ot.SPY_WON]="MASTER OF DISGUISE",l[Ot.SPY_LOST]="GAME OVER",l),c.resultStateColors=((s={})[Ot.CIVILIAN_WON]=new y(239,68,68,255),s[Ot.CIVILIAN_LOST]=new y(239,68,68,255),s[Ot.SPY_WON]=new y(254,189,11,255),s[Ot.SPY_LOST]=new y(19,19,33,255),s),c.resultStateLabelColors=((u={})[Ot.CIVILIAN_WON]=new y(255,255,255,255),u[Ot.CIVILIAN_LOST]=new y(255,255,255,255),u[Ot.SPY_WON]=new y(0,0,0,255),u[Ot.SPY_LOST]=new y(255,255,255,128),u),c}n(e,t);var o=e.prototype;return o.Open=function(){t.prototype.Open.call(this),this.setupScreen()},o.Close=function(){t.prototype.Close.call(this),this.clearPlayers()},o.onDisable=function(){t.prototype.onDisable.call(this),this.hasPlayedSound=!1},o.onLoad=function(){t.prototype.onLoad.call(this),m.on(_.HOST_CHANGED,this.onHostChanged,this)},o.onDestroy=function(){m.off(_.HOST_CHANGED,this.onHostChanged,this)},o.setupScreen=function(){var t=L.Instance,e=t.getRoomState();if(e){var n=e.playersData.find((function(t){return t.userId===e.currentSpyUserId}));if(n){var i=t.getLocalUserId()===e.currentSpyUserId,a=!n.isDead,o=this.getResultState(i,a);this.updateHeader(o),this.updateResultState(o),this.updateSpyWord(n.describingWord),this.updateSpyDescriptionLabel(o),this.updateCiviliansState(o),this.updatePlayersDisplay(e),this.spyPlayerNode&&this.spyPlayerNode.initialize(e,n),this.updateHostUI(),this.hasPlayedSound||(i===a&&C.instance&&C.instance.showConfetti(),i===a?b.instance&&b.instance.playSound("Win"):b.instance&&b.instance.playSound("Lose"),this.hasPlayedSound=!0)}else console.error(_t+" Cannot find spy player with ID: "+e.currentSpyUserId)}else console.error(_t+" Cannot setup screen: Room state is null")},o.getResultState=function(t,e){return t?e?Ot.SPY_WON:Ot.SPY_LOST:e?Ot.CIVILIAN_LOST:Ot.CIVILIAN_WON},o.updateHeader=function(t){var e,n=((e={})[Ot.CIVILIAN_WON]=this.iconCivilianWon,e[Ot.CIVILIAN_LOST]=this.iconCivilianLost,e[Ot.SPY_WON]=this.iconSpyWon,e[Ot.SPY_LOST]=this.iconSpyLost,e);if(this.headerIcon&&n[t]&&(this.headerIcon.spriteFrame=n[t]),this.headerTitle){this.headerTitle.string=this.titles[t];var i=t===Ot.CIVILIAN_LOST||t===Ot.SPY_LOST;this.headerTitle.enableOutline=!i}this.headerDescription&&(this.headerDescription.string=this.descriptions[t])},o.updateResultState=function(t){var e=this;if(this.resultStateNodeBg&&(this.resultStateNodeBg.color=this.resultStateColors[t]),this.resultStateIcon){var n,i=((n={})[Ot.CIVILIAN_WON]=this.resultIconCivilianWon,n[Ot.CIVILIAN_LOST]=this.resultIconCivilianLost,n[Ot.SPY_WON]=this.resultIconSpyWon,n[Ot.SPY_LOST]=this.resultIconSpyLost,n)[t];i?(this.resultStateIcon.spriteFrame=i,this.resultStateIcon.node.active=!0):this.resultStateIcon.node.active=!1}this.resultStateLabel&&(this.resultStateLabel.string=this.resultStateLabels[t],this.resultStateLabel.color=this.resultStateLabelColors[t]),this.scheduleOnce((function(){if(e.resultStateContentContainer&&e.resultStateContainer&&e.resultStateNodeBg){var t=e.resultStateContentContainer.getComponent(S);t&&t.updateLayout();var n=e.resultStateContentContainer.getComponent(f),i=e.resultStateContainer.getComponent(f),a=e.resultStateNodeBg.getComponent(f);if(n&&i&&a){var o=n.width+30;o>i.width&&(i.setContentSize(o,i.height),a.setContentSize(o,a.height))}}}),0)},o.updateSpyWord=function(t){this.spyWordLabel&&(this.spyWordLabel.string=(t||"N/A").toUpperCase())},o.updateSpyDescriptionLabel=function(t){this.spyDescriptionLabel&&(this.spyDescriptionLabel.string=this.spyDescriptionTexts[t])},o.updateCiviliansState=function(t){this.civiliansStateLabel&&(this.civiliansStateLabel.string=this.civiliansStateTexts[t])},o.updatePlayersDisplay=function(t){var e=this;this.clearPlayers(),t.playersData.filter((function(e){return e.userId!==t.currentSpyUserId})).forEach((function(t){e.createPlayerAvatar(t)}))},o.createPlayerAvatar=function(t){if(this.playerAvatarPrefab&&this.playersContainer){var e=L.Instance.getPlayer(t.userId),n=d(this.playerAvatarPrefab),i=n.getComponent(v);if(!i)return console.error(_t+" Player avatar prefab missing MafiaPlayerAvatar component"),void n.destroy();var a=n.getComponent(f);a&&a.setContentSize(new I(80,80)),i.initialize(!1,t.userId),e&&e.playerAvatar&&e.playerAvatar.playerAvatar?i.setAvatarFromSpriteFrame(e.playerAvatar.playerAvatar.spriteFrame):t.avatar&&i.setAvatarFromUrl(t.avatar),this.playersContainer.addChild(n),this.playerAvatars.push(i),console.log(_t+" Added civilian avatar for "+t.userId)}},o.clearPlayers=function(){this.playersContainer&&this.playersContainer.removeAllChildren(),this.playerAvatars=[]},o.updateHostUI=function(){if(this.actionsButtonContainer&&this.infoContainer){var t=L.Instance,e=t.isLocalUserHost(),n=t.getHostPlayer();if(e)this.infoContainer.active=!1,this.actionsButtonContainer.active=!0;else if(this.actionsButtonContainer.active=!1,n){var i=this.infoContainer.getComponent(u);if(i){var a=t.getDisplayName(n.userId);i.string="Ask "+a+" (Host) to play again or change game"}this.infoContainer.active=!0}else this.infoContainer.active=!1}},o.onHostChanged=function(t){console.log(_t+" Host changed from "+t.oldHostId+" to "+t.newHostId),this.node.active&&this.updateHostUI()},o.onPlayAgainButtonClicked=function(){console.log(_t+" Play again button clicked");var t=Date.now();N.Instance&&N.Instance.miloSDK?N.Instance.miloSDK.playAgain({timestamp:t}):console.error(_t+" Cannot play again: MiloSDK not found")},o.onChangeGameButtonClicked=function(){console.log(_t+" Change game button clicked");var t=Date.now();N.Instance&&N.Instance.miloSDK?N.Instance.miloSDK.changeGame({timestamp:t}):console.error(_t+" Cannot change game: MiloSDK not found")},e}(h)).prototype,"headerIcon",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tt=e(X.prototype,"iconCivilianWon",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),et=e(X.prototype,"iconCivilianLost",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),nt=e(X.prototype,"iconSpyWon",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),it=e(X.prototype,"iconSpyLost",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),at=e(X.prototype,"headerTitle",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ot=e(X.prototype,"headerDescription",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rt=e(X.prototype,"resultStateNodeBg",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),lt=e(X.prototype,"resultStateContainer",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),st=e(X.prototype,"resultStateContentContainer",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ut=e(X.prototype,"resultStateIcon",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ct=e(X.prototype,"resultIconCivilianWon",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pt=e(X.prototype,"resultIconCivilianLost",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),yt=e(X.prototype,"resultIconSpyWon",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),St=e(X.prototype,"resultIconSpyLost",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ft=e(X.prototype,"resultStateLabel",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),dt=e(X.prototype,"spyWordLabel",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),It=e(X.prototype,"spyDescriptionLabel",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ht=e(X.prototype,"civiliansStateLabel",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ct=e(X.prototype,"playersContainer",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bt=e(X.prototype,"playerAvatarPrefab",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Lt=e(X.prototype,"actionsButtonContainer",[Z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),gt=e(X.prototype,"infoContainer",[q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),vt=e(X.prototype,"spyPlayerNode",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q=X))||Q));o._RF.pop()}}}));

System.register("chunks:///_virtual/Mafia_FitToScreen.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Mafia_CameraManger.ts"],(function(e){var t,i,n,r,o,a,s,c,d,u,h,l,p,f;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,n=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){o=e.cclegacy,a=e._decorator,s=e.CCBoolean,c=e.director,d=e.Director,u=e.UITransform,h=e.screen,l=e.Widget,p=e.Component},function(e){f=e.MafiaCameraManger}],execute:function(){var g,w,y,v,T;o._RF.push({},"57e95MMlQtJ1o1ktV5cFv8p","Mafia_FitToScreen",void 0);var S=a.ccclass,m=a.property;e("MafiaFitToScreen",(g=S("MafiaFitToScreen"),w=m({type:s}),g((T=t((v=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return t=e.call.apply(e,[this].concat(o))||this,n(t,"updateWidgetsRecursively",T,r(t)),t}i(t,e);var o=t.prototype;return o.onEnable=function(){var e=this;c.once(d.EVENT_AFTER_UPDATE,(function(){e.refresh()}))},o.setUiTransformToScreenSize=function(){var e=this.node.getComponent(u),t=f.instance.getCurrentOrthoHeight()/f.instance.defaultOrthoHeight,i=h.windowSize.width||window.innerWidth,n=h.windowSize.height||window.innerHeight,r=f.instance.designHeight*t,o=r*i/n;console.log("windowWidth",i,"windowHeight",n),e.setContentSize(o,r)},o.refresh=function(){this.setUiTransformToScreenSize(),this.updateWidgetsRecursively&&this.updateWidgetsInHierarchy()},o.updateWidgetsInHierarchy=function(){this.updateWidgetAndDescendants(this.node)},o.updateWidgetAndDescendants=function(e){var t=this,i=e.getComponent(l);i&&this.node.uuid!=e.uuid&&i.updateAlignment(),e.children.forEach((function(e){t.updateWidgetAndDescendants(e)}))},t}(p)).prototype,"updateWidgetsRecursively",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y=v))||y));o._RF.pop()}}}));

System.register("chunks:///_virtual/mafia_game",["./Mafia_NetworkConfig.ts","./Mafia_NetworkManager.ts","./Mafia_CameraManger.ts","./Mafia_FitToScreen.ts","./Mafia_MiloLayout.ts","./Mafia_PBLogger.ts","./Mafia_PbExtensions.ts","./Mafia_PbSaveSystem.ts","./Mafia_Utils.ts","./Mafia_BasePlayerData.ts","./Mafia_BaseRoomSettings.ts","./Mafia_BaseRoomState.ts","./Mafia_NetworkTypes.ts","./Mafia_PlayerTypes.ts","./Mafia_RoomTypes.ts","./MafiaGameHandler.ts","./Mafia_AudioManager.ts","./Mafia_Player.ts","./Mafia_PlayerAvatar.ts","./Mafia_GameManager.ts","./Mafia_RoomState.ts","./Mafia_GameMessageType.ts","./Mafia_GameState.ts","./Mafia_CountDownScreen.ts","./Mafia_DiscussionScreen.ts","./Mafia_EndRoundScreen.ts","./Mafia_Menu.ts","./Mafia_PreparationScreen.ts","./Mafia_StartRoundScreen.ts","./Mafia_UIManager.ts","./Mafia_VotingScreen.ts","./Mafia_WaitingScreen.ts","./Mafia_WordDescriptionScreen.ts","./RoundedMask.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/Mafia_GameManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Mafia_RoomState.ts","./MiloGameSDK.ts","./Mafia_RoomTypes.ts","./Mafia_NetworkManager.ts","./Mafia_NetworkTypes.ts"],(function(e){var t,a,n,o,s,i,r,c,m,u,h,l,S,g;return{setters:[function(e){t=e.inheritsLoose,a=e.createClass},function(e){n=e.cclegacy,o=e._decorator,s=e.EventTarget,i=e.Component},function(e){r=e.MafiaRoomState},function(e){c=e.MiloGameSDK},function(e){m=e.MafiaRoomStatus},function(e){u=e.ConnectionStateChangeEvent,h=e.ServerRoomStateChangeEvent,l=e.MafiaNetworkManager},function(e){S=e.MafiaNetworkEvents,g=e.MafiaConnectionState}],execute:function(){var f,_;n._RF.push({},"20a0fJJBhpNX7tW3UyzQ2UF","Mafia_GameManager",void 0);var d=o.ccclass,C=o.executionOrder,v=e("RoomStatusChangeEvent",new s);e("MafiaGameManager",d("MafiaGameManager")(f=C(-2)(((_=function(e){function n(){for(var t,a=arguments.length,n=new Array(a),o=0;o<a;o++)n[o]=arguments[o];return(t=e.call.apply(e,[this].concat(n))||this)._roomStatus=m.NONE,t._won=!1,t._handledGameOverCallbacks=!1,t._serverStateCopy=null,t.miloSDK=new c,t.gameStartTime=0,t}t(n,e);var o=n.prototype;return o.onLoad=function(){n._instance&&this.node.destroy(),n._instance=this,this.miloSDK.init({gameId:"mafia-game",debug:!0}),this.sendGameLoaded(),this.registerEvents()},o.onDestroy=function(){this.cleanup()},o.cleanup=function(){this.unregisterEvents(),n._instance===this&&(n._instance=null)},o.sendGameLoaded=function(){var e={timestamp:Date.now()};this.miloSDK.gameLoaded(e)},o.sendGameStarted=function(){this.gameStartTime=Date.now();var e={timestamp:this.gameStartTime};this.miloSDK.gameStarted(e)},o.sendGameEnded=function(){var e=this,t=Date.now(),a={duration:this.gameStartTime>0?t-this.gameStartTime:0,hasWinningScreen:!0};setTimeout((function(){e.miloSDK.gameEnded(a)}),2e3)},o.registerEvents=function(){u.on(S.CONNECTION_STATE_CHANGE,this.onConnectionStateChange,this),h.on(S.SERVER_ROOM_STATE_CHANGE,this.onServerRoomStateChange,this)},o.unregisterEvents=function(){u.off(S.CONNECTION_STATE_CHANGE,this.onConnectionStateChange,this),h.off(S.SERVER_ROOM_STATE_CHANGE,this.onServerRoomStateChange,this)},o.onConnectionStateChange=function(e,t){switch(t){case g.DISCONNECTED:this._roomStatus!==m.END_GAME&&l.Instance.reconnect();break;case g.KICKED_OUT:}},o.onServerRoomStateChange=function(e){this.log("ServerRoomStateChange Message: "+e.currentRoomStatus),this.log(!this._serverStateCopy),this._serverStateCopy||(this._serverStateCopy=new r,this._serverStateCopy.copyFrom(e)),e.currentRoomStatus===m.END_GAME&&(console.log("Game Over"),this.handleWon(e)),this.log("Setting room status to: ",e.currentRoomStatus),this.setRoomStatus(e.currentRoomStatus)},o.resetServerState=function(e){this._serverStateCopy||(this._serverStateCopy=new r),this._serverStateCopy.copyFrom(e)},o.handleWon=function(e){},o.setRoomStatus=function(e){if(this._roomStatus!==e){console.log("[GameManager] ==== Room Status Change ==== :",e);var t=this._roomStatus;this._roomStatus=e,this.OnRemoteGameStateChange(e),console.log("[GameManager] Emitting room status change event"),v.emit(S.ROOM_STATUS_CHANGE,t,e)}},o.GetMyPlayerData=function(){var e,t=l.Instance.CurrentRoom.sessionId;return null==(e=this._serverStateCopy)?void 0:e.playersData.find((function(e){return e.sessionId===t}))},o.GetWinnerPlayerData=function(){return null},o.OnRemoteGameStateChange=function(e){switch(console.log("RemoteGameStateChange Message: "+e),e){case m.NONE:case m.WAITING_FOR_PLAYERS:case m.COUNTDOWN:break;case m.GAME_SIMULATION:this.sendGameStarted();break;case m.END_GAME:this.sendGameEnded(),this.HandleGameOverCallbacks();break;default:console.warn("Unhandled room status: "+e)}},o.HandleGameOverCallbacks=function(){this._handledGameOverCallbacks?console.log("Already handled game over callbacks"):this._handledGameOverCallbacks=!0},a(n,null,[{key:"Instance",get:function(){return this._instance}}]),n}(i))._instance=null,f=_))||f)||f);n._RF.pop()}}}));

System.register("chunks:///_virtual/Mafia_GameMessageType.ts",["cc"],(function(e){var _;return{setters:[function(e){_=e.cclegacy}],execute:function(){_._RF.push({},"fdf73+b1OpLfpEGWvKuAZY9","Mafia_GameMessageType",void 0);e("MafiaGameMessageType",function(e){return e.NONE="none",e.SET_STATE="set_state",e.PLAYER_SELECT_CATEGORY="player_select_category",e.PLAYER_DONE_DESCRIBING="player_done_describing",e.PLAYER_VOTE="player_vote",e.PLAYER_READY_FOR_VOTING="player_ready_for_voting",e}({}));_._RF.pop()}}}));

System.register("chunks:///_virtual/Mafia_GameState.ts",["cc"],(function(R){var O;return{setters:[function(R){O=R.cclegacy}],execute:function(){O._RF.push({},"f3fd4TufRZHtKazYC085JyL","Mafia_GameState",void 0);R("MafiaGameState",function(R){return R[R.NONE=0]="NONE",R[R.WAITING_FOR_PLAYERS=1]="WAITING_FOR_PLAYERS",R[R.START_ROUND=2]="START_ROUND",R[R.CATEGORY_SELECTION=3]="CATEGORY_SELECTION",R[R.PREPARATION=4]="PREPARATION",R[R.WORD_DESCRIPTION=5]="WORD_DESCRIPTION",R[R.VOTING=6]="VOTING",R[R.VOTING_RESULTS=7]="VOTING_RESULTS",R[R.END_ROUND=8]="END_ROUND",R[R.GAME_OVER=9]="GAME_OVER",R[R.DISCUSSION=10]="DISCUSSION",R}({}));O._RF.pop()}}}));

System.register("chunks:///_virtual/Mafia_Menu.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Mafia_PBLogger.ts"],(function(e){var n,t,i,o,a,r,c,l,u,s;return{setters:[function(e){n=e.applyDecoratedDescriptor,t=e.inheritsLoose,i=e.initializerDefineProperty,o=e.assertThisInitialized},function(e){a=e.cclegacy,r=e._decorator,c=e.Node,l=e.CCString,u=e.Component},function(e){s=e.MafiaPBLogger}],execute:function(){var p,f,h,d,y,g,M;a._RF.push({},"8c5d0A4WHpGsL9G+FTlKBPq","Mafia_Menu",void 0);var m=r.ccclass,v=r.property;e("MafiaMenu",(p=m("MafiaMenu"),f=v({type:c}),h=v({type:l}),p((g=n((y=function(e){function n(){for(var n,t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return n=e.call.apply(e,[this].concat(a))||this,i(n,"content",g,o(n)),i(n,"menuName",M,o(n)),n.isOpened=!1,n}t(n,e);var a=n.prototype;return a.onLoad=function(){null==this.content&&(this.content=this.node.getChildByName("Content"))},a.Open=function(){this.content.active=!0,this.isOpened=!0},a.Close=function(){this.content.active=!1,this.isOpened=!1},a.initialize=function(){s.info("Menu initialize called")},n}(u)).prototype,"content",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=n(y.prototype,"menuName",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d=y))||d));a._RF.pop()}}}));

System.register("chunks:///_virtual/Mafia_MiloLayout.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,n,a,o,s,c,r,h,T,u,p,_;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,a=t.assertThisInitialized,o=t.createClass},function(t){s=t.cclegacy,c=t._decorator,r=t.Enum,h=t.Size,T=t.Node,u=t.Vec3,p=t.UITransform,_=t.Component}],execute:function(){var l,d,E,g,y,f,O,C,R,L,m,v,N,I,H;s._RF.push({},"e36ff/Ql1lCXIUDONHBv7XU","Mafia_MiloLayout",void 0);var b=c.ccclass,M=c.property,A=t("MiloLayoutType",function(t){return t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL",t[t.GRID=2]="GRID",t}({})),w=t("MiloLayoutAlign",function(t){return t[t.LEFT_TOP=0]="LEFT_TOP",t[t.CENTER_TOP=1]="CENTER_TOP",t[t.RIGHT_TOP=2]="RIGHT_TOP",t[t.LEFT_CENTER=3]="LEFT_CENTER",t[t.CENTER=4]="CENTER",t[t.RIGHT_CENTER=5]="RIGHT_CENTER",t[t.LEFT_BOTTOM=6]="LEFT_BOTTOM",t[t.CENTER_BOTTOM=7]="CENTER_BOTTOM",t[t.RIGHT_BOTTOM=8]="RIGHT_BOTTOM",t}({}));t("MafiaMiloLayout",(l=b("MafiaMiloLayout"),d=M({type:r(A)}),E=M({type:r(A)}),g=M({type:r(w)}),y=M({type:r(w)}),f=M({visible:function(){return this._layoutType===A.GRID}}),l((R=e((C=function(t){function e(){for(var e,i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return e=t.call.apply(t,[this].concat(o))||this,n(e,"_layoutType",R,a(e)),n(e,"_alignment",L,a(e)),n(e,"_spacingX",m,a(e)),n(e,"_spacingY",v,a(e)),n(e,"_columns",N,a(e)),n(e,"_padding",I,a(e)),n(e,"_autoResize",H,a(e)),e._activeChildCount=0,e._layoutSize=new h(0,0),e._lastChildActiveState=[],e}i(e,t);var s=e.prototype;return s.onLoad=function(){this.node.on(T.EventType.CHILD_ADDED,this.onChildAdded,this),this.node.on(T.EventType.CHILD_REMOVED,this.onChildRemoved,this)},s.onDestroy=function(){this.node.off(T.EventType.CHILD_ADDED,this.onChildAdded,this),this.node.off(T.EventType.CHILD_REMOVED,this.onChildRemoved,this),this.removeAllChildListeners()},s.onChildRemoved=function(t){this.removeChildListener(t),this.updateLayout()},s.removeAllChildListeners=function(){var t=this;this.node.children.forEach((function(e){t.removeChildListener(e)}))},s.removeChildListener=function(t){t.__miloLayoutActiveHandler&&(t.off(T.EventType.ACTIVE_IN_HIERARCHY_CHANGED,t.__miloLayoutActiveHandler),t.__miloLayoutActiveHandler=null)},s.start=function(){this._lastChildActiveState=this.node.children.map((function(t){return t.active})),this.updateLayout(),this.addChildActiveListeners()},s.addChildActiveListeners=function(){var t=this;this.node.children.forEach((function(e){t.addChildActiveListener(e)}))},s.addChildActiveListener=function(t){var e=this;t.off(T.EventType.ACTIVE_IN_HIERARCHY_CHANGED,this.onChildActiveChanged,this);var i=function(){e.scheduleOnce((function(){e.updateLayout()}),0)};t.__miloLayoutActiveHandler=i,t.on(T.EventType.ACTIVE_IN_HIERARCHY_CHANGED,i)},s.onChildActiveChanged=function(t){},s.onEnable=function(){this.updateLayout()},s.getAlignmentOffset=function(t){var e,i=new u,n=(null==(e=this.node.getComponent(p))?void 0:e.contentSize)||new h(0,0);switch(console.log("getAlignmentOffset",t,n),this._alignment){case w.LEFT_TOP:case w.LEFT_CENTER:case w.LEFT_BOTTOM:i.x=this._padding;break;case w.CENTER_TOP:case w.CENTER:case w.CENTER_BOTTOM:i.x=(n.width-t.width)/2;break;case w.RIGHT_TOP:case w.RIGHT_CENTER:case w.RIGHT_BOTTOM:i.x=n.width-t.width-this._padding}switch(this._alignment){case w.LEFT_TOP:case w.CENTER_TOP:case w.RIGHT_TOP:i.y=-this._padding;break;case w.LEFT_CENTER:case w.CENTER:case w.RIGHT_CENTER:i.y=-(n.height-t.height)/2;break;case w.LEFT_BOTTOM:case w.CENTER_BOTTOM:case w.RIGHT_BOTTOM:i.y=-n.height+t.height+this._padding}return i},s.updateLayout=function(){if(this.node){var t=this.node.children.filter((function(t){return t.active}));if(this._activeChildCount=t.length,0!==this._activeChildCount)switch(this._layoutType){case A.HORIZONTAL:this.updateHorizontalLayout(t);break;case A.VERTICAL:this.updateVerticalLayout(t);break;case A.GRID:this.updateGridLayout(t)}}},s.updateHorizontalLayout=function(t){var e=this,i=2*this._padding,n=0;t.forEach((function(a,o){var s=a.getComponent(p);s&&(i+=s.width,o<t.length-1&&(i+=e._spacingX),n=Math.max(n,s.height))}));var a=new h(i,n+2*this._padding),o=this.getAlignmentOffset(a),s=o.x;if(t.forEach((function(t){var i=t.getComponent(p);if(i){var a=i.height,c=i.width,r=o.y;switch(e._alignment){case w.LEFT_TOP:case w.CENTER_TOP:case w.RIGHT_TOP:r=o.y-e._padding;break;case w.LEFT_CENTER:case w.CENTER:case w.RIGHT_CENTER:r=o.y-(n-a)/2;break;case w.LEFT_BOTTOM:case w.CENTER_BOTTOM:case w.RIGHT_BOTTOM:r=o.y-n+a}t.position=new u(s+c/2,r-a/2,0),s+=c+e._spacingX}})),this._layoutSize=a,this._autoResize){var c=this.node.getComponent(p);c&&c.setContentSize(a)}},s.updateVerticalLayout=function(t){var e=this,i=2*this._padding,n=0;t.forEach((function(a,o){var s=a.getComponent(p);s&&(i+=s.height,o<t.length-1&&(i+=e._spacingY),n=Math.max(n,s.width))}));var a=new h(n+2*this._padding,i),o=this.getAlignmentOffset(a),s=o.y;if(t.forEach((function(t){var i=t.getComponent(p);if(i){var a=i.height,c=i.width,r=o.x;switch(e._alignment){case w.LEFT_TOP:case w.LEFT_CENTER:case w.LEFT_BOTTOM:r=o.x+e._padding;break;case w.CENTER_TOP:case w.CENTER:case w.CENTER_BOTTOM:r=o.x+(n-c)/2+e._padding;break;case w.RIGHT_TOP:case w.RIGHT_CENTER:case w.RIGHT_BOTTOM:r=o.x+n-c+e._padding}t.position=new u(r+c/2,s-a/2,0),s-=a+e._spacingY}})),this._layoutSize=a,this._autoResize){var c=this.node.getComponent(p);c&&c.setContentSize(a)}},s.updateGridLayout=function(t){if(!(this._columns<=0)){var e=Math.ceil(t.length/this._columns),i=0,n=0;t.forEach((function(t){var e=t.getComponent(p);e&&(i=Math.max(i,e.width),n=Math.max(n,e.height))}));var a=2*this._padding+i*this._columns+this._spacingX*(this._columns-1),o=2*this._padding+n*e+this._spacingY*(e-1),s=new h(a,o),c=this.getAlignmentOffset(s);console.log("[MiloLayout] Total size: ",s),console.log("[MiloLayout] Start pos: ",c);for(var r=0;r<e;r++){var T=Math.min(this._columns,t.length-r*this._columns),_=T*i+(T-1)*this._spacingX,l=0;switch(this._alignment){case w.CENTER_TOP:case w.CENTER:case w.CENTER_BOTTOM:l=(this._columns*i+(this._columns-1)*this._spacingX-_)/2;break;case w.RIGHT_TOP:case w.RIGHT_CENTER:case w.RIGHT_BOTTOM:l=this._columns*i+(this._columns-1)*this._spacingX-_}for(var d=0;d<T;d++){var E=r*this._columns+d;if(E>=t.length)break;var g=t[E],y=g.getComponent(p);if(y){var f=y.width,O=y.height,C=c.x+this._padding+d*(i+this._spacingX)+l,R=c.y-this._padding-r*(n+this._spacingY),L=C,m=R;switch(this._alignment){case w.LEFT_TOP:case w.LEFT_CENTER:case w.LEFT_BOTTOM:L=C;break;case w.CENTER_TOP:case w.CENTER:case w.CENTER_BOTTOM:L=C+(i-f)/2;break;case w.RIGHT_TOP:case w.RIGHT_CENTER:case w.RIGHT_BOTTOM:L=C+i-f}switch(this._alignment){case w.LEFT_TOP:case w.CENTER_TOP:case w.RIGHT_TOP:m=R;break;case w.LEFT_CENTER:case w.CENTER:case w.RIGHT_CENTER:m=R-(n-O)/2;break;case w.LEFT_BOTTOM:case w.CENTER_BOTTOM:case w.RIGHT_BOTTOM:m=R-n+O}g.position=new u(L+f/2,m-O/2,0)}}}if(this._layoutSize=s,this._autoResize){var v=this.node.getComponent(p);v&&v.setContentSize(s)}}},s.update=function(t){if(this.node&&this.node.children.length>0){var e=this.node.children.map((function(t){return t.active})),i=!1;if(this._lastChildActiveState.length!==e.length)i=!0;else for(var n=0;n<e.length;n++)if(this._lastChildActiveState[n]!==e[n]){i=!0;break}i&&(this._lastChildActiveState=e,this.updateLayout())}},s.onChildAdded=function(t){this.addChildActiveListener(t),this.updateLayout()},o(e,[{key:"layoutType",get:function(){return this._layoutType},set:function(t){this._layoutType=t,this.updateLayout()}},{key:"alignment",get:function(){return this._alignment},set:function(t){this._alignment=t,this.updateLayout()}},{key:"spacingX",get:function(){return this._spacingX},set:function(t){this._spacingX=t,this.updateLayout()}},{key:"spacingY",get:function(){return this._spacingY},set:function(t){this._spacingY=t,this.updateLayout()}},{key:"columns",get:function(){return this._columns},set:function(t){this._columns=t,this.updateLayout()}},{key:"padding",get:function(){return this._padding},set:function(t){this._padding=t,this.updateLayout()}},{key:"autoResize",get:function(){return this._autoResize},set:function(t){this._autoResize=t,this.updateLayout()}}]),e}(_)).prototype,"_layoutType",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return A.HORIZONTAL}}),e(C.prototype,"layoutType",[E],Object.getOwnPropertyDescriptor(C.prototype,"layoutType"),C.prototype),L=e(C.prototype,"_alignment",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return w.LEFT_TOP}}),e(C.prototype,"alignment",[y],Object.getOwnPropertyDescriptor(C.prototype,"alignment"),C.prototype),m=e(C.prototype,"_spacingX",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),e(C.prototype,"spacingX",[M],Object.getOwnPropertyDescriptor(C.prototype,"spacingX"),C.prototype),v=e(C.prototype,"_spacingY",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),e(C.prototype,"spacingY",[M],Object.getOwnPropertyDescriptor(C.prototype,"spacingY"),C.prototype),N=e(C.prototype,"_columns",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 3}}),e(C.prototype,"columns",[f],Object.getOwnPropertyDescriptor(C.prototype,"columns"),C.prototype),I=e(C.prototype,"_padding",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),e(C.prototype,"padding",[M],Object.getOwnPropertyDescriptor(C.prototype,"padding"),C.prototype),H=e(C.prototype,"_autoResize",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),e(C.prototype,"autoResize",[M],Object.getOwnPropertyDescriptor(C.prototype,"autoResize"),C.prototype),O=C))||O));s._RF.pop()}}}));

System.register("chunks:///_virtual/Mafia_NetworkConfig.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Mafia_PBLogger.ts"],(function(e){var r,t,i,o,n,a,s,u,f;return{setters:[function(e){r=e.applyDecoratedDescriptor,t=e.inheritsLoose,i=e.initializerDefineProperty,o=e.assertThisInitialized},function(e){n=e.cclegacy,a=e._decorator,s=e.sys,u=e.Component},function(e){f=e.MafiaPBLogger}],execute:function(){var l,c,p,g,m,d,h,b,v,y,P,S,I,w,C;n._RF.push({},"75bbeEbPABFnrzgARe30U1N","Mafia_NetworkConfig",void 0);var N=a.ccclass,L=a.property;e("MafiaNetworkConfig",(l=N("MafiaNetworkConfig"),c=L({tooltip:"Server host address"}),p=L({tooltip:"Server port number"}),g=L({tooltip:"Use SSL for connections"}),m=L({tooltip:"Player identifier"}),d=L({tooltip:"Room identifier"}),h=L({tooltip:"Name of the game"}),l((y=r((v=function(e){function r(){for(var r,t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return r=e.call.apply(e,[this].concat(n))||this,i(r,"serverHost",y,o(r)),i(r,"serverPort",P,o(r)),i(r,"useSSL",S,o(r)),i(r,"userId",I,o(r)),i(r,"roomId",w,o(r)),i(r,"gameName",C,o(r)),r}t(r,e);var n=r.prototype;return n.initNetworkConfig=function(){if(s.isBrowser){var e=new URLSearchParams(window.location.search),r="true"===e.get("debug");f.debug("Initializing network config (debug="+r+")"),r?this.parseQueryParams(e):this.parseInjectedConfig(),f.debug("Final network config:",{serverHost:this.serverHost,serverPort:this.serverPort,useSSL:this.useSSL,userId:this.userId,roomId:this.roomId,gameName:this.gameName})}},n.parseQueryParams=function(e){var r=this;f.debug("Parsing config from query parameters"),this.updateConfigFromQueryParam(e,"userId",(function(e){return r.userId=e})),this.updateConfigFromQueryParam(e,"roomId",(function(e){return r.roomId=e})),this.updateConfigFromQueryParam(e,"apiUrl",(function(e){return r.serverHost=e})),this.updateConfigFromQueryParam(e,"apiPort",(function(e){var t=parseInt(e);isNaN(t)||(r.serverPort=t)})),this.updateConfigFromQueryParam(e,"useSSL",(function(e){return r.useSSL="true"===e}))},n.parseInjectedConfig=function(){f.debug("Parsing config from injected GameConfig");try{var e=window.GameConfig;if(!e)return void f.debug("No injected GameConfig found");var r="string"==typeof e?JSON.parse(e):e;this.applyConfig(r)}catch(e){f.debug("Failed to parse injected GameConfig:",e)}},n.applyConfig=function(e){var r,t,i,o,n;e&&(this.userId=null!=(r=e.userId)?r:this.userId,this.roomId=null!=(t=e.roomId)?t:this.roomId,this.serverHost=null!=(i=e.apiUrl)?i:this.serverHost,this.serverPort=Number(null!=(o=e.apiPort)?o:this.serverPort),this.useSSL=null!=(n=e.useSSL)?n:this.useSSL)},n.updateConfigFromQueryParam=function(e,r,t){var i=e.get(r);null!=i&&t(i)},r}(u)).prototype,"serverHost",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"localhost"}}),P=r(v.prototype,"serverPort",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2567}}),S=r(v.prototype,"useSSL",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),I=r(v.prototype,"userId",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),w=r(v.prototype,"roomId",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"testroom1"}}),C=r(v.prototype,"gameName",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"Pictionary"}}),b=v))||b));n._RF.pop()}}}));

System.register("chunks:///_virtual/Mafia_NetworkManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./colyseus.mjs_cjs=&original=.js","./Mafia_NetworkTypes.ts","./Mafia_PlayerTypes.ts","./Mafia_PbSaveSystem.ts","./Mafia_NetworkConfig.ts","./Mafia_PBLogger.ts","./colyseus.js"],(function(t){var n,e,o,i,r,a,s,c,h,u,l,f,g,m,d,p,C,v,_,k,w;return{setters:[function(t){n=t.applyDecoratedDescriptor,e=t.inheritsLoose,o=t.initializerDefineProperty,i=t.assertThisInitialized,r=t.extends,a=t.createClass,s=t.asyncToGenerator,c=t.regeneratorRuntime},function(t){h=t.cclegacy,u=t._decorator,l=t.EventTarget,f=t.CCBoolean,g=t.Component},null,function(t){m=t.MafiaConnectionState,d=t.MafiaNetworkEvents,p=t.MafiaServerMessageType},function(t){C=t.MafiaPlayerType},function(t){v=t.MafiaPbSaveSystem},function(t){_=t.MafiaNetworkConfig},function(t){k=t.MafiaPBLogger},function(t){w=t.default}],execute:function(){var y,S,E,N,R,D,I,M;h._RF.push({},"3be38Y+E+RBhLFuL1FxpRfp","Mafia_NetworkManager",void 0);var T=u.ccclass,b=u.property,x={roomId:"testroom1",reconnectionToken:"eyJ"},O=t("ConnectionStateChangeEvent",new l),P=t("ServerRoomStateChangeEvent",new l),A=t("ServerMessageEvent",new l);t("MafiaNetworkManager",(y=T("MafiaNetworkManager"),S=b({type:f,tooltip:"Enable development mode for additional logging"}),E=b({type:_,tooltip:"Network configuration settings"}),y(((M=function(t){function n(){for(var n,e=arguments.length,a=new Array(e),s=0;s<e;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a))||this,o(n,"isDevMode",D,i(n)),o(n,"networkConfig",I,i(n)),n._client=void 0,n._room=void 0,n._currentConnectionState=m.INITIALIZING,n._reconnectionData=r({},x),n}e(n,t);var h=n.prototype;return h.onLoad=function(){n._instance&&(this.log("NetworkManager instance already exists. Destroying duplicate."),this.node.destroy()),n._instance=this,this.networkConfig.initNetworkConfig(),this.isDevMode||k.setProductionMode(!0)},h.start=function(){this.initializeClient(),k.info("============ Initializing client ========="),k.info("============ Connecting to room ========="),this.connect(this.networkConfig.roomId,this.networkConfig.userId)},h.onDestroy=function(){this.cleanup()},h.cleanup=function(){this._room&&(this.leaveRoom(),this._room=null),this._client&&(this._client=null),this._currentConnectionState=m.INITIALIZING,this._reconnectionData=r({},x),n._instance===this&&(n._instance=null)},h.initializeClient=function(){var t=this.networkConfig.useSSL?"wss":"ws",n="";n=0==this.networkConfig.serverPort?t+"://"+this.networkConfig.serverHost:t+"://"+this.networkConfig.serverHost+":"+this.networkConfig.serverPort,this.log("Initializing client with endpoint: "+n),this._client=new w.Client(n)},h.shouldRejoin=function(){return!this.isDevMode&&(this._reconnectionData=v.LoadData(this.networkConfig.gameName),!!(this._reconnectionData&&this._reconnectionData.roomId&&this._reconnectionData.reconnectionToken)&&this._reconnectionData.roomId===this.networkConfig.roomId)},h.connect=function(){var t=s(c().mark((function t(n,e){var o;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(k.info("============ Connecting to room from connect function ========="),this.updateConnectionState(m.CONNECTING),!this.shouldRejoin()){t.next=7;break}return this.log("Rejoining room",n),t.next=6,this.rejoin();case 6:return t.abrupt("return");case 7:return t.prev=7,o=this.createPlayerData(e),this.log("Joining with options ",{player:o}),t.next=12,this._client.joinById(n,{player:o});case 12:this._room=t.sent,this.initAfterJoin(n),t.next=20;break;case 16:throw t.prev=16,t.t0=t.catch(7),this.handleConnectionError(t.t0),t.t0;case 20:case"end":return t.stop()}}),t,this,[[7,16]])})));return function(n,e){return t.apply(this,arguments)}}(),h.initAfterJoin=function(t){this.updateConnectionState(m.JOINED_ROOM),this.log("Joined room "+t+" with sessionId: "+this._room.sessionId),this.initializeRoomCallbacks(),this.saveReconnectionData()},h.createAndJoinRoom=function(){var t=s(c().mark((function t(n,e){var o;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.log("Creating room",n),this.updateConnectionState(m.CONNECTING),t.prev=2,o=this.createPlayerData(e),t.next=6,this._client.create("PictionaryRoom",{roomId:n,player:o,roomSettings:{maxClients:10}});case 6:this._room=t.sent,this.initAfterJoin(n),t.next=14;break;case 10:throw t.prev=10,t.t0=t.catch(2),this.handleConnectionError(t.t0),t.t0;case 14:case"end":return t.stop()}}),t,this,[[2,10]])})));return function(n,e){return t.apply(this,arguments)}}(),h.createPlayerData=function(t){return{userId:t,name:t,avatar:"randomProfilePicture",type:C.HUMAN}},h.initializeRoomCallbacks=function(){var t=this;console.log("============ Initializing room callbacks ========="),this._room?(this._room.onStateChange((function(t){P.emit(d.SERVER_ROOM_STATE_CHANGE,t)})),this._room.onLeave((function(n){4001===n?t.updateConnectionState(m.KICKED_OUT):t.updateConnectionState(m.DISCONNECTED)})),this._room.onMessage(p.KICKED_OUT,(function(){t.updateConnectionState(m.KICKED_OUT)})),this._room.onMessage("*",(function(t,n){A.emit(d.SERVER_MESSAGE,t,n)}))):this.log("Cannot initialize callbacks: Room is not defined")},h.updateConnectionState=function(t){if(this._currentConnectionState!==t){var n=this._currentConnectionState;this._currentConnectionState=t,this.log("Connection state changed: "+m[n]+" -> "+m[t]),O.emit(d.CONNECTION_STATE_CHANGE,n,t)}},h.reconnect=function(){var t=s(c().mark((function t(n,e,o){var i,r;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===n&&(n=1),void 0===e&&(e=10),void 0===o&&(o=2e3),this._currentConnectionState===m.DISCONNECTED||this._currentConnectionState===m.RECONNECTING){t.next=6;break}return this.log("Cannot reconnect: Current state is "+m[this._currentConnectionState]),t.abrupt("return");case 6:return this._room&&this._room.state&&(i=this._room.state).roomSettings&&i.roomSettings.maxReconnectionAttempts&&(e=i.roomSettings.maxReconnectionAttempts),this.updateConnectionState(m.RECONNECTING),this.log("Reconnect attempt "+n+"/"+e),t.prev=9,t.next=12,this.delay(o);case 12:if(this._room&&this._room.reconnectionToken){t.next=14;break}throw new Error("Reconnection token not available");case 14:return t.next=16,this._client.reconnect(this._room.reconnectionToken);case 16:r=t.sent,this._room=r,this.saveReconnectionData(),this.initializeRoomCallbacks(),this.updateConnectionState(m.JOINED_ROOM),this.log("Reconnected successfully."),t.next=27;break;case 24:t.prev=24,t.t0=t.catch(9),this.handleReconnectionError(t.t0,n,e,o);case 27:case"end":return t.stop()}}),t,this,[[9,24]])})));return function(n,e,o){return t.apply(this,arguments)}}(),h.rejoin=function(){var t=s(c().mark((function t(n,e,o){var i,r;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return void 0===n&&(n=1),void 0===e&&(e=10),void 0===o&&(o=2e3),this.log("Rejoin attempt "+n+"/"+e),t.prev=4,t.next=7,this.delay(o);case 7:if(this._reconnectionData&&this._reconnectionData.reconnectionToken){t.next=9;break}throw new Error("Reconnection data not available");case 9:return i=this._reconnectionData.roomId+":"+this._reconnectionData.reconnectionToken,k.info("Using formatted reconnection token: ",i),t.next=13,this._client.reconnect(i);case 13:r=t.sent,this._room=r,this.saveReconnectionData(),this.initializeRoomCallbacks(),this.updateConnectionState(m.JOINED_ROOM),this.log("Rejoined successfully."),t.next=24;break;case 21:t.prev=21,t.t0=t.catch(4),this.handleReconnectionError(t.t0,n,e,o,"reJoin");case 24:case"end":return t.stop()}}),t,this,[[4,21]])})));return function(n,e,o){return t.apply(this,arguments)}}(),h.delay=function(){var t=s(c().mark((function t(n){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){return setTimeout(t,n)})));case 1:case"end":return t.stop()}}),t)})));return function(n){return t.apply(this,arguments)}}(),h.handleConnectionError=function(t){var n=(null==t?void 0:t.message)||"Unknown error";this.log("Error connecting to room:",n),this.updateConnectionState(m.DISCONNECTED)},h.handleReconnectionError=function(t,n,e,o,i){void 0===i&&(i="reconnect");var r=(null==t?void 0:t.message)||"Unknown error";this.log(i+" attempt "+n+" failed:",r),n<e||-1===e?"reconnect"===i?this.reconnect(n+1,e,o):this.rejoin(n+1,e,o):(this.log("Max reconnection attempts reached. Please check your network or contact support."),this.updateConnectionState(m.DISCONNECTED))},h.saveReconnectionData=function(){if(k.info("============ Saving reconnection data ========="),this._room&&this._room.reconnectionToken){var t=this._room.reconnectionToken;t.includes(":")&&(t=t.split(":")[1]),k.info("saving Reconnection token: ",t),this._reconnectionData={roomId:this.networkConfig.roomId,reconnectionToken:t},v.SaveData(this.networkConfig.gameName,this._reconnectionData),k.info("Reconnection data saved")}else this.log("Cannot save reconnection data: Room or reconnection token not available")},h.leaveRoom=function(){var t=this;this._room?(this.log("Leaving room"),this._room.leave(!0).then((function(){return t.log("Left room successfully")})).catch((function(n){return t.log("Error leaving room:",(null==n?void 0:n.message)||"Unknown error")}))):this.log("Cannot leave room: Room is not defined")},h.getMySessionId=function(){return this._room.sessionId},h.sendMessage=function(t,n){this._room?(this.isDevMode&&this.log("Sending message:",t,n),this._room.send(t,n)):this.log("Cannot send message: Room is not defined")},h.log=function(t){if(this.isDevMode){for(var n=arguments.length,e=new Array(n>1?n-1:0),o=1;o<n;o++)e[o-1]=arguments[o];e.length>0?k.info.apply(k,["[NetworkManager] "+t].concat(e)):k.info("[NetworkManager] "+t)}},a(n,[{key:"CurrentRoom",get:function(){return this._room}},{key:"CurrentConnectionState",get:function(){return this._currentConnectionState}}],[{key:"Instance",get:function(){if(!this._instance)throw new Error("NetworkManager instance is not initialized.");return this._instance}}]),n}(g))._instance=null,D=n((R=M).prototype,"isDevMode",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I=n(R.prototype,"networkConfig",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=R))||N));h._RF.pop()}}}));

System.register("chunks:///_virtual/Mafia_NetworkTypes.ts",["cc"],(function(E){var N;return{setters:[function(E){N=E.cclegacy}],execute:function(){N._RF.push({},"917450yHbdDfoiHLt9WC9RD","Mafia_NetworkTypes",void 0);E("MafiaNetworkEvents",function(E){return E[E.SERVER_ROOM_STATE_CHANGE=0]="SERVER_ROOM_STATE_CHANGE",E[E.CONNECTION_STATE_CHANGE=1]="CONNECTION_STATE_CHANGE",E[E.ROOM_STATUS_CHANGE=2]="ROOM_STATUS_CHANGE",E[E.GAME_STATE_CHANGE=3]="GAME_STATE_CHANGE",E[E.SERVER_MESSAGE=4]="SERVER_MESSAGE",E}({})),E("MafiaConnectionState",function(E){return E[E.INITIALIZING=0]="INITIALIZING",E[E.CONNECTING=1]="CONNECTING",E[E.CONNECTED=2]="CONNECTED",E[E.LOBBY=3]="LOBBY",E[E.JOINED_ROOM=4]="JOINED_ROOM",E[E.DISCONNECTED=5]="DISCONNECTED",E[E.RECONNECTING=6]="RECONNECTING",E[E.KICKED_OUT=7]="KICKED_OUT",E}({})),E("MafiaServerMessageType",function(E){return E.NONE="none",E.KICKED_OUT="kicked_out",E.PLAYER_CAMEBACK="player_cameback",E.PLAYER_JOINED="player_joined",E}({}));N._RF.pop()}}}));

System.register("chunks:///_virtual/Mafia_PbExtensions.ts",["cc","./Mafia_PBLogger.ts"],(function(){var t,n,e,i;return{setters:[function(i){t=i.cclegacy,n=i.Vec3,e=i.Component},function(t){i=t.MafiaPBLogger}],execute:function(){t._RF.push({},"148f4rScJ9CCpYq02Y6pLaL","Mafia_PbExtensions",void 0),n.prototype.clampMagnitude=function(t,n){if(!(t>n)){var e=this.length();return e>n?(this.normalize(),this.multiplyScalar(n)):e<t&&(this.normalize(),this.multiplyScalar(t)),this}console.error("min should be less than max")},e.prototype.log=function(){for(var t=this.constructor.name,n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];i.info.apply(i,[t+" "].concat(e))},t._RF.pop()}}}));

System.register("chunks:///_virtual/Mafia_PBLogger.ts",["cc"],(function(e){var n;return{setters:[function(e){n=e.cclegacy}],execute:function(){n._RF.push({},"1f240GvJhZCS7g77Mtiwwuo","Mafia_PBLogger",void 0);var r=e("LogLevel",function(e){return e[e.Debug=0]="Debug",e[e.Info=1]="Info",e[e.Warning=2]="Warning",e[e.Error=3]="Error",e}({})),o=e("MafiaPBLogger",function(){function e(){}return e.debug=function(e){for(var n=arguments.length,o=new Array(n>1?n-1:0),t=1;t<n;t++)o[t-1]=arguments[t];this.log(r.Debug,e,o)},e.info=function(e){for(var n=arguments.length,o=new Array(n>1?n-1:0),t=1;t<n;t++)o[t-1]=arguments[t];this.log(r.Info,e,o)},e.warning=function(e){for(var n=arguments.length,o=new Array(n>1?n-1:0),t=1;t<n;t++)o[t-1]=arguments[t];this.log(r.Warning,e,o)},e.error=function(e){for(var n=arguments.length,o=new Array(n>1?n-1:0),t=1;t<n;t++)o[t-1]=arguments[t];this.log(r.Error,e,o)},e.log=function(e,n,o){if(e>=this.currentLevel){var t,i=r[e]+": "+n;if((t=console).log.apply(t,[i].concat(o)),this.isProduction&&window.ReactNativeWebView)try{var a={type:"log",level:r[e],message:i,params:o};window.ReactNativeWebView&&window.ReactNativeWebView.postMessage(JSON.stringify(a))}catch(e){console.error("Failed to send log to ReactNativeWebView:",e)}}},e.setLevel=function(e){this.currentLevel=e},e.setProductionMode=function(e){this.isProduction=e},e}());o.currentLevel=r.Debug,o.isProduction=!1,n._RF.pop()}}}));

System.register("chunks:///_virtual/Mafia_PbSaveSystem.ts",["cc","./Mafia_PBLogger.ts"],(function(a){var e,t,o,n;return{setters:[function(a){e=a.cclegacy,t=a._decorator,o=a.sys},function(a){n=a.MafiaPBLogger}],execute:function(){var r;e._RF.push({},"d2fa7MJJdNKspLZrCg4jToe","Mafia_PbSaveSystem",void 0);var c=t.ccclass;a("MafiaPbSaveSystem",c("MafiaPbSaveSystem")(r=function(){function a(){}return a.SaveData=function(a,e){n.info("============ Saving data in pb save system ========="),o.localStorage.setItem(a,JSON.stringify(e))},a.LoadData=function(a){return JSON.parse(o.localStorage.getItem(a))},a.RemoveData=function(a){o.localStorage.removeItem(a)},a.ClearAllData=function(){o.localStorage.clear()},a}())||r);e._RF.pop()}}}));

System.register("chunks:///_virtual/Mafia_Player.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Mafia_GameState.ts","./Mafia_GameMessageType.ts","./Mafia_PlayerAvatar.ts","./MafiaGameHandler.ts","./Mafia_NetworkManager.ts","./index2.ts","./WebViewTransport.ts"],(function(e){var t,i,a,o,n,r,s,l,c,u,d,h,p,f,y,v,I,m,g,P,b,S,C,N;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,a=e.initializerDefineProperty,o=e.assertThisInitialized},function(e){n=e.cclegacy,r=e._decorator,s=e.Label,l=e.Node,c=e.CCBoolean,u=e.Prefab,d=e.Button,h=e.UIOpacity,p=e.Color,f=e.Tween,y=e.Vec3,v=e.tween,I=e.instantiate,m=e.Component},function(e){g=e.MafiaGameState},function(e){P=e.MafiaGameMessageType},function(e){b=e.MafiaPlayerAvatar},function(e){S=e.MafiaGameHandler},function(e){C=e.MafiaNetworkManager},null,function(e){N=e.WebViewTransport}],execute:function(){var D,L,w,E,M,A,T,V,R,U,B,k,z,G,O,_,F,W,H,x,Z,Y,K,X,j;n._RF.push({},"40162PXqm9DSbxUCrdBOLNu","Mafia_Player",void 0);var q=r.ccclass,J=r.property,Q=e("PlayerState",function(e){return e[e.UNINITIALIZED=0]="UNINITIALIZED",e[e.IDLE=1]="IDLE",e[e.CATEGORY_SELECTION=2]="CATEGORY_SELECTION",e[e.DESCRIBING=3]="DESCRIBING",e[e.VOTING=4]="VOTING",e[e.END_GAME=5]="END_GAME",e}({}));e("MafiaPlayer",(D=q("MafiaPlayer"),L=J({type:s,tooltip:"Label to display player's name"}),w=J({type:b,tooltip:"Player Avatar"}),E=J({type:l,tooltip:"Background shown when speaking"}),M=J({type:l,tooltip:"Container for microphone icon"}),A=J({type:l,tooltip:"Microphone Icon Node"}),T=J({type:c,tooltip:"Enable voting functionality for this player"}),V=J({type:l,tooltip:"Background shown when player is selected for voting"}),R=J({type:s,tooltip:"Label showing vote count"}),U=J({type:l,tooltip:"Vote icon node for animation"}),B=J({type:l,tooltip:"Container for voted players' avatars"}),k=J({type:u,tooltip:"Prefab for small player avatar in voted container"}),D((O=t((G=function(e){function t(){for(var t,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).userId="",t.playerName="",a(t,"nameLabel",O,o(t)),a(t,"playerAvatar",_,o(t)),a(t,"speakingBg",F,o(t)),a(t,"micContainer",W,o(t)),a(t,"micIcon",H,o(t)),a(t,"isVotingPlayer",x,o(t)),a(t,"selectedBg",Z,o(t)),a(t,"voteCountLabel",Y,o(t)),a(t,"voteIconNode",K,o(t)),a(t,"votedPlayersContainer",X,o(t)),a(t,"votedPlayerAvatarPrefab",j,o(t)),t.playerState=Q.UNINITIALIZED,t.isLocal=!1,t.isInitialized=!1,t.isProfileInitialized=!1,t.roomSettings=null,t.profileImageUrl="",t.timer=0,t.rank=0,t.hasGuessedAnswer=!1,t.isDead=!1,t}i(t,e);var n=t.prototype;return n.onLoad=function(){this.isVotingPlayer&&(this.node.getComponent(d)||this.node.addComponent(d),this.node.on(l.EventType.TOUCH_END,this.onPlayerClicked,this))},n.onEnable=function(){},n.onDisable=function(){},n.update=function(e){this.playerState===Q.DESCRIBING&&this.updateTimer(e)},n.IsDead=function(){return this.isDead},n.initialize=function(e,t){this.validateRoomState(e)&&(t?(console.log("[Player] Initializing Player: "+t.userId),this.setupPlayerData(t,e),this.loadProfile(t),this.updatePlayerState(e),this.sendReactNativeMessage("player_initialized",t)):console.error("[Player] No profile data provided"))},n.setupPlayerData=function(e,t){if(this.userId=e.userId,this.playerName=S.Instance.getDisplayName(this.userId),this.roomSettings=t.roomSettings,this.setScore(e.score),e.sessionId===C.Instance.CurrentRoom.sessionId&&(this.isLocal=!0,this.isVotingPlayer)){var i=this.node.getComponent(h);i||(i=this.node.addComponent(h)),i.opacity=153}this.nameLabel.node.active=!0,this.isInitialized=!0,this.playerState=Q.IDLE},n.loadProfile=function(e){!this.isProfileInitialized&&e&&(console.log("[Player] Loading profile for player: "+this.playerName),this.nameLabel.string=this.playerName,this.profileImageUrl=e.avatar,this.playerAvatar.initialize(!0,e.userId),this.loadProfileImage(),this.setNameLabelColor(),this.isProfileInitialized=!0,this.isDead=e.isDead)},n.setNameLabelColor=function(e){if(e||(e=S.Instance.getRoomState()),e)if(this.isLocal){var t=this.userId===e.currentSpyUserId;this.nameLabel.color=t?S.Instance.spyColor:S.Instance.villagersColor}else this.nameLabel.color=(new p).fromHEX("#FFFFFF")},n.loadProfileImage=function(){this.profileImageUrl?this.playerAvatar.setAvatarFromUrl(this.profileImageUrl):console.warn("[Player] No profile image URL provided")},n.onServerRoomStateChange=function(e){this.validateRoomState(e)&&(this.updatePlayerData(e),this.updatePlayerState(e),this.setNameLabelColor(e),this.isVotingPlayer&&this.updateVoteDisplay(e))},n.updatePlayerData=function(e){var t,i=this,a=null==(t=e.playersData)?void 0:t.find((function(e){return e.userId===i.userId}));a&&this.setScore(a.score)},n.updatePlayerState=function(e){var t,i=this;if(this.playerState!==Q.UNINITIALIZED){var a=null==(t=e.playersData)?void 0:t.find((function(e){return e.userId===i.userId}));switch(a&&(this.isDead=a.isDead),e.currentGameState){case g.WORD_DESCRIPTION:this.handleWordDescriptionState(e);break;default:this.setStateIdle()}}},n.handleWordDescriptionState=function(e){var t,i=this;if(e.describingPlayerId===this.userId){this.isLocal&&this.unmuteMic(),this.playerState=Q.DESCRIBING,this.speakingBg&&(this.speakingBg.active=!0),this.micContainer&&(this.micContainer.active=!0),this.micIcon&&(this.micIcon.active=!0,f.stopAllByTarget(this.micIcon),this.micIcon.setScale(y.ONE),v(this.micIcon).to(.5,{scale:new y(1.2,1.2,1)}).to(.5,{scale:y.ONE}).union().repeatForever().start()),S.Instance.miloSDK&&S.Instance.miloSDK.vibratePreset("heavy");var a=null==(t=e.playersData)?void 0:t.find((function(e){return e.userId===i.userId}));a&&(this.setTimer(a.descriptionTimer),console.log("[Player] Player "+this.userId+" description timer: "+this.timer))}else this.setStateIdle(!0)},n.setStateIdle=function(e){void 0===e&&(e=!1),this.playerState=Q.IDLE,this.nameLabel&&(this.nameLabel.node.active=!0),this.speakingBg&&(this.speakingBg.active=!1),this.micContainer&&(this.micContainer.active=!1),this.micIcon&&(f.stopAllByTarget(this.micIcon),this.micIcon.active=!1),this.isLocal&&(e?this.muteMic():this.unmuteMic()),this.setTimer(0)},n.updateTimer=function(e){var t=Math.max(0,this.timer-e);this.setTimer(t)},n.setTimer=function(e){this.timer=e},n.muteMic=function(){this.sendReactNativeMessage("muteMic",!0)},n.unmuteMic=function(){this.sendReactNativeMessage("muteMic",!1)},n.resetState=function(){this.hasGuessedAnswer=!1,this.setStateIdle()},n.onReconnection=function(e){var t,i=this;if(this.validateRoomState(e)){var a=null==(t=e.playersData)?void 0:t.find((function(e){return e.userId===i.userId}));a&&(this.loadProfile(a),this.setScore(a.score)),this.updatePlayerState(e)}},n.onSetState=function(e){this.updatePlayerState(e)},n.handleTurnSpecificMessages=function(e){if(e.inputPayload.inputType!==P.NONE)switch(e.inputPayload.inputType){case P.SET_STATE:this.onSetState(e)}},n.handleWordsList=function(e){console.log("[Player] Received words list",e.inputPayload)},n.getLocalPlayerData=function(e){var t=C.Instance.CurrentRoom.sessionId;return null==e?void 0:e.playersData.find((function(e){return e.sessionId===t}))},n.validateRoomState=function(e){return!!e||(console.error("[Player] Invalid room state"),!1)},n.sendReactNativeMessage=function(e,t){var i={event:e,gameId:"mafia-game",data:t,ts:Date.now()};(new N).send(i),console.log("sending message to react native",i)},n.setScore=function(e){},n.setRank=function(e){this.rank=e},n.setGuessedAnswer=function(e){this.hasGuessedAnswer=e},n.openProfile=function(){this.userId?console.log("Opening profile for user: "+this.userId):console.warn("[Player] Cannot open profile: No user ID available")},n.onPlayerClicked=function(){var e;if(this.isVotingPlayer&&!S.Instance.isLocalUserSpectator()){var t=S.Instance.getRoomState();if(t){var i=S.Instance.getLocalUserId();if(this.userId!==i){var a=null==(e=t.playersData)?void 0:e.find((function(e){return e.userId===i}));if(a&&a.votedSpyUserId)console.log("[Player] Already voted for "+a.votedSpyUserId);else{console.log("[Player] Player clicked for voting: "+this.userId);var o={userId:this.userId};C.Instance.sendMessage(P.PLAYER_VOTE,o),this.showVoteSelection(),this.optimisticVoteUpdate()}}else console.log("[Player] Cannot vote for yourself")}}},n.optimisticVoteUpdate=function(){var e,t=S.Instance.getRoomState();if(t){var i=S.Instance.getLocalUserId(),a=null==(e=t.playersData)?void 0:e.find((function(e){return e.userId===i}));if(a){var o=a.votedSpyUserId;a.votedSpyUserId=this.userId,this.updateVoteDisplay(t),a.votedSpyUserId=o,console.log("[Player] Optimistic vote update applied for "+this.userId)}}},n.showVoteSelection=function(){this.selectedBg&&(this.selectedBg.active=!0),this.voteIconNode&&this.animateVoteStamp()},n.animateVoteStamp=function(){if(this.voteIconNode){this.voteIconNode.active=!0;var e=this.voteIconNode.scale.clone();this.voteIconNode.setScale(new y(1.5,1.5,1)),v(this.voteIconNode).to(.2,{scale:new y(.9,.9,1)},{easing:"backOut"}).to(.1,{scale:e},{easing:"backOut"}).start()}},n.updateVoteDisplay=function(e){var t,i,a=this;if(this.isVotingPlayer){var o=(null==(t=e.playersData)?void 0:t.filter((function(e){return e.votedSpyUserId===a.userId})))||[],n=o.length;console.log("[Player] updateVoteDisplay for "+this.userId+": "+n+" votes",o.map((function(e){return e.userId}))),this.voteCountLabel?n>0?(this.voteCountLabel.string="+"+n,this.voteCountLabel.node.active=!0,console.log("[Player] Vote count label updated: +"+n)):(this.voteCountLabel.node.active=!1,console.log("[Player] Vote count label hidden (0 votes)")):console.warn("[Player] voteCountLabel is null for "+this.userId),this.votedPlayersContainer&&this.votedPlayerAvatarPrefab?(this.votedPlayersContainer.removeAllChildren(),o.forEach((function(e){var t=I(a.votedPlayerAvatarPrefab);a.votedPlayersContainer.addChild(t);var i=t.getComponent(b);i&&e.avatar&&i.setAvatarFromUrl(e.avatar)})),this.votedPlayersContainer.active=n>0,console.log("[Player] Voted players container updated with "+n+" avatars")):(this.votedPlayersContainer||console.warn("[Player] votedPlayersContainer is null for "+this.userId),this.votedPlayerAvatarPrefab||console.warn("[Player] votedPlayerAvatarPrefab is null for "+this.userId));var r=S.Instance.getLocalUserId(),s=null==(i=e.playersData)?void 0:i.find((function(e){return e.userId===r})),l=(null==s?void 0:s.votedSpyUserId)===this.userId;this.selectedBg&&(this.selectedBg.active=l,console.log("[Player] Selected BG for "+this.userId+": "+(l?"shown":"hidden"))),this.voteIconNode&&(this.voteIconNode.active=l,console.log("[Player] Vote icon for "+this.userId+": "+(l?"shown":"hidden")))}else console.log("[Player] updateVoteDisplay skipped - isVotingPlayer is false for "+this.userId)},n.resetVotingState=function(){this.isVotingPlayer&&(this.selectedBg&&(this.selectedBg.active=!1),this.voteCountLabel&&(this.voteCountLabel.node.active=!1),this.votedPlayersContainer&&(this.votedPlayersContainer.removeAllChildren(),this.votedPlayersContainer.active=!1),this.voteIconNode&&(this.voteIconNode.active=!1))},t}(m)).prototype,"nameLabel",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=t(G.prototype,"playerAvatar",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=t(G.prototype,"speakingBg",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=t(G.prototype,"micContainer",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=t(G.prototype,"micIcon",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=t(G.prototype,"isVotingPlayer",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Z=t(G.prototype,"selectedBg",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=t(G.prototype,"voteCountLabel",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=t(G.prototype,"voteIconNode",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=t(G.prototype,"votedPlayersContainer",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=t(G.prototype,"votedPlayerAvatarPrefab",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=G))||z));n._RF.pop()}}}));

System.register("chunks:///_virtual/Mafia_PlayerAvatar.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,a,r,i,n,o,l,s,u,c,p,f;return{setters:[function(e){t=e.applyDecoratedDescriptor,a=e.inheritsLoose,r=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){n=e.cclegacy,o=e._decorator,l=e.Sprite,s=e.Node,u=e.assetManager,c=e.SpriteFrame,p=e.Texture2D,f=e.Component}],execute:function(){var v,y,h,d,m,g,A,w,b;n._RF.push({},"f0449qYRJRD2qYGuhFrYnAx","Mafia_PlayerAvatar",void 0);var T=o.ccclass,S=o.property;e("MafiaPlayerAvatar",(v=T("MafiaPlayerAvatar"),y=S({type:l,tooltip:"Player Avatar"}),h=S({type:l,tooltip:"Player Avatar Outline"}),d=S({type:s,tooltip:"Skull"}),v((A=t((g=function(e){function t(){for(var t,a=arguments.length,n=new Array(a),o=0;o<a;o++)n[o]=arguments[o];return t=e.call.apply(e,[this].concat(n))||this,r(t,"playerAvatar",A,i(t)),r(t,"outline",w,i(t)),r(t,"skull",b,i(t)),t.enableOnClick=!1,t.userId="",t}a(t,e);var n=t.prototype;return n.initialize=function(e,t){this.enableOnClick=e,this.userId=t},n.onEnable=function(){this.registerTouchEvents()},n.onDisable=function(){this.unregisterTouchEvents()},n.start=function(){},n.update=function(e){},n.registerTouchEvents=function(){this.playerAvatar&&this.playerAvatar.node&&this.playerAvatar.node.on(s.EventType.TOUCH_START,this.handleTouchStart,this)},n.unregisterTouchEvents=function(){this.playerAvatar&&this.playerAvatar.node&&this.playerAvatar.node.off(s.EventType.TOUCH_START,this.handleTouchStart,this)},n.handleTouchStart=function(){this.enableOnClick},n.setOutline=function(e){this.outline&&(this.outline.enabled=e)},n.setAvatarFromUrl=function(e){var t=this.getFromCache(e);t?this.createSpriteFrameFromTexture(t):this.loadRemoteImage(e)},n.setAvatarFromSpriteFrame=function(e){this.playerAvatar&&(this.playerAvatar.spriteFrame=e)},n.getFromCache=function(e){var t=u.assets.get(e);return t&&t.isValid&&"function"==typeof t.getHash?t:null},n.createSpriteFrameFromTexture=function(e){if(e&&e.isValid&&"function"==typeof e.getHash)if(this.playerAvatar){var t=new c;t.texture=e,this.playerAvatar.spriteFrame=t}else console.warn("[MafiaPlayerAvatar] PlayerAvatar component is null");else console.warn("[MafiaPlayerAvatar] Invalid texture provided")},n.loadRemoteImage=function(e){var t=this;u.loadRemote(e,{ext:".png"},(function(a,r){if(a)return console.error("[Player] Failed to load profile image: "+JSON.stringify(a)),void(window.ReactNativeWebView&&window.ReactNativeWebView.postMessage(JSON.stringify({message:"player_avatar_load_failed",data:{userId:t.userId,url:e,errorName:a.name,errorMessage:a.message,errorStack:a.stack}})));try{var i=new c,n=new p;n.image=r,n.isValid&&"function"==typeof n.getHash?(i.texture=n,t.playerAvatar?t.playerAvatar.spriteFrame=i:console.warn("[MafiaPlayerAvatar] PlayerAvatar component is null")):console.warn("[MafiaPlayerAvatar] Invalid texture created from imageAsset")}catch(a){console.error("[Player] Error creating sprite frame: "+a),window.ReactNativeWebView&&window.ReactNativeWebView.postMessage(JSON.stringify({message:"player_sprite_frame_creation_failed",data:{userId:t.userId,url:e,error:a}}))}}))},n.ShowSkull=function(e){this.skull&&(this.skull.active=e)},t}(f)).prototype,"playerAvatar",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=t(g.prototype,"outline",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=t(g.prototype,"skull",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=g))||m));n._RF.pop()}}}));

System.register("chunks:///_virtual/Mafia_PlayerTypes.ts",["cc"],(function(e){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"4d199WiL2xLT6KTu/5loLPp","Mafia_PlayerTypes",void 0);e("MafiaPlayerType",function(e){return e[e.HUMAN=0]="HUMAN",e[e.BOT=1]="BOT",e[e.SPECTATOR=2]="SPECTATOR",e}({}));t._RF.pop()}}}));

System.register("chunks:///_virtual/Mafia_PreparationScreen.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Mafia_Menu.ts","./MafiaGameHandler.ts","./Mafia_AudioManager.ts","./Mafia_NetworkManager.ts","./Mafia_PlayerAvatar.ts"],(function(e){var t,i,n,r,a,o,l,s,p,c,u,y,f,g,C;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,n=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){a=e.cclegacy,o=e._decorator,l=e.Node,s=e.Label,p=e.Sprite,c=e.Color},function(e){u=e.MafiaMenu},function(e){y=e.MafiaGameHandler},function(e){f=e.MafiaAudioManager},function(e){g=e.MafiaNetworkManager},function(e){C=e.MafiaPlayerAvatar}],execute:function(){var b,d,h,v,S,L,M,I,w,H,m,A,P,_,z,B,T,D,W;a._RF.push({},"4952cIc/PlMopoNID/uP+1K","Mafia_PreparationScreen",void 0);var E=o.ccclass,R=o.property,N="[PreparationScreen]";e("MafiaPreparationScreen",(b=E("MafiaPreparationScreen"),d=R({type:l,tooltip:"Role container background"}),h=R({type:s,tooltip:"Role label"}),v=R({type:s,tooltip:"Word Label"}),S=R({type:s,tooltip:"Spy Category Label"}),L=R({type:l,tooltip:"Spy Hint Container"}),M=R({type:l,tooltip:"Spy Category Container"}),I=R({type:l,tooltip:"Civilian Hint Container"}),w=R({type:C,tooltip:"Player Avatar"}),b((A=t((m=function(e){function t(){for(var t,i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,n(t,"roleContainerBg",A,r(t)),n(t,"roleLabel",P,r(t)),n(t,"wordLabel",_,r(t)),n(t,"spyCategoryLabel",z,r(t)),n(t,"spyHintContainer",B,r(t)),n(t,"spyCategoryContainer",T,r(t)),n(t,"civilianHintContainer",D,r(t)),n(t,"playerAvatar",W,r(t)),t.CIVILIAN_TEXT="Civilian",t.SPY_TEXT="Spy",t}i(t,e);var a=t.prototype;return a.Open=function(){e.prototype.Open.call(this),this.setupScreen()},a.setupScreen=function(){this.updateRoleDisplay()},a.updateRoleDisplay=function(){var e=y.Instance.getRoomState();if(e){var t=g.Instance.getMySessionId(),i=e.getPlayerBySessionId(t),n=e.spectatorsData.find((function(e){return e.sessionId===t}));if(i||n){var r=i?i.userId:n.userId,a=i?i.avatar:n.avatar;if(this.playerAvatar&&(this.playerAvatar.initialize(!1,r),this.playerAvatar.setAvatarFromUrl(a)),r===e.currentSpyUserId)console.log(N+" Playing SpyWord sound"),f.instance.playSound("SpyWord"),this.applySpyStyles(i.clue);else{var o="";if(i&&i.describingWord)o=i.describingWord;else{var l,s=null==(l=e.playersData)?void 0:l.filter((function(t){return t.userId!==e.currentSpyUserId})),p=null==s?void 0:s.find((function(e){return e.describingWord&&e.describingWord.length>0}));o=p?p.describingWord:"WAITING"}this.applyCivilianStyles(o)}}else console.error(N+" Cannot find player data for session ID: "+t)}else console.error(N+" Cannot setup screen: Room state is null")},a.applySpyStyles=function(e){if(this.roleContainerBg){var t=this.roleContainerBg.getComponent(p);t&&(t.color=(new c).fromHEX("#EB4E4C"))}this.roleLabel&&(this.roleLabel.string=this.SPY_TEXT),this.spyCategoryLabel&&(this.spyCategoryLabel.string=e.toUpperCase()),this.wordLabel&&(this.wordLabel.string="???"),this.civilianHintContainer&&(this.civilianHintContainer.active=!1),this.spyCategoryContainer&&(this.spyCategoryContainer.active=!0),this.spyHintContainer&&(this.spyHintContainer.active=!0)},a.applyCivilianStyles=function(e){if(this.roleContainerBg){var t=this.roleContainerBg.getComponent(p);t&&(t.color=(new c).fromHEX("#47A74B"))}this.roleLabel&&(this.roleLabel.string=this.CIVILIAN_TEXT),this.wordLabel&&(this.wordLabel.string='"'+e.toUpperCase()+'"'),this.civilianHintContainer&&(this.civilianHintContainer.active=!0),this.spyCategoryContainer&&(this.spyCategoryContainer.active=!1),this.spyHintContainer&&(this.spyHintContainer.active=!1)},t}(u)).prototype,"roleContainerBg",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=t(m.prototype,"roleLabel",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=t(m.prototype,"wordLabel",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=t(m.prototype,"spyCategoryLabel",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=t(m.prototype,"spyHintContainer",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=t(m.prototype,"spyCategoryContainer",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=t(m.prototype,"civilianHintContainer",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=t(m.prototype,"playerAvatar",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=m))||H));a._RF.pop()}}}));

System.register("chunks:///_virtual/Mafia_RoomState.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Mafia_BasePlayerData.ts","./Mafia_BaseRoomSettings.ts","./Mafia_BaseRoomState.ts","./Mafia_GameState.ts"],(function(t){var i,e,r,o,n,s;return{setters:[function(t){i=t.inheritsLoose},function(t){e=t.cclegacy},function(t){r=t.MafiaBasePlayerData},function(t){o=t.MafiaBaseRoomSettings},function(t){n=t.MafiaBaseRoomState},function(t){s=t.MafiaGameState}],execute:function(){e._RF.push({},"80979N80XBKYK0mMy1KuHAh","Mafia_RoomState",void 0);var a=t("PlayerRoundScore",function(){function t(){this.roundNumber=0,this.score=0,this.survived=!0}return t.prototype.copyFrom=function(t){this.roundNumber=t.roundNumber,this.score=t.score,this.survived=t.survived},t}()),u=t("MafiaPlayerData",function(t){function e(){for(var i,e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];return(i=t.call.apply(t,[this].concat(r))||this).isDead=!1,i.votedSpyUserId="",i.selectedCategory="",i.describingWord="",i.clue="",i.descriptionTimer=0,i.roundScores=[],i}return i(e,t),e.prototype.copyFrom=function(i){t.prototype.copyFrom.call(this,i),this.isDead=i.isDead,this.votedSpyUserId=i.votedSpyUserId,this.selectedCategory=i.selectedCategory,this.describingWord=i.describingWord,this.clue=i.clue,this.descriptionTimer=i.descriptionTimer,this.roundScores=i.roundScores.map((function(t){var i=new a;return i.copyFrom(t),i}))},e}(r)),c=t("MafiaRoomSettings",function(t){function e(){for(var i,e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];return(i=t.call.apply(t,[this].concat(r))||this).maxRounds=void 0,i.startRoundTimeLimit=void 0,i.categorySelectionTimeLimit=void 0,i.preparationTimeLimit=void 0,i.descriptionTimeLimit=void 0,i.discussionTimeLimit=void 0,i.votingTimeLimit=void 0,i.votingResultsTimeLimit=void 0,i.endRoundTimeLimit=void 0,i.rounds=void 0,i}return i(e,t),e.prototype.copyFrom=function(i){t.prototype.copyFrom.call(this,i),this.maxRounds=i.maxRounds,this.startRoundTimeLimit=i.startRoundTimeLimit,this.categorySelectionTimeLimit=i.categorySelectionTimeLimit,this.preparationTimeLimit=i.preparationTimeLimit,this.descriptionTimeLimit=i.descriptionTimeLimit,this.discussionTimeLimit=i.discussionTimeLimit,this.votingTimeLimit=i.votingTimeLimit,this.votingResultsTimeLimit=i.votingResultsTimeLimit,this.endRoundTimeLimit=i.endRoundTimeLimit,this.rounds=i.rounds},e}(o)),m=t("MafiaInputPayload",function(){function t(){this.inputType=void 0,this.inputValue=void 0}return t.prototype.copyFrom=function(t){this.inputType=t.inputType,this.inputValue=t.inputValue},t}());t("MafiaRoomState",function(t){function e(){var i;return(i=t.call(this,new c,[])||this).inputPayload=new m,i.currentGameState=s.NONE,i.previousGameState=s.NONE,i.describingPlayerId="",i.category="",i.tiedPlayerIds=[],i.tieBreakRound=0,i.serverTick=0,i.currentRound=1,i.currentSpyUserId="",i.discussionTimer=0,i.votingTimer=0,i}i(e,t);var o=e.prototype;return o.copyFrom=function(i){t.prototype.copyFrom.call(this,i),this.playersData=i.playersData.map((function(t){var i=new u;return i.copyFrom(t),i})),this.spectatorsData=i.spectatorsData.map((function(t){var i=new r;return i.copyFrom(t),i})),this.currentRoomStatus=i.currentRoomStatus,this.previousRoomStatus=i.previousRoomStatus,this.currentGameState=i.currentGameState,this.previousGameState=i.previousGameState,this.roomSettings.copyFrom(i.roomSettings),this.inputPayload.copyFrom(i.inputPayload),this.category=i.category,this.describingPlayerId=i.describingPlayerId,this.tiedPlayerIds=i.tiedPlayerIds.map((function(t){return t})),this.tieBreakRound=i.tieBreakRound,this.serverTick=i.serverTick,this.currentRound=i.currentRound,this.currentSpyUserId=i.currentSpyUserId,this.discussionTimer=i.discussionTimer,this.votingTimer=i.votingTimer},o.getPlayerByUserId=function(t){return this.playersData.find((function(i){return i.userId===t}))||null},o.getOnlinePlayersCount=function(){return this.playersData.filter((function(t){return t.isOnline})).length},o.getPlayerByIndex=function(t){return this.playersData.find((function(i){return i.playerNumber===t}))||null},o.getPlayerBySessionId=function(t){return this.playersData.find((function(i){return i.sessionId===t}))||null},e}(n));e._RF.pop()}}}));

System.register("chunks:///_virtual/Mafia_RoomTypes.ts",["cc"],(function(t){var _;return{setters:[function(t){_=t.cclegacy}],execute:function(){_._RF.push({},"a3a72gjPcRAvIYOfAxJummA","Mafia_RoomTypes",void 0);t("MafiaRoomStatus",function(t){return t[t.NONE=0]="NONE",t[t.WAITING_FOR_PLAYERS=1]="WAITING_FOR_PLAYERS",t[t.COUNTDOWN=2]="COUNTDOWN",t[t.GAME_SIMULATION=3]="GAME_SIMULATION",t[t.END_GAME=4]="END_GAME",t[t.KICKED_OUT=5]="KICKED_OUT",t}({}));_._RF.pop()}}}));

System.register("chunks:///_virtual/Mafia_StartRoundScreen.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Mafia_Menu.ts"],(function(e){var t,n,i,a,s,o,l,r,c,u;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,a=e.assertThisInitialized},function(e){s=e.cclegacy,o=e._decorator,l=e.Label,r=e.Vec3,c=e.tween},function(e){u=e.MafiaMenu}],execute:function(){var p,g,h,L,A;s._RF.push({},"28432gn1jZNmoVOMCSvOamH","Mafia_StartRoundScreen",void 0);var f=o.ccclass,d=o.property;e("MafiaStartRoundScreen",(p=f("MafiaStartRoundScreen"),g=d({type:l,tooltip:"Label displaying Assigning Role text"}),p((A=t((L=function(e){function t(){for(var t,n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return t=e.call.apply(e,[this].concat(s))||this,i(t,"assigningRoleLabel",A,a(t)),t.roundTween=null,t.INITIAL_SCALE=1.2,t.FINAL_SCALE=1,t.ANIMATION_DURATION=.4,t}n(t,e);var s=t.prototype;return s.Open=function(){e.prototype.Open.call(this),this.updateRoleAssigningDisplay()},s.Close=function(){this.stopActiveTween(),e.prototype.Close.call(this)},s.updateRoleAssigningDisplay=function(){this.stopActiveTween(),this.resetLabelScale(),this.updateLabelText(),this.animateLabel()},s.stopActiveTween=function(){this.roundTween&&(this.roundTween.stop(),this.roundTween=null)},s.resetLabelScale=function(){var e=new r(this.INITIAL_SCALE,this.INITIAL_SCALE,1);this.assigningRoleLabel.node.setScale(e)},s.updateLabelText=function(){this.assigningRoleLabel.string="Assigning Role..."},s.animateLabel=function(){var e=new r(this.FINAL_SCALE,this.FINAL_SCALE,1);this.roundTween=c(this.assigningRoleLabel.node).to(this.ANIMATION_DURATION,{scale:e},{easing:"sineIn"}).delay(1).start()},t}(u)).prototype,"assigningRoleLabel",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),h=L))||h));s._RF.pop()}}}));

System.register("chunks:///_virtual/Mafia_UIManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Mafia_Menu.ts","./Mafia_GameState.ts","./Mafia_GameManager.ts","./MafiaGameHandler.ts","./Mafia_NetworkManager.ts","./Mafia_NetworkTypes.ts","./Mafia_RoomTypes.ts"],(function(e){var n,t,a,o,i,s,r,u,l,c,h,f,g,M,S,C,d,p,m,E,O;return{setters:[function(e){n=e.applyDecoratedDescriptor,t=e.inheritsLoose,a=e.initializerDefineProperty,o=e.assertThisInitialized},function(e){i=e.cclegacy,s=e._decorator,r=e.Camera,u=e.Prefab,l=e.Node,c=e.instantiate,h=e.Vec3,f=e.Component},function(e){g=e.MafiaMenu},function(e){M=e.MafiaGameState},function(e){S=e.RoomStatusChangeEvent},function(e){C=e.GameStateChangeEvent},function(e){d=e.ConnectionStateChangeEvent,p=e.ServerMessageEvent},function(e){m=e.MafiaNetworkEvents,E=e.MafiaConnectionState},function(e){O=e.MafiaRoomStatus}],execute:function(){var A,N,_,R,I,G,T,b,w,y,v,U;i._RF.push({},"a805dDOrVBG5KVSZZ4CAGEg","Mafia_UIManager",void 0);var P=s.ccclass,D=s.property;e("MafiaUIManager",(A=P("MafiaUIManager"),N=D({type:r}),_=D({type:[g]}),R=D({type:u}),I=D({type:l}),A(((U=function(e){function n(){for(var n,t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return n=e.call.apply(e,[this].concat(i))||this,a(n,"uiCamera",b,o(n)),a(n,"menus",w,o(n)),a(n,"showerConfettiPrefab",y,o(n)),a(n,"confettiPositionNode",v,o(n)),n.showMuteButton=!0,n.showResultScreen=!0,n.showFAQ=!0,n}t(n,e);var i=n.prototype;return i.onLoad=function(){n.instance=this,d.on(m.CONNECTION_STATE_CHANGE,this.onConnectionStateChange,this),S.on(m.ROOM_STATUS_CHANGE,this.onRoomStatusChange,this),p.on(m.SERVER_MESSAGE,this.onServerMessage,this),C.on(m.GAME_STATE_CHANGE,this.onGameStateChange,this)},i.onDestroy=function(){this.cleanup()},i.cleanup=function(){d.off(m.CONNECTION_STATE_CHANGE,this.onConnectionStateChange,this),S.off(m.ROOM_STATUS_CHANGE,this.onRoomStatusChange,this),p.off(m.SERVER_MESSAGE,this.onServerMessage,this),C.off(m.GAME_STATE_CHANGE,this.onGameStateChange,this),n.instance===this&&(n.instance=null)},i.start=function(){this.OpenMenu("InGameMenu")},i.onCameraOrthoSizeChange=function(e){console.log("[UIManager] Camera ortho size changed: ",e),this.uiCamera.orthoHeight=e},i.OpenHowToPlay=function(){this.OpenMenu("HowToPlay")},i.OpenMenu=function(e){for(var n=0;n<this.menus.length;n++)this.menus[n].menuName==e&&this.menus[n].Open()},i.CloseMenu=function(e){for(var n=0;n<this.menus.length;n++)this.menus[n].menuName==e&&this.menus[n].Close()},i.GetMenu=function(e){for(var n=0;n<this.menus.length;n++)if(this.menus[n].menuName==e)return this.menus[n];return null},i.CloseAllMenus=function(){for(var e=0;e<this.menus.length;e++)this.menus[e].Close()},i.onConnectionStateChange=function(e,n){switch(console.log("[UIManager] Connection state changed: ",n),n){case E.CONNECTING:this.CloseAllMenus(),this.OpenMenu("InGameMenu")}},i.onGameStateChange=function(e){switch(e){case M.START_ROUND:this.handleStartRoundState();break;case M.CATEGORY_SELECTION:this.handleCategorySelectionState();break;case M.PREPARATION:this.handlePreparationState();break;case M.WORD_DESCRIPTION:this.handleWordDescriptionState();break;case M.DISCUSSION:this.handleDiscussionState();break;case M.VOTING:this.handleVotingState();break;case M.END_ROUND:case M.GAME_OVER:this.handleEndRoundState()}},i.handleStartRoundState=function(){console.log("[UIManager] Handling start round state"),this.CloseAllMenus(),this.OpenMenu("StartRoundScreen")},i.handleEndRoundState=function(){console.log("[UIManager] Handling end round state"),this.CloseAllMenus(),this.OpenMenu("EndRoundScreen")},i.handleCategorySelectionState=function(){console.log("[UIManager] Handling category selection state"),this.CloseAllMenus(),this.OpenMenu("CategorySelectionScreen")},i.handlePreparationState=function(){console.log("[UIManager] Handling preparation state"),this.CloseAllMenus(),this.OpenMenu("PreparationScreen")},i.handleWordDescriptionState=function(){console.log("[UIManager] Handling word description state"),this.CloseAllMenus(),this.OpenMenu("WordDescriptionScreen")},i.handleVotingState=function(){console.log("[UIManager] Handling voting state"),this.CloseAllMenus(),this.OpenMenu("VotingScreen")},i.handleDiscussionState=function(){console.log("[UIManager] Handling discussion state"),this.CloseAllMenus(),this.OpenMenu("DiscussionScreen")},i.onServerMessage=function(e,n){},i.onRoomStatusChange=function(e,n){var t=this;switch(console.log("[UIManager] Room status changed: ",n),n){case O.WAITING_FOR_PLAYERS:console.log("Opening waiting screen"),this.OpenMenu("WaitingScreen");break;case O.COUNTDOWN:console.log("Opening countdown screen"),this.CloseAllMenus(),this.OpenMenu("CountDownScreen");break;case O.GAME_SIMULATION:this.scheduleOnce((function(){t.CloseMenu("CountdownScreen"),t.OpenMenu("InGameMenu")}),1);break;case O.END_GAME:break;default:console.warn("[UIManager] Unhandled RoomStatus: "+n)}},i.showConfetti=function(){if(this.showerConfettiPrefab&&this.confettiPositionNode){var e=c(this.showerConfettiPrefab);this.confettiPositionNode.addChild(e),e.setPosition(new h(0,150,0))}},n}(f)).instance=null,b=n((T=U).prototype,"uiCamera",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=n(T.prototype,"menus",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),y=n(T.prototype,"showerConfettiPrefab",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=n(T.prototype,"confettiPositionNode",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=T))||G));i._RF.pop()}}}));

System.register("chunks:///_virtual/Mafia_Utils.ts",["cc"],(function(t){var n;return{setters:[function(t){n=t.cclegacy}],execute:function(){n._RF.push({},"e9fc6hX28NAMo5e+sZM6ukk","Mafia_Utils",void 0);t("MafiaUtils",function(){function t(){}return t.roundNumber=function(t,n){void 0===n&&(n=2);var u=Math.pow(10,n);return Math.round((t+Number.EPSILON)*u)/u},t}());n._RF.pop()}}}));

System.register("chunks:///_virtual/Mafia_VotingScreen.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Mafia_Menu.ts","./Mafia_Player.ts","./MafiaGameHandler.ts","./Mafia_NetworkManager.ts","./Mafia_NetworkTypes.ts"],(function(e){var i,t,a,r,n,o,l,s,c,f,p,u,h,y,m;return{setters:[function(e){i=e.applyDecoratedDescriptor,t=e.inheritsLoose,a=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){n=e.cclegacy,o=e._decorator,l=e.Label,s=e.Node,c=e.Prefab,f=e.instantiate},function(e){p=e.MafiaMenu},function(e){u=e.MafiaPlayer},function(e){h=e.MafiaGameHandler},function(e){y=e.ServerRoomStateChangeEvent},function(e){m=e.MafiaNetworkEvents}],execute:function(){var g,b,S,v,d,M,P,z,C;n._RF.push({},"5c988B1YEtKMrDLkvStEf29","Mafia_VotingScreen",void 0);var _=o.ccclass,E=o.property;e("MafiaVotingScreen",(g=_("MafiaVotingScreen"),b=E({type:l,tooltip:"Timer label"}),S=E({type:s,tooltip:"Container for players"}),v=E({type:c,tooltip:"Prefab for voting player"}),g((P=i((M=function(e){function i(){for(var i,t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return i=e.call.apply(e,[this].concat(n))||this,a(i,"timerLabel",P,r(i)),a(i,"playersContainer",z,r(i)),a(i,"playerPrefab",C,r(i)),i.players=[],i.isInitialized=!1,i.timer=0,i}t(i,e);var n=i.prototype;return n.onEnable=function(){y.on(m.SERVER_ROOM_STATE_CHANGE,this.onServerRoomStateChange,this);var e=h.Instance.getRoomState();e&&this.initializeScreen(e)},n.onDisable=function(){y.off(m.SERVER_ROOM_STATE_CHANGE,this.onServerRoomStateChange,this),this.isInitialized=!1,this.players=[]},n.update=function(e){this.updateTimer(e),this.updateTimerDisplay()},n.onServerRoomStateChange=function(e){var i=h.Instance.getRoomState();i?this.initializeScreen(i):(console.warn("[VotingScreen] Processed state not available, falling back to raw state"),this.initializeScreen(e))},n.initializeScreen=function(e){this.isInitialized?this.players.forEach((function(i){i.onServerRoomStateChange(e),i.updateVoteDisplay(e)})):(this.initializePlayers(e),this.isInitialized=!0),this.timer=e.votingTimer},n.initializePlayers=function(e){var i=this;this.playersContainer&&this.playerPrefab&&(this.playersContainer.removeAllChildren(),this.players=[],e.playersData.forEach((function(t){var a=f(i.playerPrefab);i.playersContainer.addChild(a);var r=a.getComponent(u);r?(r.isVotingPlayer=!0,r.initialize(e,t),r.updateVoteDisplay(e),i.players.push(r),h.Instance.registerPlayer(r)):console.error("Player prefab missing MafiaPlayer component")})))},n.updateTimer=function(e){this.timer=Math.max(0,this.timer-e)},n.updateTimerDisplay=function(){if(this.timerLabel){var e=Math.floor(this.timer),i=e%60,t=Math.floor(e/60)+":"+(i<10?"0"+i:""+i);this.timerLabel.string=t}},i}(p)).prototype,"timerLabel",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=i(M.prototype,"playersContainer",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=i(M.prototype,"playerPrefab",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=M))||d));n._RF.pop()}}}));

System.register("chunks:///_virtual/Mafia_WaitingScreen.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Mafia_Menu.ts"],(function(e){var n,i,t,a;return{setters:[function(e){n=e.inheritsLoose},function(e){i=e.cclegacy,t=e._decorator},function(e){a=e.MafiaMenu}],execute:function(){var r;i._RF.push({},"16b50I2dNVB9Z0Y9XMNdt/e","Mafia_WaitingScreen",void 0);var c=t.ccclass;t.property,e("MafiaWaitingScreen",c("MafiaWaitingScreen")(r=function(e){function i(){return e.apply(this,arguments)||this}return n(i,e),i}(a))||r);i._RF.pop()}}}));

System.register("chunks:///_virtual/Mafia_WordDescriptionScreen.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Mafia_Menu.ts","./Mafia_Player.ts","./MafiaGameHandler.ts","./Mafia_NetworkManager.ts","./Mafia_NetworkTypes.ts"],(function(e){var t,i,r,n,o,a,l,s,p,c,u,d,f,g,b,h,y,S,m;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,r=e.initializerDefineProperty,n=e.assertThisInitialized},function(e){o=e.cclegacy,a=e._decorator,l=e.Node,s=e.Prefab,p=e.RichText,c=e.SpriteFrame,u=e.Label,d=e.instantiate,f=e.Sprite,g=e.UITransform},function(e){b=e.MafiaMenu},function(e){h=e.MafiaPlayer},function(e){y=e.MafiaGameHandler},function(e){S=e.ServerRoomStateChangeEvent},function(e){m=e.MafiaNetworkEvents}],execute:function(){var I,v,C,w,z,k,W,A,R,D,L,T,P,M,E,_,B,U,F,N,O,x,G,H,V,Y,j,K,X,q,J;o._RF.push({},"b9dd67SajxB973UHAenpXcV","Mafia_WordDescriptionScreen",void 0);var Q=a.ccclass,Z=a.property;e("MafiaWordDescriptionScreen",(I=Q("MafiaWordDescriptionScreen"),v=Z({type:l,tooltip:"Container for first row of players"}),C=Z({type:l,tooltip:"Container for second row of players"}),w=Z({type:s,tooltip:"Prefab for player"}),z=Z({type:l,tooltip:"Container for role and word display"}),k=Z({type:p,tooltip:"Label for role and word"}),W=Z({type:l,tooltip:"Container to resize for role and word"}),A=Z({type:l,tooltip:"Speaker indicator background"}),R=Z({type:l,tooltip:"Speaker Icon Node"}),D=Z({type:c,tooltip:"Sprite for self speaking"}),L=Z({type:c,tooltip:"Sprite for other speaking"}),T=Z({type:u,tooltip:"Speaker label text"}),P=Z({type:u,tooltip:"Timer label"}),M=Z({type:u,tooltip:"Instruction title"}),E=Z({type:u,tooltip:"Instruction description"}),I((U=t((B=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return t=e.call.apply(e,[this].concat(o))||this,r(t,"playersFirstRow",U,n(t)),r(t,"playersSecondRow",F,n(t)),r(t,"playerPrefab",N,n(t)),r(t,"roleAndWordContainerBg",O,n(t)),r(t,"roleAndWordLabel",x,n(t)),r(t,"roleAndWordContainer",G,n(t)),r(t,"speakerIndicatorBg",H,n(t)),r(t,"speakingIndicatorIcon",V,n(t)),r(t,"selfSpeakingSprite",Y,n(t)),r(t,"otherSpeakingSprite",j,n(t)),r(t,"speakerLabel",K,n(t)),r(t,"timerLabel",X,n(t)),r(t,"instructionTitle",q,n(t)),r(t,"instructionDescription",J,n(t)),t.players=[],t.isInitialized=!1,t.timer=0,t}i(t,e);var o=t.prototype;return o.onEnable=function(){S.on(m.SERVER_ROOM_STATE_CHANGE,this.onServerRoomStateChange,this);var e=y.Instance.getRoomState();e&&this.initializeScreen(e)},o.onDisable=function(){S.off(m.SERVER_ROOM_STATE_CHANGE,this.onServerRoomStateChange,this),this.isInitialized=!1,this.players=[]},o.update=function(e){this.updateTimer(e),this.updateTimerDisplay()},o.onServerRoomStateChange=function(e){var t=y.Instance.getRoomState();t?this.initializeScreen(t):(console.warn("[WordDescriptionScreen] Processed state not available, falling back to raw state"),this.initializeScreen(e))},o.initializeScreen=function(e){var t;this.isInitialized?this.players.forEach((function(t){return t.onServerRoomStateChange(e)})):(this.initializePlayers(e),this.isInitialized=!0);var i=null==(t=e.playersData)?void 0:t.find((function(t){return t.userId===e.describingPlayerId}));i&&(this.timer=i.descriptionTimer),this.updateRoleAndWordUI(e),this.updateSpeakerIndicator(e),this.updateInstructions(e)},o.initializePlayers=function(e){var t=this;(this.playersFirstRow.removeAllChildren(),this.playersSecondRow.removeAllChildren(),this.players=[],e.playersData)?[].concat(e.playersData).sort((function(e,t){return e&&t?(e.playerNumber||0)-(t.playerNumber||0):0})).forEach((function(i,r){if(i){var n=d(t.playerPrefab);r<4?t.playersFirstRow.addChild(n):t.playersSecondRow.addChild(n);var o=n.getComponent(h);o?(o.initialize(e,i),t.players.push(o),y.Instance.registerPlayer(o)):console.error("Player prefab missing MafiaPlayer component")}else console.error("[WordDescriptionState] Player data is null/undefined at index "+r)})):console.error("[WordDescriptionState] roomState.playersData is missing")},o.updateRoleAndWordUI=function(e){var t=this;if(this.roleAndWordContainerBg&&this.roleAndWordLabel){var i=y.Instance.getLocalUserId(),r=i===e.currentSpyUserId,n=this.roleAndWordContainerBg.getComponent(f);if(r)this.roleAndWordLabel.string="YOU ARE THE SPY",n&&(n.color=y.Instance.spyColor);else{var o,a="WAITING",l=null==(o=e.playersData)?void 0:o.find((function(e){return e.userId===i}));if(l)a=l.describingWord;else{var s,p=null==(s=e.playersData)?void 0:s.filter((function(t){return t.userId!==e.currentSpyUserId})),c=null==p?void 0:p.find((function(e){return e.describingWord&&e.describingWord.length>0}));c&&(a=c.describingWord)}this.roleAndWordLabel.string="<color=#FFFFFFB3><size=35>WORD: </size></color><b><size=45>"+a.toUpperCase()+"</size></b>",n&&(n.color=y.Instance.villagersColor)}this.scheduleOnce((function(){if(t.roleAndWordContainer&&t.roleAndWordLabel&&t.roleAndWordContainerBg){var e=t.roleAndWordLabel.node.getComponent(g),i=t.roleAndWordContainer.getComponent(g),r=t.roleAndWordContainerBg.getComponent(g);if(e&&i&&r){var n=e.width+80;n>i.width&&(i.setContentSize(n,i.height),r.setContentSize(n,r.height))}}}),0),this.roleAndWordContainerBg.active=!0}},o.updateSpeakerIndicator=function(e){if(this.speakerIndicatorBg&&this.speakerLabel){var t=y.Instance.getLocalUserId(),i=t===e.currentSpyUserId,r=e.describingPlayerId,n=this.speakerIndicatorBg.getComponent(f);if(n&&(n.color=i?y.Instance.spyColor:y.Instance.villagersColor),r===t)this.speakerLabel.string="YOUR TURN TO SPEAK";else{var o,a=null==(o=e.playersData)?void 0:o.find((function(e){return e.userId===r})),l=a?y.Instance.getDisplayName(a.userId).toUpperCase():"WAITING";this.speakerLabel.string=l+" IS SPEAKING"}var s=r===t;if(this.speakingIndicatorIcon){var p=this.speakingIndicatorIcon.getComponent(f),c=this.speakingIndicatorIcon.getComponent(g);p&&(p.spriteFrame=s?this.selfSpeakingSprite:this.otherSpeakingSprite),c&&(s?c.setContentSize(60,60):c.setContentSize(50,60))}this.speakerIndicatorBg.active=!0}},o.updateTimer=function(e){this.timer=Math.max(0,this.timer-e)},o.updateTimerDisplay=function(){if(this.timerLabel){var e=""+Math.floor(this.timer);this.timerLabel.string=e}},o.updateInstructions=function(e){this.instructionTitle&&this.instructionDescription&&(y.Instance.getLocalUserId()===e.describingPlayerId?(this.instructionTitle.string="Say one clue word",this.instructionDescription.string="1-2 words max Â· Don't be too obvious"):(this.instructionTitle.string="Listen carefully",this.instructionDescription.string="Pay attention to their clue!"))},t}(b)).prototype,"playersFirstRow",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=t(B.prototype,"playersSecondRow",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=t(B.prototype,"playerPrefab",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=t(B.prototype,"roleAndWordContainerBg",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=t(B.prototype,"roleAndWordLabel",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=t(B.prototype,"roleAndWordContainer",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=t(B.prototype,"speakerIndicatorBg",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=t(B.prototype,"speakingIndicatorIcon",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=t(B.prototype,"selfSpeakingSprite",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=t(B.prototype,"otherSpeakingSprite",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=t(B.prototype,"speakerLabel",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=t(B.prototype,"timerLabel",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=t(B.prototype,"instructionTitle",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=t(B.prototype,"instructionDescription",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=B))||_));o._RF.pop()}}}));

System.register("chunks:///_virtual/MafiaGameHandler.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Mafia_GameMessageType.ts","./Mafia_RoomState.ts","./Mafia_GameState.ts","./MiloGameSDK.ts","./Mafia_PBLogger.ts","./Mafia_NetworkManager.ts","./Mafia_NetworkTypes.ts","./Mafia_RoomTypes.ts","./Mafia_GameManager.ts"],(function(e){var t,n,o,i,r,a,s,c,u,l,h,f,m,S,g,d,E,R,G,p,v,y,I,C,N,M;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,o=e.initializerDefineProperty,i=e.assertThisInitialized,r=e.createClass},function(e){a=e.cclegacy,s=e._decorator,c=e.EventTarget,u=e.Color,l=e.game,h=e.Game,f=e.Tween,m=e.Component},function(e){S=e.MafiaGameMessageType},function(e){g=e.MafiaRoomState},function(e){d=e.MafiaGameState},function(e){E=e.MiloGameSDK},function(e){R=e.MafiaPBLogger},function(e){G=e.ConnectionStateChangeEvent,p=e.ServerRoomStateChangeEvent,v=e.ServerMessageEvent,y=e.MafiaNetworkManager},function(e){I=e.MafiaNetworkEvents,C=e.MafiaConnectionState},function(e){N=e.MafiaRoomStatus},function(e){M=e.MafiaGameManager}],execute:function(){var T,_,D,w,O,A,b,P,H;a._RF.push({},"87cedknW3FJRbtrrFF3SX9G","MafiaGameHandler",void 0);var L=s.ccclass,k=s.property,z=s.executionOrder,K="[MafiaGameHandler]",U=e("GameStateChangeEvent",new c);e("MafiaGameHandler",(T=L("MafiaGameHandler"),_=z(-1),D=k({type:u,tooltip:"Color for the spy"}),w=k({type:u,tooltip:"Color for the villagers"}),T(O=_(((H=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,o(t,"spyColor",b,i(t)),o(t,"villagersColor",P,i(t)),t.players=[],t.miloSDK=new E,t.currentRoomState=null,t.roomSettings=null,t.myPlayerNumber=-1,t.hasReconnected=!1,t.localPlayerId="",t}n(t,e);var a=t.prototype;return a.onLoad=function(){t._instance&&this.node.destroy(),t._instance=this,this.registerEventListeners()},a.onDestroy=function(){this.cleanup()},a.cleanup=function(){this.unregisterNetworkEvents(),this.unregisterGameEvents(),this.unregisterOnBrowserClose(),t._instance===this&&(t._instance=null)},a.initialize=function(e){this.roomSettings=e,this.logInfo("Initialized with room settings",e)},a.registerEventListeners=function(){this.registerNetworkEvents(),this.registerGameEvents(),this.registerOnBrowserClose()},a.unregisterEventListeners=function(){this.unregisterNetworkEvents(),this.unregisterGameEvents(),this.unregisterOnBrowserClose()},a.registerNetworkEvents=function(){G.on(I.CONNECTION_STATE_CHANGE,this.onConnectionStateChange,this),p.on(I.SERVER_ROOM_STATE_CHANGE,this.onServerRoomStateChange,this),v.on(I.SERVER_MESSAGE,this.onServerMessage,this)},a.unregisterNetworkEvents=function(){G.off(I.CONNECTION_STATE_CHANGE,this.onConnectionStateChange,this),p.off(I.SERVER_ROOM_STATE_CHANGE,this.onServerRoomStateChange,this),v.off(I.SERVER_MESSAGE,this.onServerMessage,this)},a.registerGameEvents=function(){l.on(h.EVENT_HIDE,this.onGameHide,this),l.on(h.EVENT_SHOW,this.onGameShow,this),l.on(h.EVENT_RESTART,this.onGameRestart,this),l.on(h.EVENT_CLOSE,this.onGameClose,this)},a.unregisterGameEvents=function(){l.off(h.EVENT_HIDE,this.onGameHide,this),l.off(h.EVENT_SHOW,this.onGameShow,this),l.off(h.EVENT_RESTART,this.onGameRestart,this),l.off(h.EVENT_CLOSE,this.onGameClose,this)},a.registerOnBrowserClose=function(){window.addEventListener("beforeunload",this.onGameClose.bind(this))},a.unregisterOnBrowserClose=function(){window.removeEventListener("beforeunload",this.onGameClose.bind(this))},a.onServerMessage=function(e,t){this.logInfo("Server message received:",{type:e,message:t}),this.logInfo("Unhandled server message type:",e)},a.onServerRoomStateChange=function(e){if(this.currentRoomState){var t=this.currentRoomState.currentGameState;this.currentRoomState.copyFrom(e);var n=this.currentRoomState.currentGameState;this.handleMicLockingForDescriptionState(t,n),this.hasReconnected?this.handleReconnection(this.currentRoomState):this.currentRoomState.currentRoomStatus!==N.END_GAME?this.handleRoomStateUpdate(this.currentRoomState):this.handleEndGameState()}else this.initializeRoomState(e)},a.onConnectionStateChange=function(e,t){t===C.DISCONNECTED?this.onGameDisconnect():e===C.RECONNECTING&&t===C.JOINED_ROOM&&(this.hasReconnected=!0,this.onGameReconnect())},a.onGameHide=function(){this.logInfo("Game hidden"),f.stopAll()},a.onGameShow=function(){this.logInfo("Game shown")},a.onGameRestart=function(){this.logInfo("Game restarted")},a.onGameClose=function(){this.logInfo("Game closed")},a.onGameDisconnect=function(){this.logInfo("Game disconnected")},a.onGameReconnect=function(){this.logInfo("Game reconnected")},a.initializeRoomState=function(e){e?(this.currentRoomState=new g,this.currentRoomState.copyFrom(e),this.isLocalUserSpectator()||this.currentRoomState.currentGameState!==d.WORD_DESCRIPTION||this.miloSDK.lockMic(),this.initializeGameComponents(this.currentRoomState),this.currentRoomState.currentGameState!==d.NONE&&(this.logInfo("Joined game in progress with state:",this.currentRoomState.currentGameState),this.sendReconnectionStateToAllPlayers(this.currentRoomState))):this.logError("Attempted to initialize with null room state")},a.initializeGameComponents=function(e){this.assignMyPlayerNumber(e)},a.handleEndGameState=function(){this.logInfo("Game Over - State Change:",this.currentRoomState),this.currentRoomState&&this.currentRoomState.currentGameState!==d.NONE&&U.emit(I.GAME_STATE_CHANGE,this.currentRoomState.currentGameState)},a.handleReconnection=function(e){this.logInfo("Reconnection State Change:",e),this.assignMyPlayerNumber(e),this.isLocalUserSpectator()||e.currentGameState!==d.WORD_DESCRIPTION||this.miloSDK.lockMic(),this.sendReconnectionStateToAllPlayers(e),this.hasReconnected=!1},a.handleRoomStateUpdate=function(e){this.logInfo("Game State Change:",e.currentGameState),e.inputPayload.inputType===S.SET_STATE&&this.handleSetState(e)},a.handleSetState=function(e){this.logInfo("Handling SET STATE"),this.logInfo("Game State Change:",e.currentGameState),U.emit(I.GAME_STATE_CHANGE,e.currentGameState)},a.registerPlayer=function(e){-1===this.players.indexOf(e)&&this.players.push(e)},a.clearPlayers=function(){this.players=[]},a.updatePlayerScores=function(){var e=this;this.currentRoomState&&[].concat(this.currentRoomState.playersData).sort((function(e,t){return t.score-e.score})).forEach((function(t,n){var o=e.players.find((function(e){return e.userId===t.userId}));o&&o.node&&(o.setScore(t.score),o.setRank(n+1),o.node.setSiblingIndex(n))}))},a.getPlayer=function(e){if(e)return this.players.find((function(t){return t.userId===e}));this.logWarning("Attempted to get player with empty ID")},a.assignMyPlayerNumber=function(e){var t=this;e.playersData.forEach((function(e,n){e.sessionId===y.Instance.CurrentRoom.sessionId&&(t.myPlayerNumber=n,t.localPlayerId=e.userId)}))},a.getLocalUserId=function(){var e;if(!this.currentRoomState||null==(e=y.Instance)||!e.CurrentRoom)return"";var t=y.Instance.CurrentRoom.sessionId,n=this.currentRoomState.playersData.find((function(e){return e.sessionId===t}));return n?n.userId:""},a.isLocalUserSpectator=function(){var e,t;if(!this.currentRoomState||null==(e=y.Instance)||!e.CurrentRoom)return!1;var n=y.Instance.CurrentRoom.sessionId;return!(null==(t=this.currentRoomState.spectatorsData)||!t.find((function(e){return e.sessionId===n})))},a.getDisplayName=function(e,t,n){var o;void 0===t&&(t=8),void 0===n&&(n=!0);var i=this.getLocalUserId();if(n&&i&&i===e)return"YOU";var r=this.getContactName(e);if(r&&""!==r.trim())return t>0?this.truncateName(r,t):r;var a=null==(o=this.currentRoomState)?void 0:o.playersData.find((function(t){return t.userId===e})),s=a?a.name:"";return t>0?this.truncateName(s,t):s},a.truncateName=function(e,t){var n=e.indexOf(" ");return-1!=n&&(e=e.substring(0,n)),e.length>t?e.substring(0,t)+"..":e},a.getPlayerName=function(e){return this.getDisplayName(e)},a.getContactName=function(e){var t;if(!e||null==(t=M.Instance)||!t.miloSDK)return null;var n=M.Instance.miloSDK.getContactName(e);return n&&""!==n.trim()?n:null},a.sendReconnectionStateToAllPlayers=function(e){this.logInfo("Sending reconnection state to all players, current game state:",e.currentGameState),this.players.forEach((function(t){t.onReconnection(e)})),e.currentGameState!==d.NONE&&U.emit(I.GAME_STATE_CHANGE,e.currentGameState)},a.getRoomState=function(){return this.currentRoomState},a.isMyTurn=function(){return!1},a.allPlayersFinished=function(){return!1},a.anyPlayerFinished=function(){return!1},a.sendChatMessageToServer=function(e){},a.logInfo=function(e,t){R.info(K+" "+e,t)},a.logError=function(e,t){R.error(K+" "+e,t)},a.logWarning=function(e,t){R.warning(K+" "+e,t)},a.logDebug=function(e,t){R.debug(K+" "+e,t)},a.log=function(e,t,n){void 0===n&&(n="info");var o=K+" "+e;switch(n){case"error":R.error(o,t);break;case"warn":R.warning(o,t);break;case"debug":R.debug(o,t);break;default:R.info(o,t)}},a.isLocalUserHost=function(){var e;if(null==(e=M.Instance)||!e.miloSDK)return!1;var t=M.Instance.miloSDK.getHostId(),n=this.getLocalUserId();return n?t===n:(this.logWarning("Local user ID not available"),!1)},a.getHostPlayer=function(){var e;if(null==(e=M.Instance)||!e.miloSDK)return null;var t=M.Instance.miloSDK.getHostId();return this.getPlayer(t)||null},a.handleMicLockingForDescriptionState=function(e,t){e!==t&&(this.isLocalUserSpectator()||(t===d.WORD_DESCRIPTION?(this.logInfo("Entering Description State: Locking Mic"),this.miloSDK.lockMic()):e===d.WORD_DESCRIPTION&&(this.logInfo("Leaving Description State: Unlocking Mic"),this.miloSDK.unlockMic())))},r(t,null,[{key:"Instance",get:function(){if(!this._instance)throw R.error(K+" instance not initialized"),new Error("MafiaGameHandler instance not initialized");return this._instance}}]),t}(m))._instance=null,b=t((A=H).prototype,"spyColor",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new u(255,0,0,255)}}),P=t(A.prototype,"villagersColor",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new u(0,0,255,255)}}),O=A))||O)||O));a._RF.pop()}}}));

System.register("chunks:///_virtual/RoundedMask.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var i,s,e,n,o,r,a,h,p,u,c,d,l;return{setters:[function(t){i=t.applyDecoratedDescriptor,s=t.inheritsLoose,e=t.initializerDefineProperty,n=t.assertThisInitialized,o=t.createClass},function(t){r=t.cclegacy,a=t._decorator,h=t.Mask,p=t.UITransform,u=t.Node,c=t.Graphics,d=t.Color,l=t.Component}],execute:function(){var m,f,C,y,k,g,M,_,E;r._RF.push({},"c0323HYbLtIIZGiuCZ7Fm65","RoundedMask",void 0);var I=a.ccclass,R=a.property,T=a.executeInEditMode,v=a.requireComponent,H=a.menu;t("RoundedMask",(m=I("RoundedMask"),f=v(h),C=v(p),y=H("UI/RoundedMask"),k=R({tooltip:"Border Radius in pixels"}),g=R({tooltip:"Border Radius in pixels"}),m(M=T(M=f(M=C(M=y((E=i((_=function(t){function i(){for(var i,s=arguments.length,o=new Array(s),r=0;r<s;r++)o[r]=arguments[r];return i=t.call.apply(t,[this].concat(o))||this,e(i,"_radius",E,n(i)),i.mask=null,i.graphics=null,i.transform=null,i}s(i,t);var r=i.prototype;return r.onLoad=function(){this.initComponents()},r.onEnable=function(){this.initComponents(),this.node.on(u.EventType.SIZE_CHANGED,this.updateMask,this),this.node.on(u.EventType.ANCHOR_CHANGED,this.updateMask,this),this.updateMask()},r.onDisable=function(){this.node.off(u.EventType.SIZE_CHANGED,this.updateMask,this),this.node.off(u.EventType.ANCHOR_CHANGED,this.updateMask,this)},r.initComponents=function(){this.transform||(this.transform=this.getComponent(p)),this.mask||(this.mask=this.getComponent(h)),this.mask&&(this.mask.type=h.Type.GRAPHICS_STENCIL,this.graphics||(this.graphics=this.getComponent(c)),this.graphics||(this.graphics=this.addComponent(c)))},r.updateMask=function(){if(this.mask&&this.graphics&&this.transform||(this.initComponents(),this.mask&&this.graphics&&this.transform)){this.mask.type!==h.Type.GRAPHICS_STENCIL&&(this.mask.type=h.Type.GRAPHICS_STENCIL);var t=this.transform.contentSize,i=t.width,s=t.height,e=this.transform.anchorPoint,n=Math.min(i,s)/2,o=Math.max(0,Math.min(this._radius,n)),r=-i*e.x,a=-s*e.y;this.graphics.clear(),this.graphics.fillColor=d.WHITE,this.graphics.roundRect(r,a,i,s,o),this.graphics.fill()}},o(i,[{key:"radius",get:function(){return this._radius},set:function(t){this._radius!==t&&(this._radius=t,this.updateMask())}}]),i}(l)).prototype,"_radius",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),i(_.prototype,"radius",[g],Object.getOwnPropertyDescriptor(_.prototype,"radius"),_.prototype),M=_))||M)||M)||M)||M)||M));r._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/mafia_game', 'chunks:///_virtual/mafia_game'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});