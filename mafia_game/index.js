System.register("chunks:///mafia_game.js",["./rollupPluginModLoBabelHelpers-5eee144e.js","cc","./colyseus.mjs_cjs=&original=-07c08717.js"],(function(){var t,e,n,i,o,r,a,s,l,c,u,h,p,d,f,g,m,y,v,S,C,T,b,R,_,E,I,w,A,N,O,P,L,M,D,k,G,F,z,H,V,B,U,W,x,Y,K,J,j;return{setters:[function(l){t=l._,e=l.a,n=l.b,i=l.c,o=l.h,r=l.d,a=l.f,s=l.g},function(t){l=t.cclegacy,c=t._decorator,u=t.sys,h=t.Component,p=t.EventTarget,d=t.CCBoolean,f=t.UITransform,g=t.Camera,m=t.screen,y=t.view,v=t.math,S=t.director,C=t.Director,T=t.Widget,b=t.Enum,R=t.Size,_=t.Node,E=t.Vec3,I=t.Label,w=t.Sprite,A=t.assetManager,N=t.SpriteFrame,O=t.Texture2D,P=t.CCInteger,L=t.Button,M=t.Prefab,D=t.Color,k=t.instantiate,G=t.tween,F=t.game,z=t.Game,H=t.Tween,V=t.CCString,B=t.AudioClip,U=t.CCFloat,W=t.AudioSource,x=t.Layout,Y=t.UIOpacity,K=t.Animation},function(t){J=t._,j=t.M}],execute:function(){l._RF.push({},"1f240GvJhZCS7g77Mtiwwuo","Mafia_PBLogger",void 0);var X,Z,Q,q,$,tt,et,nt,it,ot,rt,at,st,lt,ct,ut=function(t){return t[t.Debug=0]="Debug",t[t.Info=1]="Info",t[t.Warning=2]="Warning",t[t.Error=3]="Error",t}({}),ht=function(){function t(){}return t.debug=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];this.log(ut.Debug,t,n)},t.info=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];this.log(ut.Info,t,n)},t.warning=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];this.log(ut.Warning,t,n)},t.error=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];this.log(ut.Error,t,n)},t.log=function(t,e,n){if(t>=this.currentLevel){var i,o=ut[t]+": "+e;if((i=console).log.apply(i,[o].concat(n)),this.isProduction&&window.ReactNativeWebView)try{var r={type:"log",level:ut[t],message:o,params:n};window.ReactNativeWebView&&window.ReactNativeWebView.postMessage(JSON.stringify(r))}catch(t){console.error("Failed to send log to ReactNativeWebView:",t)}}},t.setLevel=function(t){this.currentLevel=t},t.setProductionMode=function(t){this.isProduction=t},t}();ht.currentLevel=ut.Debug,ht.isProduction=!1,l._RF.pop(),l._RF.push({},"75bbeEbPABFnrzgARe30U1N","Mafia_NetworkConfig",void 0);var pt=c.ccclass,dt=c.property,ft=(X=pt("MafiaNetworkConfig"),Z=dt({tooltip:"Server host address"}),Q=dt({tooltip:"Server port number"}),q=dt({tooltip:"Use SSL for connections"}),$=dt({tooltip:"Player identifier"}),tt=dt({tooltip:"Room identifier"}),et=dt({tooltip:"Name of the game"}),X((ot=t((it=function(t){function o(){for(var e,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,n(e,"serverHost",ot,i(e)),n(e,"serverPort",rt,i(e)),n(e,"useSSL",at,i(e)),n(e,"userId",st,i(e)),n(e,"roomId",lt,i(e)),n(e,"gameName",ct,i(e)),e}e(o,t);var r=o.prototype;return r.initNetworkConfig=function(){if(u.isBrowser){var t=new URLSearchParams(window.location.search),e="true"===t.get("debug");ht.debug("Initializing network config (debug="+e+")"),e?this.parseQueryParams(t):this.parseInjectedConfig(),ht.debug("Final network config:",{serverHost:this.serverHost,serverPort:this.serverPort,useSSL:this.useSSL,userId:this.userId,roomId:this.roomId,gameName:this.gameName})}},r.parseQueryParams=function(t){var e=this;ht.debug("Parsing config from query parameters"),this.updateConfigFromQueryParam(t,"userId",(function(t){return e.userId=t})),this.updateConfigFromQueryParam(t,"roomId",(function(t){return e.roomId=t})),this.updateConfigFromQueryParam(t,"apiUrl",(function(t){return e.serverHost=t})),this.updateConfigFromQueryParam(t,"apiPort",(function(t){var n=parseInt(t);isNaN(n)||(e.serverPort=n)})),this.updateConfigFromQueryParam(t,"useSSL",(function(t){return e.useSSL="true"===t}))},r.parseInjectedConfig=function(){ht.debug("Parsing config from injected GameConfig");try{var t=window.GameConfig;if(!t)return void ht.debug("No injected GameConfig found");var e="string"==typeof t?JSON.parse(t):t;this.applyConfig(e)}catch(t){ht.debug("Failed to parse injected GameConfig:",t)}},r.applyConfig=function(t){var e,n,i,o,r;t&&(this.userId=null!=(e=t.userId)?e:this.userId,this.roomId=null!=(n=t.roomId)?n:this.roomId,this.serverHost=null!=(i=t.apiUrl)?i:this.serverHost,this.serverPort=Number(null!=(o=t.apiPort)?o:this.serverPort),this.useSSL=null!=(r=t.useSSL)?r:this.useSSL)},r.updateConfigFromQueryParam=function(t,e,n){var i=t.get(e);null!=i&&n(i)},o}(h)).prototype,"serverHost",[Z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"localhost"}}),rt=t(it.prototype,"serverPort",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2567}}),at=t(it.prototype,"useSSL",[q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),st=t(it.prototype,"userId",[$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),lt=t(it.prototype,"roomId",[tt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"testroom1"}}),ct=t(it.prototype,"gameName",[et],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"Pictionary"}}),nt=it))||nt);l._RF.pop(),l._RF.push({},"917450yHbdDfoiHLt9WC9RD","Mafia_NetworkTypes",void 0);var gt=function(t){return t[t.SERVER_ROOM_STATE_CHANGE=0]="SERVER_ROOM_STATE_CHANGE",t[t.CONNECTION_STATE_CHANGE=1]="CONNECTION_STATE_CHANGE",t[t.ROOM_STATUS_CHANGE=2]="ROOM_STATUS_CHANGE",t[t.GAME_STATE_CHANGE=3]="GAME_STATE_CHANGE",t[t.SERVER_MESSAGE=4]="SERVER_MESSAGE",t}({}),mt=function(t){return t[t.INITIALIZING=0]="INITIALIZING",t[t.CONNECTING=1]="CONNECTING",t[t.CONNECTED=2]="CONNECTED",t[t.LOBBY=3]="LOBBY",t[t.JOINED_ROOM=4]="JOINED_ROOM",t[t.DISCONNECTED=5]="DISCONNECTED",t[t.RECONNECTING=6]="RECONNECTING",t[t.KICKED_OUT=7]="KICKED_OUT",t}({}),yt=function(t){return t.NONE="none",t.KICKED_OUT="kicked_out",t.PLAYER_CAMEBACK="player_cameback",t.PLAYER_JOINED="player_joined",t}({});l._RF.pop(),l._RF.push({},"4d199WiL2xLT6KTu/5loLPp","Mafia_PlayerTypes",void 0);var vt,St=function(t){return t[t.HUMAN=0]="HUMAN",t[t.BOT=1]="BOT",t[t.SPECTATOR=2]="SPECTATOR",t}({});l._RF.pop(),l._RF.push({},"d2fa7MJJdNKspLZrCg4jToe","Mafia_PbSaveSystem",void 0);var Ct,Tt,bt,Rt,_t,Et,It,wt,At=(0,c.ccclass)("MafiaPbSaveSystem")(vt=function(){function t(){}return t.SaveData=function(t,e){ht.info("============ Saving data in pb save system ========="),u.localStorage.setItem(t,JSON.stringify(e))},t.LoadData=function(t){return JSON.parse(u.localStorage.getItem(t))},t.RemoveData=function(t){u.localStorage.removeItem(t)},t.ClearAllData=function(){u.localStorage.clear()},t}())||vt;l._RF.pop(),l._RF.push({},"3be38Y+E+RBhLFuL1FxpRfp","Mafia_NetworkManager",void 0);var Nt,Ot,Pt,Lt,Mt,Dt,kt,Gt,Ft,zt,Ht,Vt,Bt=c.ccclass,Ut=c.property,Wt={roomId:"testroom1",reconnectionToken:"eyJ"},xt=new p,Yt=new p,Kt=new p,Jt=(Ct=Bt("MafiaNetworkManager"),Tt=Ut({type:d,tooltip:"Enable development mode for additional logging"}),bt=Ut({type:ft,tooltip:"Network configuration settings"}),Ct(((wt=function(t){function l(){for(var e,r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return e=t.call.apply(t,[this].concat(a))||this,n(e,"isDevMode",Et,i(e)),n(e,"networkConfig",It,i(e)),e._client=void 0,e._room=void 0,e._currentConnectionState=mt.INITIALIZING,e._reconnectionData=o({},Wt),e}e(l,t);var c=l.prototype;return c.onLoad=function(){l._instance&&(this.log("NetworkManager instance already exists. Destroying duplicate."),this.node.destroy()),l._instance=this,this.networkConfig.initNetworkConfig(),this.isDevMode||ht.setProductionMode(!0)},c.start=function(){this.initializeClient(),ht.info("============ Initializing client ========="),ht.info("============ Connecting to room ========="),this.connect(this.networkConfig.roomId,this.networkConfig.userId)},c.onDestroy=function(){this.cleanup()},c.cleanup=function(){this._room&&(this.leaveRoom(),this._room=null),this._client&&(this._client=null),this._currentConnectionState=mt.INITIALIZING,this._reconnectionData=o({},Wt),l._instance===this&&(l._instance=null)},c.initializeClient=function(){var t=this.networkConfig.useSSL?"wss":"ws",e="";e=0==this.networkConfig.serverPort?t+"://"+this.networkConfig.serverHost:t+"://"+this.networkConfig.serverHost+":"+this.networkConfig.serverPort,this.log("Initializing client with endpoint: "+e),this._client=new J.Client(e)},c.shouldRejoin=function(){return!this.isDevMode&&(this._reconnectionData=At.LoadData(this.networkConfig.gameName),!!(this._reconnectionData&&this._reconnectionData.roomId&&this._reconnectionData.reconnectionToken)&&this._reconnectionData.roomId===this.networkConfig.roomId)},c.connect=function(){var t=a(s().mark((function t(e,n){var i;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(ht.info("============ Connecting to room from connect function ========="),this.updateConnectionState(mt.CONNECTING),!this.shouldRejoin()){t.next=7;break}return this.log("Rejoining room",e),t.next=6,this.rejoin();case 6:return t.abrupt("return");case 7:return t.prev=7,i=this.createPlayerData(n),this.log("Joining with options ",{player:i}),t.next=12,this._client.joinById(e,{player:i});case 12:this._room=t.sent,this.initAfterJoin(e),t.next=20;break;case 16:throw t.prev=16,t.t0=t.catch(7),this.handleConnectionError(t.t0),t.t0;case 20:case"end":return t.stop()}}),t,this,[[7,16]])})));return function(e,n){return t.apply(this,arguments)}}(),c.initAfterJoin=function(t){this.updateConnectionState(mt.JOINED_ROOM),this.log("Joined room "+t+" with sessionId: "+this._room.sessionId),this.initializeRoomCallbacks(),this.saveReconnectionData()},c.createAndJoinRoom=function(){var t=a(s().mark((function t(e,n){var i;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.log("Creating room",e),this.updateConnectionState(mt.CONNECTING),t.prev=2,i=this.createPlayerData(n),t.next=6,this._client.create("PictionaryRoom",{roomId:e,player:i,roomSettings:{maxClients:10}});case 6:this._room=t.sent,this.initAfterJoin(e),t.next=14;break;case 10:throw t.prev=10,t.t0=t.catch(2),this.handleConnectionError(t.t0),t.t0;case 14:case"end":return t.stop()}}),t,this,[[2,10]])})));return function(e,n){return t.apply(this,arguments)}}(),c.createPlayerData=function(t){return{userId:t,name:t,avatar:"randomProfilePicture",type:St.HUMAN}},c.initializeRoomCallbacks=function(){var t=this;console.log("============ Initializing room callbacks ========="),this._room?(this._room.onStateChange((function(t){Yt.emit(gt.SERVER_ROOM_STATE_CHANGE,t)})),this._room.onLeave((function(e){4001===e?t.updateConnectionState(mt.KICKED_OUT):t.updateConnectionState(mt.DISCONNECTED)})),this._room.onMessage(yt.KICKED_OUT,(function(){t.updateConnectionState(mt.KICKED_OUT)})),this._room.onMessage("*",(function(t,e){Kt.emit(gt.SERVER_MESSAGE,t,e)}))):this.log("Cannot initialize callbacks: Room is not defined")},c.updateConnectionState=function(t){if(this._currentConnectionState!==t){var e=this._currentConnectionState;this._currentConnectionState=t,this.log("Connection state changed: "+mt[e]+" -> "+mt[t]),xt.emit(gt.CONNECTION_STATE_CHANGE,e,t)}},c.reconnect=function(){var t=a(s().mark((function t(e,n,i){var o,r;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===e&&(e=1),void 0===n&&(n=10),void 0===i&&(i=2e3),this._currentConnectionState===mt.DISCONNECTED||this._currentConnectionState===mt.RECONNECTING){t.next=6;break}return this.log("Cannot reconnect: Current state is "+mt[this._currentConnectionState]),t.abrupt("return");case 6:return this._room&&this._room.state&&(o=this._room.state).roomSettings&&o.roomSettings.maxReconnectionAttempts&&(n=o.roomSettings.maxReconnectionAttempts),this.updateConnectionState(mt.RECONNECTING),this.log("Reconnect attempt "+e+"/"+n),t.prev=9,t.next=12,this.delay(i);case 12:if(this._room&&this._room.reconnectionToken){t.next=14;break}throw new Error("Reconnection token not available");case 14:return t.next=16,this._client.reconnect(this._room.reconnectionToken);case 16:r=t.sent,this._room=r,this.saveReconnectionData(),this.initializeRoomCallbacks(),this.updateConnectionState(mt.JOINED_ROOM),this.log("Reconnected successfully."),t.next=27;break;case 24:t.prev=24,t.t0=t.catch(9),this.handleReconnectionError(t.t0,e,n,i);case 27:case"end":return t.stop()}}),t,this,[[9,24]])})));return function(e,n,i){return t.apply(this,arguments)}}(),c.rejoin=function(){var t=a(s().mark((function t(e,n,i){var o,r;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return void 0===e&&(e=1),void 0===n&&(n=10),void 0===i&&(i=2e3),this.log("Rejoin attempt "+e+"/"+n),t.prev=4,t.next=7,this.delay(i);case 7:if(this._reconnectionData&&this._reconnectionData.reconnectionToken){t.next=9;break}throw new Error("Reconnection data not available");case 9:return o=this._reconnectionData.roomId+":"+this._reconnectionData.reconnectionToken,ht.info("Using formatted reconnection token: ",o),t.next=13,this._client.reconnect(o);case 13:r=t.sent,this._room=r,this.saveReconnectionData(),this.initializeRoomCallbacks(),this.updateConnectionState(mt.JOINED_ROOM),this.log("Rejoined successfully."),t.next=24;break;case 21:t.prev=21,t.t0=t.catch(4),this.handleReconnectionError(t.t0,e,n,i,"reJoin");case 24:case"end":return t.stop()}}),t,this,[[4,21]])})));return function(e,n,i){return t.apply(this,arguments)}}(),c.delay=function(){var t=a(s().mark((function t(e){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){return setTimeout(t,e)})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),c.handleConnectionError=function(t){var e=(null==t?void 0:t.message)||"Unknown error";this.log("Error connecting to room:",e),this.updateConnectionState(mt.DISCONNECTED)},c.handleReconnectionError=function(t,e,n,i,o){void 0===o&&(o="reconnect");var r=(null==t?void 0:t.message)||"Unknown error";this.log(o+" attempt "+e+" failed:",r),e<n||-1===n?"reconnect"===o?this.reconnect(e+1,n,i):this.rejoin(e+1,n,i):(this.log("Max reconnection attempts reached. Please check your network or contact support."),this.updateConnectionState(mt.DISCONNECTED))},c.saveReconnectionData=function(){if(ht.info("============ Saving reconnection data ========="),this._room&&this._room.reconnectionToken){var t=this._room.reconnectionToken;t.includes(":")&&(t=t.split(":")[1]),ht.info("saving Reconnection token: ",t),this._reconnectionData={roomId:this.networkConfig.roomId,reconnectionToken:t},At.SaveData(this.networkConfig.gameName,this._reconnectionData),ht.info("Reconnection data saved")}else this.log("Cannot save reconnection data: Room or reconnection token not available")},c.leaveRoom=function(){var t=this;this._room?(this.log("Leaving room"),this._room.leave(!0).then((function(){return t.log("Left room successfully")})).catch((function(e){return t.log("Error leaving room:",(null==e?void 0:e.message)||"Unknown error")}))):this.log("Cannot leave room: Room is not defined")},c.getMySessionId=function(){return this._room.sessionId},c.sendMessage=function(t,e){this._room?(this.isDevMode&&this.log("Sending message:",t,e),this._room.send(t,e)):this.log("Cannot send message: Room is not defined")},c.log=function(t){if(this.isDevMode){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];n.length>0?ht.info.apply(ht,["[NetworkManager] "+t].concat(n)):ht.info("[NetworkManager] "+t)}},r(l,[{key:"CurrentRoom",get:function(){return this._room}},{key:"CurrentConnectionState",get:function(){return this._currentConnectionState}}],[{key:"Instance",get:function(){if(!this._instance)throw new Error("NetworkManager instance is not initialized.");return this._instance}}]),l}(h))._instance=null,Et=t((_t=wt).prototype,"isDevMode",[Tt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),It=t(_t.prototype,"networkConfig",[bt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Rt=_t))||Rt);l._RF.pop(),l._RF.push({},"150f90QrSRP7bztAHTo8GP7","Mafia_CameraManger",void 0);var jt=c.ccclass,Xt=c.property;(0,c.executionOrder)(-1);var Zt,Qt,qt,$t,te,ee=(Nt=jt("MafiaCameraManger"),Ot=Xt({type:f}),Nt(((Vt=function(t){function o(){for(var e,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,n(e,"canvasUITransform",Mt,i(e)),n(e,"designHeight",Dt,i(e)),n(e,"designWidth",kt,i(e)),n(e,"defaultOrthoHeight",Gt,i(e)),n(e,"minOrthoHeight",Ft,i(e)),n(e,"maxOrthoHeight",zt,i(e)),n(e,"safeAreaPadding",Ht,i(e)),e.designAspectRatio=void 0,e.currentAspectRatio=void 0,e.camera=null,e.windowWidth=1080,e.windowHeight=1920,e}e(o,t);var r=o.prototype;return r.onLoad=function(){o.instance=this,this.designAspectRatio=this.designWidth/this.designHeight,this.camera=this.node.getComponent(g)},r.start=function(){var t=this;this.updateScreenSize(),this.adaptCameraToScreen(),window.addEventListener("resize",(function(){t.updateScreenSize(),t.adaptCameraToScreen()}))},r.update=function(t){},r.updateScreenSize=function(){this.windowWidth=m.windowSize.width||window.innerWidth,this.windowHeight=m.windowSize.height||window.innerHeight,this.currentAspectRatio=this.windowWidth/this.windowHeight,console.log("Window Size: "+this.windowWidth+"x"+this.windowHeight+", Aspect Ratio: "+this.currentAspectRatio.toFixed(2))},r.adaptCameraToScreen=function(){if(this.camera){var t=0,e=0,n=0,i=0;if(u.os===u.OS.IOS||u.os===u.OS.ANDROID){var o=y.getVisibleSize(),r=y.getVisibleOrigin();o&&(t=r.y,e=this.windowHeight-(r.y+o.height),n=r.x,i=this.windowWidth-(r.x+o.width))}console.log("safeAreaTop",t),console.log("safeAreaBottom",e),console.log("safeAreaLeft",n),console.log("safeAreaRight",i);var a=this.windowHeight-t-e-2*this.safeAreaPadding,s=this.windowWidth-n-i-2*this.safeAreaPadding,l=s/a;console.log("windowWidth",this.windowWidth),console.log("windowHeight",this.windowHeight),console.log("Effective Size: "+s+"x"+a+", Aspect Ratio: "+l.toFixed(2));var c=this.currentAspectRatio>=1,h=this.defaultOrthoHeight;if(c)console.log("=== Landscape Mode ==="),h=this.defaultOrthoHeight*(1/this.currentAspectRatio)*1.5;else{console.log("=== Portrait Mode ===");var p=.6/Math.min(this.currentAspectRatio,.6);h=this.defaultOrthoHeight*p}h=v.clamp(h,this.minOrthoHeight,this.maxOrthoHeight),this.camera.orthoHeight=h,console.log("Camera Ortho Height: "+h.toFixed(2))}},r.getWidth=function(){return 2*this.camera.orthoHeight*this.currentAspectRatio},r.getCurrentOrthoHeight=function(){return this.camera.orthoHeight},r.refreshCameraAdaptation=function(){this.updateScreenSize(),this.adaptCameraToScreen()},o}(h)).instance=null,Mt=t((Lt=Vt).prototype,"canvasUITransform",[Ot],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Dt=t(Lt.prototype,"designHeight",[Xt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1920}}),kt=t(Lt.prototype,"designWidth",[Xt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1080}}),Gt=t(Lt.prototype,"defaultOrthoHeight",[Xt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 820}}),Ft=t(Lt.prototype,"minOrthoHeight",[Xt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 750}}),zt=t(Lt.prototype,"maxOrthoHeight",[Xt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1080}}),Ht=t(Lt.prototype,"safeAreaPadding",[Xt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),Pt=Lt))||Pt);l._RF.pop(),l._RF.push({},"57e95MMlQtJ1o1ktV5cFv8p","Mafia_FitToScreen",void 0);var ne,ie,oe,re,ae,se,le,ce,ue,he,pe,de,fe,ge,me,ye=c.ccclass,ve=c.property;Zt=ye("MafiaFitToScreen"),Qt=ve({type:d}),Zt((te=t(($t=function(t){function o(){for(var e,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,n(e,"updateWidgetsRecursively",te,i(e)),e}e(o,t);var r=o.prototype;return r.onEnable=function(){var t=this;S.once(C.EVENT_AFTER_UPDATE,(function(){t.refresh()}))},r.setUiTransformToScreenSize=function(){var t=this.node.getComponent(f),e=ee.instance.getCurrentOrthoHeight()/ee.instance.defaultOrthoHeight,n=m.windowSize.width||window.innerWidth,i=m.windowSize.height||window.innerHeight,o=ee.instance.designHeight*e,r=o*n/i;console.log("windowWidth",n,"windowHeight",i),t.setContentSize(r,o)},r.refresh=function(){this.setUiTransformToScreenSize(),this.updateWidgetsRecursively&&this.updateWidgetsInHierarchy()},r.updateWidgetsInHierarchy=function(){this.updateWidgetAndDescendants(this.node)},r.updateWidgetAndDescendants=function(t){var e=this,n=t.getComponent(T);n&&this.node.uuid!=t.uuid&&n.updateAlignment(),t.children.forEach((function(t){e.updateWidgetAndDescendants(t)}))},o}(h)).prototype,"updateWidgetsRecursively",[Qt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qt=$t));l._RF.pop(),l._RF.push({},"e36ff/Ql1lCXIUDONHBv7XU","Mafia_MiloLayout",void 0);var Se=c.ccclass,Ce=c.property,Te=function(t){return t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL",t[t.GRID=2]="GRID",t}({}),be=function(t){return t[t.LEFT_TOP=0]="LEFT_TOP",t[t.CENTER_TOP=1]="CENTER_TOP",t[t.RIGHT_TOP=2]="RIGHT_TOP",t[t.LEFT_CENTER=3]="LEFT_CENTER",t[t.CENTER=4]="CENTER",t[t.RIGHT_CENTER=5]="RIGHT_CENTER",t[t.LEFT_BOTTOM=6]="LEFT_BOTTOM",t[t.CENTER_BOTTOM=7]="CENTER_BOTTOM",t[t.RIGHT_BOTTOM=8]="RIGHT_BOTTOM",t}({});ne=Se("MafiaMiloLayout"),ie=Ce({type:b(Te)}),oe=Ce({type:b(Te)}),re=Ce({type:b(be)}),ae=Ce({type:b(be)}),se=Ce({visible:function(){return this._layoutType===Te.GRID}}),ne((ue=t((ce=function(t){function o(){for(var e,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,n(e,"_layoutType",ue,i(e)),n(e,"_alignment",he,i(e)),n(e,"_spacingX",pe,i(e)),n(e,"_spacingY",de,i(e)),n(e,"_columns",fe,i(e)),n(e,"_padding",ge,i(e)),n(e,"_autoResize",me,i(e)),e._activeChildCount=0,e._layoutSize=new R(0,0),e._lastChildActiveState=[],e}e(o,t);var a=o.prototype;return a.onLoad=function(){this.node.on(_.EventType.CHILD_ADDED,this.onChildAdded,this),this.node.on(_.EventType.CHILD_REMOVED,this.onChildRemoved,this)},a.onDestroy=function(){this.node.off(_.EventType.CHILD_ADDED,this.onChildAdded,this),this.node.off(_.EventType.CHILD_REMOVED,this.onChildRemoved,this),this.removeAllChildListeners()},a.onChildRemoved=function(t){this.removeChildListener(t),this.updateLayout()},a.removeAllChildListeners=function(){var t=this;this.node.children.forEach((function(e){t.removeChildListener(e)}))},a.removeChildListener=function(t){t.__miloLayoutActiveHandler&&(t.off(_.EventType.ACTIVE_IN_HIERARCHY_CHANGED,t.__miloLayoutActiveHandler),t.__miloLayoutActiveHandler=null)},a.start=function(){this._lastChildActiveState=this.node.children.map((function(t){return t.active})),this.updateLayout(),this.addChildActiveListeners()},a.addChildActiveListeners=function(){var t=this;this.node.children.forEach((function(e){t.addChildActiveListener(e)}))},a.addChildActiveListener=function(t){var e=this;t.off(_.EventType.ACTIVE_IN_HIERARCHY_CHANGED,this.onChildActiveChanged,this);var n=function(){e.scheduleOnce((function(){e.updateLayout()}),0)};t.__miloLayoutActiveHandler=n,t.on(_.EventType.ACTIVE_IN_HIERARCHY_CHANGED,n)},a.onChildActiveChanged=function(t){},a.onEnable=function(){this.updateLayout()},a.getAlignmentOffset=function(t){var e,n=new E,i=(null==(e=this.node.getComponent(f))?void 0:e.contentSize)||new R(0,0);switch(console.log("getAlignmentOffset",t,i),this._alignment){case be.LEFT_TOP:case be.LEFT_CENTER:case be.LEFT_BOTTOM:n.x=this._padding;break;case be.CENTER_TOP:case be.CENTER:case be.CENTER_BOTTOM:n.x=(i.width-t.width)/2;break;case be.RIGHT_TOP:case be.RIGHT_CENTER:case be.RIGHT_BOTTOM:n.x=i.width-t.width-this._padding}switch(this._alignment){case be.LEFT_TOP:case be.CENTER_TOP:case be.RIGHT_TOP:n.y=-this._padding;break;case be.LEFT_CENTER:case be.CENTER:case be.RIGHT_CENTER:n.y=-(i.height-t.height)/2;break;case be.LEFT_BOTTOM:case be.CENTER_BOTTOM:case be.RIGHT_BOTTOM:n.y=-i.height+t.height+this._padding}return n},a.updateLayout=function(){if(this.node){var t=this.node.children.filter((function(t){return t.active}));if(this._activeChildCount=t.length,0!==this._activeChildCount)switch(this._layoutType){case Te.HORIZONTAL:this.updateHorizontalLayout(t);break;case Te.VERTICAL:this.updateVerticalLayout(t);break;case Te.GRID:this.updateGridLayout(t)}}},a.updateHorizontalLayout=function(t){var e=this,n=2*this._padding,i=0;t.forEach((function(o,r){var a=o.getComponent(f);a&&(n+=a.width,r<t.length-1&&(n+=e._spacingX),i=Math.max(i,a.height))}));var o=new R(n,i+2*this._padding),r=this.getAlignmentOffset(o),a=r.x;if(t.forEach((function(t){var n=t.getComponent(f);if(n){var o=n.height,s=n.width,l=r.y;switch(e._alignment){case be.LEFT_TOP:case be.CENTER_TOP:case be.RIGHT_TOP:l=r.y-e._padding;break;case be.LEFT_CENTER:case be.CENTER:case be.RIGHT_CENTER:l=r.y-(i-o)/2;break;case be.LEFT_BOTTOM:case be.CENTER_BOTTOM:case be.RIGHT_BOTTOM:l=r.y-i+o}t.position=new E(a+s/2,l-o/2,0),a+=s+e._spacingX}})),this._layoutSize=o,this._autoResize){var s=this.node.getComponent(f);s&&s.setContentSize(o)}},a.updateVerticalLayout=function(t){var e=this,n=2*this._padding,i=0;t.forEach((function(o,r){var a=o.getComponent(f);a&&(n+=a.height,r<t.length-1&&(n+=e._spacingY),i=Math.max(i,a.width))}));var o=new R(i+2*this._padding,n),r=this.getAlignmentOffset(o),a=r.y;if(t.forEach((function(t){var n=t.getComponent(f);if(n){var o=n.height,s=n.width,l=r.x;switch(e._alignment){case be.LEFT_TOP:case be.LEFT_CENTER:case be.LEFT_BOTTOM:l=r.x+e._padding;break;case be.CENTER_TOP:case be.CENTER:case be.CENTER_BOTTOM:l=r.x+(i-s)/2+e._padding;break;case be.RIGHT_TOP:case be.RIGHT_CENTER:case be.RIGHT_BOTTOM:l=r.x+i-s+e._padding}t.position=new E(l+s/2,a-o/2,0),a-=o+e._spacingY}})),this._layoutSize=o,this._autoResize){var s=this.node.getComponent(f);s&&s.setContentSize(o)}},a.updateGridLayout=function(t){if(!(this._columns<=0)){var e=Math.ceil(t.length/this._columns),n=0,i=0;t.forEach((function(t){var e=t.getComponent(f);e&&(n=Math.max(n,e.width),i=Math.max(i,e.height))}));var o=2*this._padding+n*this._columns+this._spacingX*(this._columns-1),r=2*this._padding+i*e+this._spacingY*(e-1),a=new R(o,r),s=this.getAlignmentOffset(a);console.log("[MiloLayout] Total size: ",a),console.log("[MiloLayout] Start pos: ",s);for(var l=0;l<e;l++){var c=Math.min(this._columns,t.length-l*this._columns),u=c*n+(c-1)*this._spacingX,h=0;switch(this._alignment){case be.CENTER_TOP:case be.CENTER:case be.CENTER_BOTTOM:h=(this._columns*n+(this._columns-1)*this._spacingX-u)/2;break;case be.RIGHT_TOP:case be.RIGHT_CENTER:case be.RIGHT_BOTTOM:h=this._columns*n+(this._columns-1)*this._spacingX-u}for(var p=0;p<c;p++){var d=l*this._columns+p;if(d>=t.length)break;var g=t[d],m=g.getComponent(f);if(m){var y=m.width,v=m.height,S=s.x+this._padding+p*(n+this._spacingX)+h,C=s.y-this._padding-l*(i+this._spacingY),T=S,b=C;switch(this._alignment){case be.LEFT_TOP:case be.LEFT_CENTER:case be.LEFT_BOTTOM:T=S;break;case be.CENTER_TOP:case be.CENTER:case be.CENTER_BOTTOM:T=S+(n-y)/2;break;case be.RIGHT_TOP:case be.RIGHT_CENTER:case be.RIGHT_BOTTOM:T=S+n-y}switch(this._alignment){case be.LEFT_TOP:case be.CENTER_TOP:case be.RIGHT_TOP:b=C;break;case be.LEFT_CENTER:case be.CENTER:case be.RIGHT_CENTER:b=C-(i-v)/2;break;case be.LEFT_BOTTOM:case be.CENTER_BOTTOM:case be.RIGHT_BOTTOM:b=C-i+v}g.position=new E(T+y/2,b-v/2,0)}}}if(this._layoutSize=a,this._autoResize){var _=this.node.getComponent(f);_&&_.setContentSize(a)}}},a.update=function(t){if(this.node&&this.node.children.length>0){var e=this.node.children.map((function(t){return t.active})),n=!1;if(this._lastChildActiveState.length!==e.length)n=!0;else for(var i=0;i<e.length;i++)if(this._lastChildActiveState[i]!==e[i]){n=!0;break}n&&(this._lastChildActiveState=e,this.updateLayout())}},a.onChildAdded=function(t){this.addChildActiveListener(t),this.updateLayout()},r(o,[{key:"layoutType",get:function(){return this._layoutType},set:function(t){this._layoutType=t,this.updateLayout()}},{key:"alignment",get:function(){return this._alignment},set:function(t){this._alignment=t,this.updateLayout()}},{key:"spacingX",get:function(){return this._spacingX},set:function(t){this._spacingX=t,this.updateLayout()}},{key:"spacingY",get:function(){return this._spacingY},set:function(t){this._spacingY=t,this.updateLayout()}},{key:"columns",get:function(){return this._columns},set:function(t){this._columns=t,this.updateLayout()}},{key:"padding",get:function(){return this._padding},set:function(t){this._padding=t,this.updateLayout()}},{key:"autoResize",get:function(){return this._autoResize},set:function(t){this._autoResize=t,this.updateLayout()}}]),o}(h)).prototype,"_layoutType",[ie],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Te.HORIZONTAL}}),t(ce.prototype,"layoutType",[oe],Object.getOwnPropertyDescriptor(ce.prototype,"layoutType"),ce.prototype),he=t(ce.prototype,"_alignment",[re],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return be.LEFT_TOP}}),t(ce.prototype,"alignment",[ae],Object.getOwnPropertyDescriptor(ce.prototype,"alignment"),ce.prototype),pe=t(ce.prototype,"_spacingX",[Ce],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),t(ce.prototype,"spacingX",[Ce],Object.getOwnPropertyDescriptor(ce.prototype,"spacingX"),ce.prototype),de=t(ce.prototype,"_spacingY",[Ce],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),t(ce.prototype,"spacingY",[Ce],Object.getOwnPropertyDescriptor(ce.prototype,"spacingY"),ce.prototype),fe=t(ce.prototype,"_columns",[Ce],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 3}}),t(ce.prototype,"columns",[se],Object.getOwnPropertyDescriptor(ce.prototype,"columns"),ce.prototype),ge=t(ce.prototype,"_padding",[Ce],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),t(ce.prototype,"padding",[Ce],Object.getOwnPropertyDescriptor(ce.prototype,"padding"),ce.prototype),me=t(ce.prototype,"_autoResize",[Ce],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),t(ce.prototype,"autoResize",[Ce],Object.getOwnPropertyDescriptor(ce.prototype,"autoResize"),ce.prototype),le=ce));l._RF.pop(),l._RF.push({},"148f4rScJ9CCpYq02Y6pLaL","Mafia_PbExtensions",void 0),E.prototype.clampMagnitude=function(t,e){if(!(t>e)){var n=this.length();return n>e?(this.normalize(),this.multiplyScalar(e)):n<t&&(this.normalize(),this.multiplyScalar(t)),this}console.error("min should be less than max")},h.prototype.log=function(){for(var t=this.constructor.name,e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];ht.info.apply(ht,[t+" "].concat(n))},l._RF.pop(),l._RF.push({},"e9fc6hX28NAMo5e+sZM6ukk","Mafia_Utils",void 0),l._RF.pop(),l._RF.push({},"8b000DlStVJ5rYkCs5GQBAQ","Mafia_BasePlayerData",void 0);var Re=function(){function t(){this.userId=void 0,this.name=void 0,this.avatar=void 0,this.sessionId=void 0,this.playerNumber=void 0,this.type=void 0,this.isOnline=void 0,this.isConnected=void 0,this.isReplacedByBot=void 0,this.isKickedOut=void 0,this.isReady=void 0,this.score=void 0}return t.prototype.copyFrom=function(t){this.userId=t.userId,this.name=t.name,this.avatar=t.avatar,this.sessionId=t.sessionId,this.playerNumber=t.playerNumber,this.type=t.type,this.isOnline=t.isOnline,this.isConnected=t.isConnected,this.isReplacedByBot=t.isReplacedByBot,this.isKickedOut=t.isKickedOut,this.isReady=t.isReady,this.score=t.score},t}();l._RF.pop(),l._RF.push({},"deb605Z3CxFvIWP3DgiTvl4","Mafia_BaseRoomSettings",void 0);var _e=function(){function t(){this.maxPlayers=void 0,this.minPlayers=void 0,this.maxClients=void 0,this.countdownTimeInSeconds=void 0,this.allowLateJoin=void 0,this.maxReconnectionAttempts=void 0,this.reconnectionAttemptInterval=void 0,this.reconnectionTime=void 0,this.gameFPS=void 0,this.serverFPS=void 0,this.patchRate=void 0}return t.prototype.copyFrom=function(t){this.maxPlayers=t.maxPlayers,this.minPlayers=t.minPlayers,this.maxClients=t.maxClients,this.countdownTimeInSeconds=t.countdownTimeInSeconds,this.allowLateJoin=t.allowLateJoin,this.reconnectionTime=t.reconnectionTime,this.gameFPS=t.gameFPS,this.serverFPS=t.serverFPS,this.patchRate=t.patchRate},t}();l._RF.pop(),l._RF.push({},"a3a72gjPcRAvIYOfAxJummA","Mafia_RoomTypes",void 0);var Ee=function(t){return t[t.NONE=0]="NONE",t[t.WAITING_FOR_PLAYERS=1]="WAITING_FOR_PLAYERS",t[t.COUNTDOWN=2]="COUNTDOWN",t[t.GAME_SIMULATION=3]="GAME_SIMULATION",t[t.END_GAME=4]="END_GAME",t[t.KICKED_OUT=5]="KICKED_OUT",t}({});l._RF.pop(),l._RF.push({},"127b1osQO9JAak5yTMMaFTV","Mafia_BaseRoomState",void 0);var Ie,we,Ae,Ne,Oe,Pe,Le,Me=function(){function t(t,e){this.currentRoomStatus=Ee.WAITING_FOR_PLAYERS,this.previousRoomStatus=Ee.NONE,this.roomSettings=void 0,this.playersData=void 0,this.spectatorsData=void 0,this.roomSettings=t,this.playersData=e,this.spectatorsData=[]}return t.prototype.copyFrom=function(t){this.currentRoomStatus=t.currentRoomStatus,this.previousRoomStatus=t.previousRoomStatus,this.roomSettings.copyFrom(t.roomSettings)},t}();l._RF.pop(),l._RF.push({},"21004HVzaNBZ7tMvv7xOesz","Mafia_Timer",void 0);var De=c.ccclass,ke=c.property,Ge=(Ie=De("MafiaTimer"),we=ke(I),Ae=ke(w),Ie((Pe=t((Oe=function(t){function o(){for(var e,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,n(e,"timeUiLabel",Pe,i(e)),n(e,"timerFillSprite",Le,i(e)),e.elapsedTime=0,e.maxTime=0,e.isRunning=!1,e.onTimerEndCallback=null,e}e(o,t);var r=o.prototype;return r.update=function(t){this.isRunning&&(this.elapsedTime-=t,this.elapsedTime<=0&&(this.elapsedTime=0,this.stopTimer(),this.onTimerEndCallback&&this.onTimerEndCallback()),this.updateTimeLabel(),this.updateFillSprite())},r.startTimer=function(){this.isRunning||(this.isRunning=!0)},r.stopTimer=function(){this.isRunning&&(this.isRunning=!1)},r.reset=function(){this.elapsedTime=0,this.updateTimeLabel()},r.setStartTime=function(t){console.log("[Timer] Setting start time to:",t),this.elapsedTime=t,this.maxTime=t,this.updateTimeLabel(),this.updateFillSprite()},r.setOnTimerEndCallback=function(t){this.onTimerEndCallback=t},r.updateTimeLabel=function(){var t=Math.floor(this.elapsedTime);this.timeUiLabel.string=""+t},r.updateFillSprite=function(){if(this.timerFillSprite){var t=this.maxTime>0?this.elapsedTime/this.maxTime:0;this.timerFillSprite.fillRange=t}},r.formatTime=function(t){return t<10?"0"+t:""+t},r.formatMilliseconds=function(t){return t<10?"00"+t:t<100?"0"+t:""+t},o}(h)).prototype,"timeUiLabel",[we],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Le=t(Oe.prototype,"timerFillSprite",[Ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ne=Oe))||Ne);l._RF.pop(),l._RF.push({},"fdf73+b1OpLfpEGWvKuAZY9","Mafia_GameMessageType",void 0);var Fe=function(t){return t.NONE="none",t.SET_STATE="set_state",t.PLAYER_SELECT_CATEGORY="player_select_category",t.PLAYER_DONE_DESCRIBING="player_done_describing",t.PLAYER_VOTE="player_vote",t}({});l._RF.pop(),l._RF.push({},"f3fd4TufRZHtKazYC085JyL","Mafia_GameState",void 0);var ze,He,Ve,Be,Ue,We,xe,Ye,Ke,Je=function(t){return t[t.NONE=0]="NONE",t[t.WAITING_FOR_PLAYERS=1]="WAITING_FOR_PLAYERS",t[t.START_ROUND=2]="START_ROUND",t[t.CATEGORY_SELECTION=3]="CATEGORY_SELECTION",t[t.PREPARATION=4]="PREPARATION",t[t.WORD_DESCRIPTION=5]="WORD_DESCRIPTION",t[t.VOTING=6]="VOTING",t[t.VOTING_RESULTS=7]="VOTING_RESULTS",t[t.END_ROUND=8]="END_ROUND",t[t.GAME_OVER=9]="GAME_OVER",t}({});l._RF.pop(),l._RF.push({},"f0449qYRJRD2qYGuhFrYnAx","Mafia_PlayerAvatar",void 0);var je,Xe,Ze,Qe,qe,$e,tn,en,nn,on,rn,an,sn,ln,cn,un,hn,pn,dn,fn,gn,mn,yn,vn,Sn,Cn,Tn,bn,Rn,_n,En,In,wn,An,Nn,On,Pn,Ln=c.ccclass,Mn=c.property,Dn=(ze=Ln("MafiaPlayerAvatar"),He=Mn({type:w,tooltip:"Player Avatar"}),Ve=Mn({type:w,tooltip:"Player Avatar Outline"}),Be=Mn({type:_,tooltip:"Skull"}),ze((xe=t((We=function(t){function o(){for(var e,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,n(e,"playerAvatar",xe,i(e)),n(e,"outline",Ye,i(e)),n(e,"skull",Ke,i(e)),e.enableOnClick=!1,e.userId="",e}e(o,t);var r=o.prototype;return r.initialize=function(t,e){this.enableOnClick=t,this.userId=e},r.onEnable=function(){this.registerTouchEvents()},r.onDisable=function(){this.unregisterTouchEvents()},r.start=function(){},r.update=function(t){},r.registerTouchEvents=function(){this.playerAvatar&&this.playerAvatar.node&&this.playerAvatar.node.on(_.EventType.TOUCH_START,this.handleTouchStart,this)},r.unregisterTouchEvents=function(){this.playerAvatar&&this.playerAvatar.node&&this.playerAvatar.node.off(_.EventType.TOUCH_START,this.handleTouchStart,this)},r.handleTouchStart=function(){this.enableOnClick},r.setOutline=function(t){this.outline&&(this.outline.enabled=t)},r.setAvatarFromUrl=function(t){var e=this.getFromCache(t);e?this.createSpriteFrameFromTexture(e):this.loadRemoteImage(t)},r.setAvatarFromSpriteFrame=function(t){this.playerAvatar&&(this.playerAvatar.spriteFrame=t)},r.getFromCache=function(t){var e=A.assets.get(t);return e&&e.isValid&&"function"==typeof e.getHash?e:null},r.createSpriteFrameFromTexture=function(t){if(t&&t.isValid&&"function"==typeof t.getHash)if(this.playerAvatar){var e=new N;e.texture=t,this.playerAvatar.spriteFrame=e}else console.warn("[MafiaPlayerAvatar] PlayerAvatar component is null");else console.warn("[MafiaPlayerAvatar] Invalid texture provided")},r.loadRemoteImage=function(t){var e=this;A.loadRemote(t,{ext:".png"},(function(n,i){if(n)return console.error("[Player] Failed to load profile image: "+JSON.stringify(n)),void(window.ReactNativeWebView&&window.ReactNativeWebView.postMessage(JSON.stringify({message:"player_avatar_load_failed",data:{userId:e.userId,url:t,errorName:n.name,errorMessage:n.message,errorStack:n.stack}})));try{var o=new N,r=new O;r.image=i,r.isValid&&"function"==typeof r.getHash?(o.texture=r,e.playerAvatar?e.playerAvatar.spriteFrame=o:console.warn("[MafiaPlayerAvatar] PlayerAvatar component is null")):console.warn("[MafiaPlayerAvatar] Invalid texture created from imageAsset")}catch(n){console.error("[Player] Error creating sprite frame: "+n),window.ReactNativeWebView&&window.ReactNativeWebView.postMessage(JSON.stringify({message:"player_sprite_frame_creation_failed",data:{userId:e.userId,url:t,error:n}}))}}))},r.ShowSkull=function(t){this.skull&&(this.skull.active=t)},o}(h)).prototype,"playerAvatar",[He],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ye=t(We.prototype,"outline",[Ve],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ke=t(We.prototype,"skull",[Be],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ue=We))||Ue);l._RF.pop(),l._RF.push({},"40162PXqm9DSbxUCrdBOLNu","Mafia_Player",void 0);var kn=c.ccclass,Gn=c.property,Fn=function(t){return t[t.UNINITIALIZED=0]="UNINITIALIZED",t[t.IDLE=1]="IDLE",t[t.CATEGORY_SELECTION=2]="CATEGORY_SELECTION",t[t.DESCRIBING=3]="DESCRIBING",t[t.VOTING=4]="VOTING",t[t.END_GAME=5]="END_GAME",t}({}),zn=(je=kn("MafiaPlayer"),Xe=Gn({type:P,tooltip:"Player's index in the game"}),Ze=Gn({type:I,tooltip:"Label to display player's name"}),Qe=Gn({type:Dn,tooltip:"Player Avatar"}),qe=Gn({type:w,tooltip:"Sprite for player's description timer"}),$e=Gn({type:L,tooltip:"Button to vote for a player"}),tn=Gn({type:L,tooltip:"Button to display that player is selected for vote"}),en=Gn({type:_,tooltip:"Container for votes"}),nn=Gn({type:_,tooltip:"Container for votes"}),on=Gn({type:M,tooltip:"Player Avatar Prefab"}),rn=Gn({type:_,tooltip:"Sprite for player speaking animation"}),an=Gn({type:_}),sn=Gn({type:_,tooltip:"Sprite for player speaking animation"}),ln=Gn({type:_}),cn=Gn({type:_,tooltip:"Sprite for player Tie status"}),un=Gn({type:_}),hn=Gn({type:_}),pn=Gn({type:_}),je((gn=t((fn=function(t){function o(){for(var e,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))||this).userId="",e.playerName="",n(e,"index",gn,i(e)),n(e,"nameLabel",mn,i(e)),n(e,"playerAvatar",yn,i(e)),n(e,"descriptionTimerSprite",vn,i(e)),n(e,"voteButton",Sn,i(e)),n(e,"votedButton",Cn,i(e)),n(e,"votesContainerLeft",Tn,i(e)),n(e,"votesContainerRight",bn,i(e)),n(e,"playerAvatarPrefab",Rn,i(e)),n(e,"micSpriteLeft",_n,i(e)),n(e,"micLeftFill",En,i(e)),n(e,"micSpriteRight",In,i(e)),n(e,"micRightFill",wn,i(e)),n(e,"tieSprite",An,i(e)),n(e,"skull",Nn,i(e)),n(e,"addSymbol",On,i(e)),n(e,"avatar",Pn,i(e)),e.playerState=Fn.UNINITIALIZED,e.isLocal=!1,e.isInitialized=!1,e.isProfileInitialized=!1,e.roomSettings=null,e.profileImageUrl="",e.timer=0,e.rank=0,e.hasGuessedAnswer=!1,e.isDead=!1,e.voters=[],e.oddColor=new D(15,43,77,255),e.evenColor=new D(0,0,0,0),e.correctGuessColor=new D(0,255,0,125),e.currentPlayerColor=new D(255,215,0,125),e.localPlayerColor=new D(255,215,0,255),e.micSprite=null,e.micFill=null,e.votesContainer=null,e}e(o,t);var r=o.prototype;return r.onEnable=function(){this.updateBgColor()},r.onDisable=function(){},r.update=function(t){this.playerState===Fn.DESCRIBING&&this.updateTimer(t)},r.IsDead=function(){return this.isDead},r.initialize=function(t,e,n){if(this.validateRoomState(t)){this.index=e,this.addSymbol.active=!1,this.avatar.active=!0,console.log("[Player] Initializing Player: "+this.index);var i=t.getPlayerByIndex(e);i?(n?(this.micSprite=this.micSpriteLeft,this.micFill=this.micLeftFill,this.votesContainer=this.votesContainerLeft):(this.micSprite=this.micSpriteRight,this.micFill=this.micRightFill,this.votesContainer=this.votesContainerRight),this.micSprite.active=!1,this.votesContainer.active=!1,this.loadProfile(i),this.setupPlayerData(i,t),this.updatePlayerState(t),this.sendReactNativeMessage({message:"player_initialized",data:i})):console.error("[Player] No profile data found for player index "+this.index)}},r.setupPlayerData=function(t,e){this.userId=t.userId,this.playerName=t.name,this.roomSettings=e.roomSettings,this.setScore(t.score),t.sessionId===Jt.Instance.CurrentRoom.sessionId&&(this.isLocal=!0,this.nameLabel.string="You",this.highlightLocalPlayer()),this.nameLabel.node.active=!0,this.isInitialized=!0,this.playerState=Fn.IDLE},r.loadProfile=function(t){!this.isProfileInitialized&&t&&(console.log("[Player] Loading profile for player: "+t.name),this.nameLabel.string=_o.Instance.TruncateName(t.name),this.profileImageUrl=t.avatar,this.playerAvatar.initialize(!0,t.userId),this.loadProfileImage(),this.isProfileInitialized=!0,this.isDead=t.isDead,t.isDead?this.skull.active=!0:this.skull.active=!1)},r.loadProfileImage=function(){this.profileImageUrl?this.playerAvatar.setAvatarFromUrl(this.profileImageUrl):console.warn("[Player] No profile image URL provided")},r.onServerRoomStateChange=function(t){this.validateRoomState(t)&&(this.updatePlayerData(t),this.updatePlayerState(t))},r.updatePlayerData=function(t){var e=t.getPlayerByIndex(this.index);e&&this.setScore(e.score)},r.updatePlayerState=function(t){if(this.playerState!==Fn.UNINITIALIZED)switch(this.handleDeadStatus(t),t.currentGameState){case Je.WORD_DESCRIPTION:this.handleWordDescriptionState(t);break;case Je.VOTING:this.handleVotingState(t);break;default:this.setStateIdle()}},r.handleWordDescriptionState=function(t){if(this.votesContainer.active=!1,this.handleTieStatus(t),t.describingPlayerId===this.userId){this.isLocal&&this.unmuteMic(),this.playerState=Fn.DESCRIBING,this.micSprite.active=!0,this.startMicFillAnimation(),_o.Instance.miloSDK.vibratePreset("heavy");var e=t.getPlayerByUserId(this.userId);e&&(this.setTimer(e.descriptionTimer),console.log("[Player] Player "+this.userId+" description timer: "+this.timer))}else this.setStateIdle()},r.handleVotingState=function(t){this.handleTieStatus(t),this.setTimer(0),this.setStateIdle();var e=this.getLocalPlayerData(t);if(e){var n=this.shouldShowVoteButton(t,e),i=this.shouldShowVotedButton(t,e);this.voteButton.node.active=n,this.votedButton.node.active=i,e.votedSpyUserId&&this.updateVotesDisplay(t)}},r.handleDeadStatus=function(t){var e=t.getPlayerByUserId(this.userId);this.isDead=e.isDead,e.isDead?this.skull.active=!0:this.skull.active=!1},r.handleTieStatus=function(t){var e=this;t.tieBreakRound>0&&t.tiedPlayerIds.some((function(t){return t===e.userId}))?this.tieSprite.active=!0:this.tieSprite.active=!1},r.shouldShowVoteButton=function(t,e){var n=this;return console.log("should show vote button",this.isDead),this.userId!==e.userId&&(!e.isDead&&!e.votedSpyUserId&&(!this.isDead&&!(t.tieBreakRound>0&&!t.tiedPlayerIds.some((function(t){return t===n.userId})))))},r.shouldShowVotedButton=function(t,e){return!this.shouldShowVoteButton(t,e)&&e.votedSpyUserId===this.userId},r.setStateIdle=function(){this.playerState=Fn.IDLE,this.voteButton.node.active=!1,this.votedButton.node.active=!1,this.nameLabel.node.active=!0,this.micSprite.active=!1,this.votesContainer.active=!1,this.isLocal&&this.muteMic(),this.setTimer(0),this.clearVotesContainer()},r.resetState=function(){this.hasGuessedAnswer=!1,this.setStateIdle(),this.updateBgColor()},r.onVoteButtonClick=function(){var t={userId:this.userId};try{Jt.Instance.sendMessage(Fe.PLAYER_VOTE,t),this.voteButton.node.active=!1}catch(t){console.error("[Player] Failed to send vote message: "+t)}},r.updateVotesDisplay=function(t){var e=this;this.votesContainer.active=!0;var n=t.playersData.filter((function(t){return t.votedSpyUserId===e.userId})),i=this.voters.map((function(t){return t.userId})),o=i.filter((function(t){return!n.some((function(e){return e.userId===t}))})),r=n.filter((function(t){return!i.some((function(e){return e===t.userId}))}));this.removeVoters(o),this.addVoters(r)},r.removeVoters=function(t){var e=this;t.forEach((function(t){var n=e.voters.findIndex((function(e){return e.userId===t}));-1!==n&&(e.voters[n].node.destroy(),e.voters.splice(n,1))}))},r.addVoters=function(t){var e=this;t.forEach((function(t){var n=k(e.playerAvatarPrefab),i=n.getComponent(Dn);n.getComponent(f).setContentSize(new R(50,50)),i.initialize(!1,t.userId);var o=_o.Instance.players.find((function(e){return e.userId===t.userId}));o&&i.setAvatarFromSpriteFrame(o.playerAvatar.playerAvatar.spriteFrame),e.votesContainer.addChild(n),e.voters.push(i)}))},r.clearVotesContainer=function(){this.votesContainer.children.forEach((function(t){t.destroy()})),this.voters=[]},r.updateTimer=function(t){var e=Math.max(0,this.timer-t);this.setTimer(e)},r.setTimer=function(t){if(this.timer=t,this.roomSettings&&this.descriptionTimerSprite){this.descriptionTimerSprite.fillRange=this.timer/this.roomSettings.descriptionTimeLimit;var e=this.descriptionTimerSprite.fillRange>.3?_o.Instance.villagersColor:_o.Instance.spyColor;this.descriptionTimerSprite.color=e}},r.onReconnection=function(t){if(this.validateRoomState(t)){var e=t.getPlayerByIndex(this.index);e&&(this.loadProfile(e),this.setScore(e.score)),this.updatePlayerState(t),this.updateBgColor()}},r.onSetState=function(t){this.updatePlayerState(t)},r.handleTurnSpecificMessages=function(t){if(t.inputPayload.inputType!==Fe.NONE)switch(t.inputPayload.inputType){case Fe.SET_STATE:this.onSetState(t)}},r.handleWordsList=function(t){console.log("[Player] Received words list",t.inputPayload)},r.startMicFillAnimation=function(){if(this.micFill){var t=this.micFill.getComponent(w);t?(this.stopMicFillAnimation(),this.createMicFillFluctuationTween(t)):console.warn("[Player] MicFill sprite component not found")}else console.warn("[Player] MicFill node not found")},r.stopMicFillAnimation=function(){if(this.micFill){var t=this.micFill.getComponent(w);t&&(G(t).stop(),t.fillRange=0)}},r.createMicFillFluctuationTween=function(t){G(t).to(.3,{fillRange:.9},{easing:"sineInOut"}).to(.3,{fillRange:.1},{easing:"sineInOut"}).union().repeatForever().start()},r.getLocalPlayerData=function(t){var e=Jt.Instance.CurrentRoom.sessionId;return null==t?void 0:t.playersData.find((function(t){return t.sessionId===e}))},r.validateRoomState=function(t){return!!t||(console.error("[Player] Invalid room state"),!1)},r.muteMic=function(){this.sendReactNativeMessage({event:"muteMic",data:!0})},r.unmuteMic=function(){this.sendReactNativeMessage({event:"muteMic",data:!1})},r.sendReactNativeMessage=function(t){window.ReactNativeWebView&&(console.log("Sending message to React Native:",t),window.ReactNativeWebView&&window.ReactNativeWebView.postMessage(JSON.stringify(t)))},r.setScore=function(t){},r.setRank=function(t){this.rank=t,this.updateBgColor()},r.setGuessedAnswer=function(t){this.hasGuessedAnswer=t,this.updateBgColor()},r.highlightLocalPlayer=function(){this.nameLabel&&(this.nameLabel.color=this.localPlayerColor)},r.updateBgColor=function(){},r.setPlayerNumber=function(t){this.index=t},r.openProfile=function(){this.userId?console.log("Opening profile for user: "+this.userId):console.warn("[Player] Cannot open profile: No user ID available")},o}(h)).prototype,"index",[Xe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),mn=t(fn.prototype,"nameLabel",[Ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),yn=t(fn.prototype,"playerAvatar",[Qe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),vn=t(fn.prototype,"descriptionTimerSprite",[qe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Sn=t(fn.prototype,"voteButton",[$e],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Cn=t(fn.prototype,"votedButton",[tn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Tn=t(fn.prototype,"votesContainerLeft",[en],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bn=t(fn.prototype,"votesContainerRight",[nn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Rn=t(fn.prototype,"playerAvatarPrefab",[on],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_n=t(fn.prototype,"micSpriteLeft",[rn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),En=t(fn.prototype,"micLeftFill",[an],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),In=t(fn.prototype,"micSpriteRight",[sn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wn=t(fn.prototype,"micRightFill",[ln],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),An=t(fn.prototype,"tieSprite",[cn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Nn=t(fn.prototype,"skull",[un],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),On=t(fn.prototype,"addSymbol",[hn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Pn=t(fn.prototype,"avatar",[pn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),dn=fn))||dn);l._RF.pop(),l._RF.push({},"80979N80XBKYK0mMy1KuHAh","Mafia_RoomState",void 0);var Hn,Vn,Bn=function(){function t(){this.roundNumber=0,this.score=0,this.survived=!0}return t.prototype.copyFrom=function(t){this.roundNumber=t.roundNumber,this.score=t.score,this.survived=t.survived},t}(),Un=function(t){function n(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))||this).isDead=!1,e.votedSpyUserId="",e.selectedCategory="",e.describingWord="",e.descriptionTimer=0,e.roundScores=[],e}return e(n,t),n.prototype.copyFrom=function(e){t.prototype.copyFrom.call(this,e),this.isDead=e.isDead,this.votedSpyUserId=e.votedSpyUserId,this.selectedCategory=e.selectedCategory,this.describingWord=e.describingWord,this.descriptionTimer=e.descriptionTimer,this.roundScores=e.roundScores.map((function(t){var e=new Bn;return e.copyFrom(t),e}))},n}(Re),Wn=function(t){function n(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))||this).maxRounds=void 0,e.startRoundTimeLimit=void 0,e.categorySelectionTimeLimit=void 0,e.preparationTimeLimit=void 0,e.descriptionTimeLimit=void 0,e.votingTimeLimit=void 0,e.votingResultsTimeLimit=void 0,e.endRoundTimeLimit=void 0,e.rounds=void 0,e}return e(n,t),n.prototype.copyFrom=function(e){t.prototype.copyFrom.call(this,e),this.maxRounds=e.maxRounds,this.startRoundTimeLimit=e.startRoundTimeLimit,this.categorySelectionTimeLimit=e.categorySelectionTimeLimit,this.preparationTimeLimit=e.preparationTimeLimit,this.descriptionTimeLimit=e.descriptionTimeLimit,this.votingTimeLimit=e.votingTimeLimit,this.votingResultsTimeLimit=e.votingResultsTimeLimit,this.endRoundTimeLimit=e.endRoundTimeLimit,this.rounds=e.rounds},n}(_e),xn=function(){function t(){this.inputType=void 0,this.inputValue=void 0}return t.prototype.copyFrom=function(t){this.inputType=t.inputType,this.inputValue=t.inputValue},t}(),Yn=function(t){function n(){var e;return(e=t.call(this,new Wn,[])||this).inputPayload=new xn,e.currentGameState=Je.NONE,e.previousGameState=Je.NONE,e.describingPlayerId="",e.category="",e.tiedPlayerIds=[],e.tieBreakRound=0,e.serverTick=0,e.currentRound=1,e.currentSpyUserId="",e}e(n,t);var i=n.prototype;return i.copyFrom=function(e){t.prototype.copyFrom.call(this,e),this.playersData=e.playersData.map((function(t){var e=new Un;return e.copyFrom(t),e})),this.spectatorsData=e.spectatorsData.map((function(t){var e=new Re;return e.copyFrom(t),e})),this.currentRoomStatus=e.currentRoomStatus,this.previousRoomStatus=e.previousRoomStatus,this.currentGameState=e.currentGameState,this.previousGameState=e.previousGameState,this.roomSettings.copyFrom(e.roomSettings),this.inputPayload.copyFrom(e.inputPayload),this.category=e.category,this.describingPlayerId=e.describingPlayerId,this.tiedPlayerIds=e.tiedPlayerIds.map((function(t){return t})),this.tieBreakRound=e.tieBreakRound,this.serverTick=e.serverTick,this.currentRound=e.currentRound,this.currentSpyUserId=e.currentSpyUserId},i.getPlayerByUserId=function(t){return this.playersData.find((function(e){return e.userId===t}))||null},i.getOnlinePlayersCount=function(){return this.playersData.filter((function(t){return t.isOnline})).length},i.getPlayerByIndex=function(t){return this.playersData.find((function(e){return e.playerNumber===t}))||null},i.getPlayerBySessionId=function(t){return this.playersData.find((function(e){return e.sessionId===t}))||null},n}(Me);l._RF.pop(),l._RF.push({},"20a0fJJBhpNX7tW3UyzQ2UF","Mafia_GameManager",void 0);var Kn,Jn,jn,Xn,Zn,Qn,qn,$n,ti,ei,ni,ii,oi,ri,ai,si=c.ccclass,li=c.executionOrder,ci=new p,ui=si("MafiaGameManager")(Hn=li(-2)(((Vn=function(t){function n(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))||this)._roomStatus=Ee.NONE,e._won=!1,e._handledGameOverCallbacks=!1,e._serverStateCopy=null,e.miloSDK=new j,e.gameStartTime=0,e}e(n,t);var i=n.prototype;return i.onLoad=function(){n._instance&&this.node.destroy(),n._instance=this,this.miloSDK.init({gameId:"mafia-game",debug:!0}),this.sendGameLoaded(),this.registerEvents()},i.onDestroy=function(){this.cleanup()},i.cleanup=function(){this.unregisterEvents(),n._instance===this&&(n._instance=null)},i.sendGameLoaded=function(){var t={timestamp:Date.now()};this.miloSDK.gameLoaded(t)},i.sendGameStarted=function(){this.gameStartTime=Date.now();var t={timestamp:this.gameStartTime};this.miloSDK.gameStarted(t)},i.sendGameEnded=function(){var t=this,e=Date.now(),n={duration:this.gameStartTime>0?e-this.gameStartTime:0,hasWinningScreen:!1};setTimeout((function(){t.miloSDK.gameEnded(n)}),2e3)},i.registerEvents=function(){xt.on(gt.CONNECTION_STATE_CHANGE,this.onConnectionStateChange,this),Yt.on(gt.SERVER_ROOM_STATE_CHANGE,this.onServerRoomStateChange,this)},i.unregisterEvents=function(){xt.off(gt.CONNECTION_STATE_CHANGE,this.onConnectionStateChange,this),Yt.off(gt.SERVER_ROOM_STATE_CHANGE,this.onServerRoomStateChange,this)},i.onConnectionStateChange=function(t,e){switch(e){case mt.DISCONNECTED:this._roomStatus!==Ee.END_GAME&&Jt.Instance.reconnect();break;case mt.KICKED_OUT:}},i.onServerRoomStateChange=function(t){this.log("ServerRoomStateChange Message: "+t.currentRoomStatus),this.log(!this._serverStateCopy),this._serverStateCopy||(this._serverStateCopy=new Yn,this._serverStateCopy.copyFrom(t)),t.currentRoomStatus===Ee.END_GAME&&(console.log("Game Over"),this.handleWon(t)),this.log("Setting room status to: ",t.currentRoomStatus),this.setRoomStatus(t.currentRoomStatus)},i.resetServerState=function(t){this._serverStateCopy||(this._serverStateCopy=new Yn),this._serverStateCopy.copyFrom(t)},i.handleWon=function(t){},i.setRoomStatus=function(t){if(this._roomStatus!==t){console.log("[GameManager] ==== Room Status Change ==== :",t);var e=this._roomStatus;this._roomStatus=t,this.OnRemoteGameStateChange(t),console.log("[GameManager] Emitting room status change event"),ci.emit(gt.ROOM_STATUS_CHANGE,e,t)}},i.GetMyPlayerData=function(){var t,e=Jt.Instance.CurrentRoom.sessionId;return null==(t=this._serverStateCopy)?void 0:t.playersData.find((function(t){return t.sessionId===e}))},i.GetWinnerPlayerData=function(){return null},i.OnRemoteGameStateChange=function(t){switch(console.log("RemoteGameStateChange Message: "+t),t){case Ee.NONE:case Ee.WAITING_FOR_PLAYERS:case Ee.COUNTDOWN:break;case Ee.GAME_SIMULATION:this.sendGameStarted();break;case Ee.END_GAME:this.sendGameEnded(),this.HandleGameOverCallbacks();break;default:console.warn("Unhandled room status: "+t)}},i.HandleGameOverCallbacks=function(){this._handledGameOverCallbacks?console.log("Already handled game over callbacks"):this._handledGameOverCallbacks=!0},r(n,null,[{key:"Instance",get:function(){return this._instance}}]),n}(h))._instance=null,Hn=Vn))||Hn)||Hn;l._RF.pop(),l._RF.push({},"37a7fs7sUBLAKsvnT++Ytdq","Mafia_Clock",void 0);var hi,pi,di,fi,gi,mi,yi,vi,Si,Ci,Ti,bi,Ri,_i=c.ccclass,Ei=c.property,Ii=(Kn=_i("MafiaClock"),Jn=Ei({type:_,tooltip:"Clock display"}),jn=Ei({type:I,tooltip:"Timer label with button"}),Xn=Ei({type:I}),Zn=Ei({type:_}),Qn=Ei({type:_}),qn=Ei({type:I}),Kn((ei=t((ti=function(t){function o(){for(var e,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,n(e,"clockContainer",ei,i(e)),n(e,"timerLabel",ni,i(e)),n(e,"infoLabel",ii,i(e)),n(e,"button",oi,i(e)),n(e,"clock",ri,i(e)),n(e,"speakingLabel",ai,i(e)),e.timer=0,e.localPlayerId="",e.isClockAnimating=!1,e.initialClockContainerPosition=new E(0,0,0),e.initialClockContainerAngle=0,e.clockAnimationTween=null,e}e(o,t);var r=o.prototype;return r.initialize=function(t){this.localPlayerId=ui.Instance.GetMyPlayerData().userId,this.initialClockContainerPosition=this.clockContainer.position.clone(),this.initialClockContainerAngle=this.clockContainer.angle},r.update=function(t){this.timer<=0||(this.updateTimer(t),this.updateTimerDisplay())},r.updateTimer=function(t){this.timer=Math.max(0,this.timer-t)},r.updateTimerDisplay=function(){var t=Math.floor(this.timer)+"s";this.timerLabel.string=t;var e=this.timer>5?_o.Instance.villagersColor:_o.Instance.spyColor;if(this.timerLabel.color=e,this.timer<=3&&this.timer>0){var n=_o.Instance.getRoomState();n&&(n.currentGameState===Je.WORD_DESCRIPTION||n.currentGameState===Je.VOTING)&&this.animateLowTimeClock(this.clock)}},r.animateLowTimeClock=function(t){var e=this;if(!this.isClockAnimating){this.isClockAnimating=!0;var n=this.initialClockContainerPosition.clone(),i=this.initialClockContainerAngle;this.clockAnimationTween=G(t).to(.2,{position:new E(n.x,n.y+20,n.z)}).to(.1,{angle:i+15}).to(.1,{angle:i-15}).to(.1,{angle:i+15}).to(.1,{angle:i-15}).to(.1,{angle:i+15}).to(.1,{angle:i-15}).to(.1,{angle:i+15}).to(.1,{angle:i-15}).to(.1,{angle:i+15}).to(.1,{angle:i-15}).to(.1,{angle:i+15}).to(.1,{angle:i-15}).to(.1,{angle:i+15}).to(.1,{angle:i-15}).to(.1,{angle:i+15}).to(.1,{angle:i-15}).to(.1,{angle:i+15}).to(.1,{angle:i-15}).to(.1,{angle:i+15}).to(.1,{angle:i-15}).to(.1,{angle:i+15}).to(.1,{angle:i-15}).to(.1,{angle:i+15}).to(.1,{angle:i-15}).to(.1,{angle:i+15}).to(.1,{angle:i-15}).to(.2,{position:n,angle:i}).call((function(){e.isClockAnimating=!1})).start()}},r.setTimer=function(t){this.timer=t,this.updateTimerDisplay()},r.onServerRoomStateChange=function(t){switch(t.currentGameState){case Je.WORD_DESCRIPTION:this.handleWordDescriptionState(t);break;case Je.VOTING:this.handleVotingState(t);break;default:this.hideAllClocks()}},r.handleWordDescriptionState=function(t){var e=t.describingPlayerId===this.localPlayerId;if(this.setTimer(t.roomSettings.descriptionTimeLimit),this.infoLabel.string="Your turn to Speak",e)this.showActivePlayerClock(),this.button.active=!0;else{this.hideAllClocks(),this.speakingLabel.node.active=!0;var n=t.getPlayerByUserId(t.describingPlayerId),i=this.truncateName(n.name);n&&(this.speakingLabel.string=i+" is Speaking")}},r.handleVotingState=function(t){this.setTimer(t.roomSettings.votingTimeLimit),this.showActivePlayerClock(),this.infoLabel.string="Time to Vote",this.button.active=!1},r.showActivePlayerClock=function(){this.resetClockAnimation(),this.clockContainer.active=!0,this.speakingLabel.node.active=!1},r.hideAllClocks=function(){this.clockContainer.active=!1,this.speakingLabel.node.active=!1,this.resetClockAnimation()},r.resetClockAnimation=function(){this.clockAnimationTween&&this.clockAnimationTween.stop(),this.clock.angle=this.initialClockContainerAngle,this.clock.position=this.initialClockContainerPosition.clone(),this.isClockAnimating=!1},r.onButtonClick=function(){Jt.Instance.sendMessage(Fe.PLAYER_DONE_DESCRIBING,"")},r.truncateName=function(t){var e=t.split(" ")[0];return e.length>8?e.substring(0,8)+"...":e},o}(h)).prototype,"clockContainer",[Jn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ni=t(ti.prototype,"timerLabel",[jn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ii=t(ti.prototype,"infoLabel",[Xn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),oi=t(ti.prototype,"button",[Zn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ri=t(ti.prototype,"clock",[Qn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ai=t(ti.prototype,"speakingLabel",[qn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$n=ti))||$n);l._RF.pop(),l._RF.push({},"07b70sAjVpJwaiP6JfloUn9","Mafia_TopInfo",void 0);var wi,Ai,Ni,Oi,Pi,Li,Mi,Di,ki,Gi,Fi,zi,Hi,Vi,Bi,Ui,Wi,xi,Yi,Ki=c.ccclass,Ji=c.property,ji=(hi=Ki("MafiaTopInfo"),pi=Ji({type:I,tooltip:"Label for the top info"}),di=Ji({type:_,tooltip:"Villager info node"}),fi=Ji({type:_,tooltip:"Spy info node"}),gi=Ji({type:I,tooltip:"Villager word description"}),mi=Ji({type:I,tooltip:"Spy word description"}),hi((Si=t((vi=function(t){function o(){for(var e,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,n(e,"gameStateLabel",Si,i(e)),n(e,"villagerInfoNode",Ci,i(e)),n(e,"spyInfoNode",Ti,i(e)),n(e,"villagerWordDescription",bi,i(e)),n(e,"spyWordDescription",Ri,i(e)),e.localPlayerId="",e}e(o,t);var r=o.prototype;return r.start=function(){},r.update=function(t){},r.initialize=function(t){this.localPlayerId=ui.Instance.GetMyPlayerData().userId},r.onServerRoomStateChange=function(t){this.updateGameStateLabel(t.currentGameState),t.currentGameState===Je.WORD_DESCRIPTION&&this.updateRoleInfo(t)},r.updateGameStateLabel=function(t){var e,n=((e={})[Je.WORD_DESCRIPTION]="Describe",e[Je.VOTING]="Voting",e[Je.GAME_OVER]="Game Over",e);this.gameStateLabel.string=n[t]||"Describe"},r.updateRoleInfo=function(t){var e=t.currentSpyUserId===this.localPlayerId;this.villagerInfoNode.active=!e,this.spyInfoNode.active=e;var n=this.getPlayerFromState(t,this.localPlayerId),i=e?this.spyWordDescription:this.villagerWordDescription;n&&i&&(i.string="Word: "+n.describingWord)},r.getPlayerFromState=function(t,e){return t.playersData.find((function(t){return t.userId===e}))},o}(h)).prototype,"gameStateLabel",[pi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ci=t(vi.prototype,"villagerInfoNode",[di],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ti=t(vi.prototype,"spyInfoNode",[fi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bi=t(vi.prototype,"villagerWordDescription",[gi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ri=t(vi.prototype,"spyWordDescription",[mi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),yi=vi))||yi);l._RF.pop(),l._RF.push({},"87cedknW3FJRbtrrFF3SX9G","MafiaGameHandler",void 0);var Xi,Zi,Qi,qi,$i,to,eo,no,io,oo,ro,ao,so,lo,co,uo,ho,po,fo,go,mo,yo,vo,So=c.ccclass,Co=c.property,To=c.executionOrder,bo="[MafiaGameHandler]",Ro=new p,_o=(wi=So("MafiaGameHandler"),Ai=To(-1),Ni=Co({type:_,tooltip:"Container node for player instances"}),Oi=Co({type:ji,tooltip:"Reference to top info component"}),Pi=Co({type:Ii,tooltip:"Reference to game timer component"}),Li=Co({type:Ge,tooltip:"Reference to game timer component"}),Mi=Co({type:D,tooltip:"Color for the spy"}),Di=Co({type:D,tooltip:"Color for the villagers"}),ki=Co({type:[zn]}),wi(Gi=Ai(((Yi=function(t){function o(){for(var e,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,n(e,"playersContainer",zi,i(e)),n(e,"topInfo",Hi,i(e)),n(e,"clock",Vi,i(e)),n(e,"timer",Bi,i(e)),n(e,"spyColor",Ui,i(e)),n(e,"villagersColor",Wi,i(e)),n(e,"players",xi,i(e)),e.miloSDK=new j,e.currentRoomState=null,e.roomSettings=null,e.myPlayerNumber=-1,e.hasReconnected=!1,e.localPlayerId="",e}e(o,t);var a=o.prototype;return a.onLoad=function(){o._instance&&this.node.destroy(),o._instance=this,this.validateRequiredComponents(),this.registerEventListeners()},a.onDestroy=function(){this.cleanup()},a.cleanup=function(){this.unregisterNetworkEvents(),this.unregisterGameEvents(),this.unregisterOnBrowserClose(),o._instance===this&&(o._instance=null)},a.initialize=function(t){this.roomSettings=t,this.logInfo("Initialized with room settings",t)},a.validateRequiredComponents=function(){0===this.players.length&&this.logError("No players UI assigned"),this.playersContainer||this.logError("Players container not assigned"),this.timer||this.logError("Timer component not assigned")},a.registerEventListeners=function(){this.registerNetworkEvents(),this.registerGameEvents(),this.registerOnBrowserClose()},a.unregisterEventListeners=function(){this.unregisterNetworkEvents(),this.unregisterGameEvents(),this.unregisterOnBrowserClose()},a.registerNetworkEvents=function(){xt.on(gt.CONNECTION_STATE_CHANGE,this.onConnectionStateChange,this),Yt.on(gt.SERVER_ROOM_STATE_CHANGE,this.onServerRoomStateChange,this),Kt.on(gt.SERVER_MESSAGE,this.onServerMessage,this)},a.unregisterNetworkEvents=function(){xt.off(gt.CONNECTION_STATE_CHANGE,this.onConnectionStateChange,this),Yt.off(gt.SERVER_ROOM_STATE_CHANGE,this.onServerRoomStateChange,this),Kt.off(gt.SERVER_MESSAGE,this.onServerMessage,this)},a.registerGameEvents=function(){F.on(z.EVENT_HIDE,this.onGameHide,this),F.on(z.EVENT_SHOW,this.onGameShow,this),F.on(z.EVENT_RESTART,this.onGameRestart,this),F.on(z.EVENT_CLOSE,this.onGameClose,this)},a.unregisterGameEvents=function(){F.off(z.EVENT_HIDE,this.onGameHide,this),F.off(z.EVENT_SHOW,this.onGameShow,this),F.off(z.EVENT_RESTART,this.onGameRestart,this),F.off(z.EVENT_CLOSE,this.onGameClose,this)},a.registerOnBrowserClose=function(){window.addEventListener("beforeunload",this.onGameClose.bind(this))},a.unregisterOnBrowserClose=function(){window.removeEventListener("beforeunload",this.onGameClose.bind(this))},a.onServerMessage=function(t,e){this.logInfo("Server message received:",{type:t,message:e}),this.logInfo("Unhandled server message type:",t)},a.onServerRoomStateChange=function(t){this.currentRoomState?(this.currentRoomState.copyFrom(t),this.currentRoomState.currentRoomStatus!==Ee.END_GAME?this.hasReconnected?this.handleReconnection(this.currentRoomState):(this.handleRoomStateUpdate(this.currentRoomState),this.notifyComponentsOfStateChange(this.currentRoomState)):this.handleEndGameState()):this.initializeRoomState(t)},a.onConnectionStateChange=function(t,e){e===mt.DISCONNECTED?this.onGameDisconnect():t===mt.RECONNECTING&&e===mt.JOINED_ROOM&&(this.hasReconnected=!0,this.onGameReconnect())},a.onGameHide=function(){this.logInfo("Game hidden"),H.stopAll()},a.onGameShow=function(){this.logInfo("Game shown")},a.onGameRestart=function(){this.logInfo("Game restarted")},a.onGameClose=function(){this.logInfo("Game closed")},a.onGameDisconnect=function(){this.logInfo("Game disconnected")},a.onGameReconnect=function(){this.logInfo("Game reconnected")},a.initializeRoomState=function(t){t?(this.currentRoomState=new Yn,this.currentRoomState.copyFrom(t),this.initializeGameComponents(this.currentRoomState),this.currentRoomState.currentGameState!==Je.NONE&&(this.logInfo("Joined game in progress with state:",this.currentRoomState.currentGameState),this.sendReconnectionStateToAllPlayers(this.currentRoomState))):this.logError("Attempted to initialize with null room state")},a.initializeGameComponents=function(t){this.assignMyPlayerNumber(t),this.initializePlayers(t),this.initializeTopInfo(t),this.initializeClock(t)},a.handleEndGameState=function(){this.logInfo("Game Over - State Change:",this.currentRoomState)},a.handleReconnection=function(t){this.logInfo("Reconnection State Change:",t),this.sendReconnectionStateToAllPlayers(t),this.hasReconnected=!1},a.handleRoomStateUpdate=function(t){this.logInfo("Game State Change:",t.currentGameState),t.inputPayload.inputType===Fe.SET_STATE&&this.handleSetState(t)},a.handleSetState=function(t){this.logInfo("Handling SET STATE"),this.timer.reset(),this.timer.stopTimer(),this.logInfo("Game State Change:",t.currentGameState),Ro.emit(gt.GAME_STATE_CHANGE,t.currentGameState)},a.notifyComponentsOfStateChange=function(t){this.sendRoomStateToAllPlayers(t),this.sendRoomStateToTopInfo(t),this.sendRoomStateToClock(t)},a.initializePlayers=function(t){var e=this;this.logInfo("Initializing "+t.playersData.length+" players");var n=t.playersData.findIndex((function(t){return t.sessionId===Jt.Instance.CurrentRoom.sessionId})),i=0;-1!==n&&(this.players[i].initialize(t,n,!0),i++);t.playersData.forEach((function(o,r){r!==n&&(e.players[i].initialize(t,r,i%2==0),i++)}))},a.updatePlayerScores=function(){var t=this;this.currentRoomState&&[].concat(this.currentRoomState.playersData).sort((function(t,e){return e.score-t.score})).forEach((function(e,n){var i=t.players.find((function(t){return t.userId===e.userId}));i&&i.node&&(i.setScore(e.score),i.setRank(n+1),i.node.setSiblingIndex(n))}))},a.getPlayer=function(t){if(t)return this.players.find((function(e){return e.userId===t}));this.logWarning("Attempted to get player with empty ID")},a.assignMyPlayerNumber=function(t){var e=this;t.playersData.forEach((function(t,n){t.sessionId===Jt.Instance.CurrentRoom.sessionId&&(e.myPlayerNumber=n,e.localPlayerId=t.userId)}))},a.getPlayerName=function(t){var e;return(null==(e=this.players.find((function(e){return e.userId===t})))?void 0:e.playerName)||t},a.initializeTopInfo=function(t){this.topInfo.initialize(t)},a.initializeClock=function(t){this.clock.initialize(t)},a.sendRoomStateToAllPlayers=function(t){this.players.forEach((function(e){e.onServerRoomStateChange(t)}))},a.sendRoomStateToTopInfo=function(t){this.topInfo.onServerRoomStateChange(t)},a.sendRoomStateToClock=function(t){this.clock.onServerRoomStateChange(t)},a.sendReconnectionStateToAllPlayers=function(t){this.logInfo("Reconnection state sent to all players"),this.players.forEach((function(e){e.onReconnection(t)}))},a.getRoomState=function(){return this.currentRoomState},a.isMyTurn=function(){return!1},a.allPlayersFinished=function(){return!1},a.anyPlayerFinished=function(){return!1},a.sendChatMessageToServer=function(t){},a.logInfo=function(t,e){ht.info(bo+" "+t,e)},a.logError=function(t,e){ht.error(bo+" "+t,e)},a.logWarning=function(t,e){ht.warning(bo+" "+t,e)},a.logDebug=function(t,e){ht.debug(bo+" "+t,e)},a.log=function(t,e,n){void 0===n&&(n="info");var i=bo+" "+t;switch(n){case"error":ht.error(i,e);break;case"warn":ht.warning(i,e);break;case"debug":ht.debug(i,e);break;default:ht.info(i,e)}},a.TruncateName=function(t,e){return void 0===e&&(e=8),t?t.length>e?t.substring(0,e)+"..":t:""},r(o,null,[{key:"Instance",get:function(){if(!this._instance)throw ht.error(bo+" instance not initialized"),new Error("MafiaGameHandler instance not initialized");return this._instance}}]),o}(h))._instance=null,zi=t((Fi=Yi).prototype,"playersContainer",[Ni],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Hi=t(Fi.prototype,"topInfo",[Oi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Vi=t(Fi.prototype,"clock",[Pi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Bi=t(Fi.prototype,"timer",[Li],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ui=t(Fi.prototype,"spyColor",[Mi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new D(255,0,0,255)}}),Wi=t(Fi.prototype,"villagersColor",[Di],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new D(0,0,255,255)}}),xi=t(Fi.prototype,"players",[ki],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Gi=Fi))||Gi)||Gi);l._RF.pop(),l._RF.push({},"583b9vAPVFLKIWeORwwOp7K","Mafia_AudioManager",void 0);var Eo,Io,wo,Ao,No,Oo,Po,Lo=c.ccclass,Mo=c.property,Do=(Xi=Lo("MafiaAudioClipData"),Zi=Mo({type:V}),Qi=Mo({type:B}),qi=Mo({type:U}),$i=Mo({type:U}),to=Mo({type:d}),Xi((io=t((no=function(){function t(){n(this,"name",io,this),n(this,"audioClips",oo,this),n(this,"delayBetweenClips",ro,this),n(this,"volume",ao,this),n(this,"loop",so,this),this.isLoopPlaying=void 0,this.lastPlayedTime=0,this.clipIndex=0}var e=t.prototype;return e.GetClip=function(){var t=this.audioClips[this.clipIndex];if(this.clipIndex=(this.clipIndex+1)%this.audioClips.length,this.CanPlay())return this.lastPlayedTime=Date.now(),t},e.CanPlay=function(){return Date.now()-this.lastPlayedTime>1e3*this.delayBetweenClips},t}()).prototype,"name",[Zi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oo=t(no.prototype,"audioClips",[Qi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ro=t(no.prototype,"delayBetweenClips",[qi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ao=t(no.prototype,"volume",[$i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),so=t(no.prototype,"loop",[to],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eo=no))||eo),ko=(lo=Lo("MafiaAudioManager"),co=Mo({type:Do}),uo=Mo({type:W}),ho=Mo({type:M}),lo(((vo=function(t){function o(){for(var e,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,n(e,"audioClipData",go,i(e)),n(e,"backgroundAudioSource",mo,i(e)),e.localStorageAudioEnabledKey="SNLAudioEnabled",n(e,"audioSourcePrefab",yo,i(e)),e.audioSources=[],e._isAudioEnabled="true",e}e(o,t);var a=o.prototype;return a.onLoad=function(){o.instance=this,this.ReadAudioEnabledFromLocalStorage()},a.onDestroy=function(){o.instance===this&&(o.instance=null)},a.start=function(){this.SetAudioEnabled(this.IsAudioEnabled)},a.playSound=function(t){if("false"!=this.IsAudioEnabled){var e=this.audioClipData.find((function(e){return e.name==t}));if(null!=e){var n=e.GetClip();if(n){if(e.isLoopPlaying)return;var i=this.getEmptyAudioSource();i.loop=e.loop,e.isLoopPlaying=e.loop,i.volume=e.volume,i.clip=n,e.loop?i.play():i.playOneShot(n)}else console.warn("Audio Clip is in use ",t)}}},a.stopSound=function(t){var e=this.audioClipData.find((function(e){return e.name==t}));e?this.audioSources.forEach((function(t){t.clip==e.audioClips[e.clipIndex]&&(e.isLoopPlaying=!1,t.stop())})):console.warn("Audio Clip not found for ",t)},a.stopAllSounds=function(){this.audioSources.forEach((function(t){t.stop()})),this.audioClipData.forEach((function(t){t.isLoopPlaying=!1}))},a.ToggleAudio=function(){"true"==this.IsAudioEnabled?this.SetAudioEnabled("false"):this.SetAudioEnabled("true")},a.SetAudioEnabled=function(t){this._isAudioEnabled=t,this.UpdateBackgroundMusic(),this.WriteAudioEnabledToLocalStorage()},a.WriteAudioEnabledToLocalStorage=function(){u.localStorage.setItem(this.localStorageAudioEnabledKey,this.IsAudioEnabled)},a.ReadAudioEnabledFromLocalStorage=function(){var t=u.localStorage.getItem(this.localStorageAudioEnabledKey);this._isAudioEnabled=null==t?"true":t},a.UpdateBackgroundMusic=function(){var t,e;"true"==this.IsAudioEnabled?null==(t=this.backgroundAudioSource)||t.play():null==(e=this.backgroundAudioSource)||e.stop()},a.printAllPlayingAudioSources=function(){this.audioSources.forEach((function(t){t.playing&&console.log("Playing audio source: ",t.playing,t.clip.name,t.uuid)}))},a.getEmptyAudioSource=function(){var t=this.audioSources.find((function(t){return!t.playing}));return null==t&&(t=this.createAudioSource()),t},a.createAudioSource=function(){var t=k(this.audioSourcePrefab).getComponent(W);return t.node.setParent(this.node),this.audioSources.push(t),console.log("==== Created new audio source: ",this.audioSources.length),t},r(o,[{key:"IsAudioEnabled",get:function(){return this._isAudioEnabled}}]),o}(h)).instance=null,go=t((fo=vo).prototype,"audioClipData",[co],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),mo=t(fo.prototype,"backgroundAudioSource",[uo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),yo=t(fo.prototype,"audioSourcePrefab",[ho],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),po=fo))||po);l._RF.pop(),l._RF.push({},"8c5d0A4WHpGsL9G+FTlKBPq","Mafia_Menu",void 0);var Go,Fo,zo,Ho,Vo,Bo=c.ccclass,Uo=c.property,Wo=(Eo=Bo("MafiaMenu"),Io=Uo({type:_}),wo=Uo({type:V}),Eo((Oo=t((No=function(t){function o(){for(var e,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,n(e,"content",Oo,i(e)),n(e,"menuName",Po,i(e)),e.isOpened=!1,e}e(o,t);var r=o.prototype;return r.onLoad=function(){null==this.content&&(this.content=this.node.getChildByName("Content"))},r.Open=function(){this.content.active=!0,this.isOpened=!0},r.Close=function(){this.content.active=!1,this.isOpened=!1},r.initialize=function(){ht.info("Menu initialize called")},o}(h)).prototype,"content",[Io],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Po=t(No.prototype,"menuName",[wo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ao=No))||Ao);l._RF.pop(),l._RF.push({},"3dc1dnlbAFCt5Kw25yShK3d","Mafia_CountDownScreen",void 0);var xo,Yo,Ko,Jo,jo,Xo,Zo,Qo,qo,$o,tr,er,nr,ir,or,rr,ar,sr,lr,cr,ur,hr=c.ccclass,pr=c.property;Go=hr("MafiaCountdownScreen"),Fo=pr({type:I}),Go((Vo=t((Ho=function(t){function o(){for(var e,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))||this)._countdownTween=null,n(e,"countdownText",Vo,i(e)),e}e(o,t);var r=o.prototype;return r.onLoad=function(){t.prototype.onLoad.call(this)},r.onDestroy=function(){},r.Open=function(){t.prototype.Open.call(this),this.initialization()},r.Close=function(){t.prototype.Close.call(this),null!=this._countdownTween&&this._countdownTween.stop()},r.initCountdownTween=function(){var t=this;this.countdownText.node.active=!0,this._countdownTween=G(this.countdownText.node);for(var e=function(e){t._countdownTween.call((function(){t.countdownText.string=e.toString(),t.countdownText.node.scale=E.ONE.clone().multiplyScalar(2)})).to(.4,{scale:E.ONE.clone().multiplyScalar(1)},{easing:"sineIn"}).delay(.6).start()},n=3;n>=1;n--)e(n);this._countdownTween.call((function(){t.deactivateScreen()}))},r.deactivateScreen=function(){this.countdownText.string="",this.countdownText.node.active=!1},r.initialization=function(){this.initCountdownTween(),this._countdownTween.start()},o}(Wo)).prototype,"countdownText",[Fo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),zo=Ho));l._RF.pop(),l._RF.push({},"623bfmdNW1Ds6bkt4iZR28n","Mafia_EndRoundScreen",void 0);var dr,fr,gr,mr,yr,vr,Sr,Cr,Tr,br,Rr,_r,Er,Ir,wr,Ar,Nr,Or,Pr,Lr=c.ccclass,Mr=c.property,Dr="[EndRoundScreen]";xo=Lr("MafiaEndRoundScreen"),Yo=Mr({type:w,tooltip:"Background"}),Ko=Mr({type:I,tooltip:"Heading"}),Jo=Mr({type:x,tooltip:"Players Layout"}),jo=Mr({type:Dn,tooltip:"Spy Avatar"}),Xo=Mr({type:I,tooltip:"Spy Name"}),Zo=Mr({type:_,tooltip:"Villagers Container"}),Qo=Mr({type:M,tooltip:"Avatar with name"}),qo=Mr({type:I,tooltip:"Spy Word"}),$o=Mr({type:I,tooltip:"Villagers Word"}),xo((nr=t((er=function(t){function o(){for(var e,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,n(e,"headingBackground",nr,i(e)),n(e,"heading",ir,i(e)),n(e,"playersLayout",or,i(e)),n(e,"spyAvatar",rr,i(e)),n(e,"spyName",ar,i(e)),n(e,"villagersContainer",sr,i(e)),n(e,"avatarWithName",lr,i(e)),n(e,"spyWord",cr,i(e)),n(e,"villagersWord",ur,i(e)),e.villagers=[],e}e(o,t);var r=o.prototype;return r.Open=function(){t.prototype.Open.call(this),this.setupScreen()},r.Close=function(){t.prototype.Close.call(this)},r.setupScreen=function(){var t=_o.Instance.getRoomState();if(t){var e=t.playersData.find((function(e){return e.userId===t.currentSpyUserId}));if(e){var n=!e.isDead;this.updateScreenHeader(n),this.updateSpyDisplay(),this.updateVillagersDisplay(),this.updateWords()}else console.error(Dr+" Cannot find spy player with ID: "+t.currentSpyUserId)}else console.error(Dr+" Cannot setup screen: Room state is null")},r.updateScreenHeader=function(t){var e=_o.Instance;this.heading.string=t?"Villagers Failed":"Spies Failed",this.headingBackground.color=t?e.spyColor:e.villagersColor,this.playersLayout.verticalDirection=t?1:0},r.updateSpyDisplay=function(){var t=_o.Instance,e=t.getRoomState();if(e){var n=e.playersData.find((function(t){return t.userId===e.currentSpyUserId}));if(n){var i=t.getPlayer(n.userId);i&&(this.spyAvatar.setAvatarFromSpriteFrame(i.playerAvatar.playerAvatar.spriteFrame),this.spyName.string=i.playerName,this.spyAvatar.ShowSkull(n.isDead))}}},r.updateVillagersDisplay=function(){var t=_o.Instance.getRoomState();if(t){var e=t.currentSpyUserId,n=t.playersData.filter((function(t){return t.userId!==e})),i=this.villagers.map((function(t){return t.userId}));this.removeOldVillagers(i,n),this.addNewVillagers(i,n)}},r.removeOldVillagers=function(t,e){var n=this;this.villagers.filter((function(t){return!e.some((function(e){return e.userId===t.userId}))})).forEach((function(t){var e=n.villagers.indexOf(t);-1!==e&&(n.villagers.splice(e,1),t.node.destroy())}))},r.addNewVillagers=function(t,e){var n=this;e.filter((function(e){return!t.some((function(t){return t===e.userId}))})).forEach((function(t){n.createVillagerDisplay(t)}))},r.createVillagerDisplay=function(t){var e,n=_o.Instance,i=n.getPlayer(t.userId);if(i){var o=k(this.avatarWithName),r=o.getComponent(Dn),a=null==(e=o.getChildByName("Name"))?void 0:e.getComponent(I);if(!r||!a)return console.error(Dr+" Failed to get components from villager prefab"),void o.destroy();r.setAvatarFromSpriteFrame(i.playerAvatar.playerAvatar.spriteFrame),a.string=n.TruncateName(i.playerName),r.initialize(!1,t.userId),this.villagers.push(r),this.villagersContainer.addChild(o),r.ShowSkull(t.isDead)}},r.updateWords=function(){var t=_o.Instance.getRoomState();if(t){var e=t.playersData.find((function(e){return e.userId===t.currentSpyUserId})),n=t.playersData.find((function(e){return e.userId!==t.currentSpyUserId}));e&&n&&(this.spyWord.string=e.describingWord,this.villagersWord.string=n.describingWord)}},o}(Wo)).prototype,"headingBackground",[Yo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ir=t(er.prototype,"heading",[Ko],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),or=t(er.prototype,"playersLayout",[Jo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rr=t(er.prototype,"spyAvatar",[jo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ar=t(er.prototype,"spyName",[Xo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),sr=t(er.prototype,"villagersContainer",[Zo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),lr=t(er.prototype,"avatarWithName",[Qo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),cr=t(er.prototype,"spyWord",[qo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ur=t(er.prototype,"villagersWord",[$o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tr=er));l._RF.pop(),l._RF.push({},"4952cIc/PlMopoNID/uP+1K","Mafia_PreparationScreen",void 0);var kr,Gr,Fr,zr,Hr,Vr=c.ccclass,Br=c.property,Ur="[PreparationScreen]";dr=Vr("MafiaPreparationScreen"),fr=Br({type:_,tooltip:"Container for the word display"}),gr=Br({type:_,tooltip:"Container for instructions"}),mr=Br({type:I,tooltip:"Word label"}),yr=Br({type:w,tooltip:"Background for word"}),vr=Br({type:I,tooltip:"Role label"}),Sr=Br({type:U,tooltip:"Time to display the word"}),Cr=Br({type:D,tooltip:"Color for villager UI"}),Tr=Br({type:D,tooltip:"Color for spy UI"}),dr((_r=t((Rr=function(t){function o(){for(var e,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,n(e,"wordContainer",_r,i(e)),n(e,"instructionContainer",Er,i(e)),n(e,"word",Ir,i(e)),n(e,"wordBgSprite",wr,i(e)),n(e,"youAreLabel",Ar,i(e)),n(e,"wordTimeLimit",Nr,i(e)),n(e,"villagerColor",Or,i(e)),n(e,"spyColor",Pr,i(e)),e.VILLAGER_TEXT="You are a Villager!",e.SPY_TEXT="You are the Spy!",e}e(o,t);var r=o.prototype;return r.Open=function(){t.prototype.Open.call(this),this.setupScreen()},r.setupScreen=function(){this.updateRoleDisplay(),this.showWordThenInstructions()},r.updateRoleDisplay=function(){var t=_o.Instance.getRoomState();if(t){var e=Jt.Instance.getMySessionId(),n=t.getPlayerBySessionId(e);if(n){var i=n.userId===t.currentSpyUserId;this.word.string=n.describingWord,i?(console.log(Ur+" Playing SpyWord sound"),ko.instance.playSound("SpyWord"),this.applySpyStyles()):this.applyVillagerStyles()}else console.error(Ur+" Cannot find player data for session ID: "+e)}else console.error(Ur+" Cannot setup screen: Room state is null")},r.applySpyStyles=function(){this.wordBgSprite.color=this.spyColor,this.youAreLabel.string=this.SPY_TEXT,this.word.color=this.spyColor},r.applyVillagerStyles=function(){this.wordBgSprite.color=this.villagerColor,this.youAreLabel.string=this.VILLAGER_TEXT,this.word.color=this.villagerColor},r.showWordThenInstructions=function(){this.instructionContainer.active=!1,this.wordContainer.active=!0,this.animateWordContainer(),this.scheduleOnce(this.transitionToInstructions,this.wordTimeLimit)},r.animateWordContainer=function(){this.wordContainer.scale=new E(1.2,1.2,1);var t=this.wordContainer.getComponent(Y);t||(t=this.wordContainer.addComponent(Y)),t.opacity=0,G(this.wordContainer).to(.2,{scale:new E(1,1,1)}).start(),G(t).to(.2,{opacity:255}).start()},r.transitionToInstructions=function(){this.wordContainer.active=!1,this.instructionContainer.active=!0,this.animateInstructionsContainer()},r.animateInstructionsContainer=function(){this.instructionContainer.scale=new E(1.2,1.2,1);var t=this.instructionContainer.getComponent(Y);t||(t=this.instructionContainer.addComponent(Y)),t.opacity=0,G(this.instructionContainer).to(.2,{scale:new E(1,1,1)}).start(),G(t).to(.2,{opacity:255}).start()},o}(Wo)).prototype,"wordContainer",[fr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Er=t(Rr.prototype,"instructionContainer",[gr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ir=t(Rr.prototype,"word",[mr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wr=t(Rr.prototype,"wordBgSprite",[yr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ar=t(Rr.prototype,"youAreLabel",[vr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Nr=t(Rr.prototype,"wordTimeLimit",[Sr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),Or=t(Rr.prototype,"villagerColor",[Cr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new D(0,0,0,1)}}),Pr=t(Rr.prototype,"spyColor",[Tr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new D(0,0,0,1)}}),br=Rr));l._RF.pop(),l._RF.push({},"28432gn1jZNmoVOMCSvOamH","Mafia_StartRoundScreen",void 0);var Wr,xr,Yr,Kr,Jr,jr,Xr,Zr,Qr,qr,$r=c.ccclass,ta=c.property;kr=$r("MafiaStartRoundScreen"),Gr=ta({type:I,tooltip:"Label displaying the current round number"}),kr((Hr=t((zr=function(t){function o(){for(var e,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,n(e,"roundCountLabel",Hr,i(e)),e.roundTween=null,e.INITIAL_SCALE=2,e.FINAL_SCALE=1,e.ANIMATION_DURATION=.4,e}e(o,t);var r=o.prototype;return r.Open=function(){t.prototype.Open.call(this),this.updateRoundCount()},r.Close=function(){this.stopActiveTween(),t.prototype.Close.call(this)},r.updateRoundCount=function(){var t=_o.Instance.getRoomState();if(t){var e=t.currentRound;this.stopActiveTween(),this.resetLabelScale(),this.updateLabelText(e),this.animateLabel()}else console.error("[StartRoundScreen] Cannot update round count: Room state is null")},r.stopActiveTween=function(){this.roundTween&&(this.roundTween.stop(),this.roundTween=null)},r.resetLabelScale=function(){var t=new E(this.INITIAL_SCALE,this.INITIAL_SCALE,1);this.roundCountLabel.node.setScale(t)},r.updateLabelText=function(t){this.roundCountLabel.string="Round "+t},r.animateLabel=function(){var t=new E(this.FINAL_SCALE,this.FINAL_SCALE,1);this.roundTween=G(this.roundCountLabel.node).to(this.ANIMATION_DURATION,{scale:t},{easing:"sineIn"}).delay(1).start()},o}(Wo)).prototype,"roundCountLabel",[Gr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Fr=zr));l._RF.pop(),l._RF.push({},"a805dDOrVBG5KVSZZ4CAGEg","Mafia_UIManager",void 0);var ea,na,ia,oa,ra,aa,sa,la,ca,ua,ha,pa,da,fa,ga,ma,ya,va,Sa,Ca,Ta,ba,Ra,_a,Ea,Ia,wa,Aa=c.ccclass,Na=c.property,Oa=(Wr=Aa("MafiaUIManager"),xr=Na({type:g}),Yr=Na({type:[Wo]}),Kr=Na({type:_}),Wr(((qr=function(t){function o(){for(var e,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,n(e,"uiCamera",Xr,i(e)),n(e,"menus",Zr,i(e)),n(e,"flashNode",Qr,i(e)),e.showMuteButton=!0,e.showResultScreen=!0,e.showFAQ=!0,e}e(o,t);var r=o.prototype;return r.onLoad=function(){o.instance=this,xt.on(gt.CONNECTION_STATE_CHANGE,this.onConnectionStateChange,this),ci.on(gt.ROOM_STATUS_CHANGE,this.onRoomStatusChange,this),Kt.on(gt.SERVER_MESSAGE,this.onServerMessage,this),Ro.on(gt.GAME_STATE_CHANGE,this.onGameStateChange,this)},r.onDestroy=function(){this.cleanup()},r.cleanup=function(){xt.off(gt.CONNECTION_STATE_CHANGE,this.onConnectionStateChange,this),ci.off(gt.ROOM_STATUS_CHANGE,this.onRoomStatusChange,this),Kt.off(gt.SERVER_MESSAGE,this.onServerMessage,this),Ro.off(gt.GAME_STATE_CHANGE,this.onGameStateChange,this),o.instance===this&&(o.instance=null)},r.start=function(){this.OpenMenu("InGameMenu")},r.onCameraOrthoSizeChange=function(t){console.log("[UIManager] Camera ortho size changed: ",t),this.uiCamera.orthoHeight=t},r.OpenHowToPlay=function(){this.OpenMenu("HowToPlay")},r.OpenMenu=function(t){for(var e=0;e<this.menus.length;e++)this.menus[e].menuName==t&&this.menus[e].Open()},r.CloseMenu=function(t){for(var e=0;e<this.menus.length;e++)this.menus[e].menuName==t&&this.menus[e].Close()},r.GetMenu=function(t){for(var e=0;e<this.menus.length;e++)if(this.menus[e].menuName==t)return this.menus[e];return null},r.CloseAllMenus=function(){for(var t=0;t<this.menus.length;t++)this.menus[t].Close()},r.onConnectionStateChange=function(t,e){switch(console.log("[UIManager] Connection state changed: ",e),e){case mt.CONNECTING:this.CloseAllMenus(),this.OpenMenu("InGameMenu")}},r.onGameStateChange=function(t){switch(t){case Je.START_ROUND:this.handleStartRoundState();break;case Je.CATEGORY_SELECTION:this.handleCategorySelectionState();break;case Je.PREPARATION:this.handlePreparationState();break;case Je.WORD_DESCRIPTION:this.handleWordDescriptionState();break;case Je.VOTING:this.handleVotingState();break;case Je.VOTING_RESULTS:this.handleVotingResultsState();break;case Je.END_ROUND:this.handleEndRoundState()}},r.handleStartRoundState=function(){console.log("[UIManager] Handling start round state"),this.CloseAllMenus(),this.OpenMenu("StartRoundScreen")},r.handleEndRoundState=function(){console.log("[UIManager] Handling end round state"),this.CloseAllMenus(),this.OpenMenu("EndRoundScreen")},r.handleCategorySelectionState=function(){console.log("[UIManager] Handling category selection state"),this.CloseAllMenus(),this.OpenMenu("CategorySelectionScreen")},r.handlePreparationState=function(){console.log("[UIManager] Handling preparation state"),this.CloseMenu("CategorySelectionScreen"),this.OpenMenu("PreparationScreen")},r.handleWordDescriptionState=function(){console.log("[UIManager] Handling word description state"),this.CloseMenu("PreparationScreen"),this.CloseMenu("VotingResultsScreen"),this.OpenMenu("WordDescriptionScreen")},r.handleVotingState=function(){console.log("[UIManager] Handling voting state"),this.CloseMenu("WordDescriptionScreen"),this.OpenMenu("VotingScreen")},r.handleVotingResultsState=function(){console.log("[UIManager] Handling voting results state"),this.CloseMenu("VotingScreen"),this.OpenMenu("VotingResultsScreen")},r.onServerMessage=function(t,e){},r.onRoomStatusChange=function(t,e){var n=this;switch(console.log("[UIManager] Room status changed: ",e),e){case Ee.WAITING_FOR_PLAYERS:console.log("Opening waiting screen"),this.OpenMenu("WaitingScreen");break;case Ee.COUNTDOWN:console.log("Opening countdown screen"),this.CloseAllMenus(),this.OpenMenu("CountDownScreen");break;case Ee.GAME_SIMULATION:this.scheduleOnce((function(){n.CloseMenu("CountdownScreen"),n.OpenMenu("InGameMenu")}),1);break;case Ee.END_GAME:break;default:console.warn("[UIManager] Unhandled RoomStatus: "+e)}},r.playFlashEffect=function(t){var e=this;void 0===t&&(t=new D(197,8,8)),this.flashNode.active=!0;var n=this.flashNode.getComponent(w);n?(n.color=new D(t.r,t.g,t.b,0),G(n).to(.2,{color:new D(t.r,t.g,t.b,255)}).delay(.05).to(.3,{color:new D(t.r,t.g,t.b,0)}).call((function(){e.flashNode.active=!1})).start()):console.error("No Sprite component found on flashNode")},o}(h)).instance=null,Xr=t((jr=qr).prototype,"uiCamera",[xr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Zr=t(jr.prototype,"menus",[Yr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Qr=t(jr.prototype,"flashNode",[Kr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Jr=jr))||Jr);l._RF.pop(),l._RF.push({},"87d25szwANAQpYk8OoLCrSo","Mafia_VotingResultsScreen",void 0);var Pa,La,Ma,Da,ka,Ga=c.ccclass,Fa=c.property,za="[VotingResultsScreen]";ea=Ga("MafiaVotingResultsScreen"),na=Fa({type:w,tooltip:"Background"}),ia=Fa({type:M,tooltip:"Voting Results Item Prefab"}),oa=Fa({type:Dn,tooltip:"Voted Player Avatar"}),ra=Fa({type:I,tooltip:"Voted Player Name"}),aa=Fa({type:I,tooltip:"Player Role"}),sa=Fa({type:I,tooltip:"Heading"}),la=Fa({type:_,tooltip:"Tie Sprite"}),ca=Fa({type:_}),ua=Fa({type:_}),ha=Fa({type:w}),pa=Fa({type:w}),da=Fa({type:K}),ea((ma=t((ga=function(t){function o(){for(var e,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,n(e,"background",ma,i(e)),n(e,"votingResultsItemPrefab",ya,i(e)),n(e,"votedPlayerAvatar",va,i(e)),n(e,"votedPlayerName",Sa,i(e)),n(e,"playerRole",Ca,i(e)),n(e,"votedHeading",Ta,i(e)),n(e,"tieSprite",ba,i(e)),n(e,"votedContainer",Ra,i(e)),n(e,"skullContainer",_a,i(e)),n(e,"skullBG",Ea,i(e)),n(e,"skull",Ia,i(e)),n(e,"tieAnimation",wa,i(e)),e.VOTE_RESULT_DISPLAY_TIME=2,e.VOTER_AVATAR_SIZE=new R(70,70),e}e(o,t);var r=o.prototype;return r.Open=function(){t.prototype.Open.call(this),this.setupScreen()},r.setupScreen=function(){var t=_o.Instance,e=t.getRoomState();if(e){if(e.tieBreakRound>0)return ko.instance.playSound("Tie"),this.tieSprite.active=!0,this.tieAnimation.play(),void(this.votedContainer.active=!1);this.tieSprite.active=!1,this.votedContainer.active=!0;var n=this.getMostVotedPlayerId(),i=t.getPlayer(n);i?this.showEliminationResult(i.playerName,n):console.error(za+" Cannot find player with ID: "+n)}else console.error(za+" Cannot setup screen: Room state is null")},r.animateSkull=function(){var t=a(s().mark((function t(){var e,n,i=this;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.skullContainer.active=!0,(e=this.skullBG.getComponent(Y))||(e=this.skullBG.addComponent(Y)),e.opacity=0,this.skull.node.scale=new E(4,4,1),(n=this.skull.getComponent(Y))||(n=this.skull.addComponent(Y)),n.opacity=0,t.next=10,new Promise((function(t){i.scheduleOnce((function(){t(null)}),.5)}));case 10:G(e).to(.2,{opacity:125}).start(),this.scheduleOnce((function(){G(i.skull.node).to(.15,{scale:new E(.9,.9,1)}).to(.1,{scale:new E(1,1,1)}).start(),G(n).to(.15,{opacity:255}).start()}),.1);case 12:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),r.animateVotedContainer=function(){this.votedContainer.scale=new E(1.2,1.2,1);var t=this.votedContainer.getComponent(Y);t||(t=this.votedContainer.addComponent(Y)),t.opacity=0,G(this.votedContainer).to(.2,{scale:new E(1,1,1)}).start(),G(t).to(.2,{opacity:255}).start()},r.showEliminationResult=function(t,e){var n=_o.Instance.getRoomState(),i=Jt.Instance.getMySessionId(),o=n.getPlayerBySessionId(i);if(n){var r=_o.Instance.getPlayer(e);r&&(this.votedPlayerAvatar.setAvatarFromSpriteFrame(r.playerAvatar.playerAvatar.spriteFrame),this.votedPlayerName.string=r.playerName,this.votedPlayerName.color=D.BLACK),this.votedContainer.active=!0,this.tieSprite.active=!1,this.animateVotedContainer(),this.votedHeading.string=t+" got out!",this.votedPlayerName.color=D.WHITE,n.currentSpyUserId===e?(this.applySpyStyles(),o&&o.userId!==e&&Oa.instance.playFlashEffect(new D(0,255,0,255)),ko.instance.playSound("Yaay")):(this.applyVillagerStyles(),o&&o.userId!==e&&Oa.instance.playFlashEffect(new D(255,0,0,255)),ko.instance.playSound("OhNo")),this.animateSkull()}},r.applySpyStyles=function(){var t=_o.Instance;this.playerRole.color=t.spyColor,this.background.color=t.spyColor,this.playerRole.string="Spy"},r.applyVillagerStyles=function(){var t=_o.Instance;this.playerRole.color=t.villagersColor,this.background.color=t.villagersColor,this.playerRole.string="Villager"},r.getMostVotedPlayerId=function(){var t=_o.Instance.getRoomState();if(!t||!t.playersData||0===t.playersData.length)return console.error(za+" Invalid room state data"),"";var e=this.countVotes(t.playersData),n="",i=0;return Object.keys(e).forEach((function(t){var o=e[t];o>i&&(i=o,n=t)})),n},r.countVotes=function(t){var e={};return t.forEach((function(t){t.votedSpyUserId&&(e[t.votedSpyUserId]=(e[t.votedSpyUserId]||0)+1)})),e},o}(Wo)).prototype,"background",[na],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ya=t(ga.prototype,"votingResultsItemPrefab",[ia],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),va=t(ga.prototype,"votedPlayerAvatar",[oa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Sa=t(ga.prototype,"votedPlayerName",[ra],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ca=t(ga.prototype,"playerRole",[aa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ta=t(ga.prototype,"votedHeading",[sa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ba=t(ga.prototype,"tieSprite",[la],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ra=t(ga.prototype,"votedContainer",[ca],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_a=t(ga.prototype,"skullContainer",[ua],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ea=t(ga.prototype,"skullBG",[ha],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ia=t(ga.prototype,"skull",[pa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wa=t(ga.prototype,"tieAnimation",[da],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fa=ga));l._RF.pop(),l._RF.push({},"5c988B1YEtKMrDLkvStEf29","Mafia_VotingScreen",void 0);var Ha,Va=c.ccclass,Ba=c.property;Pa=Va("MafiaVotingScreen"),La=Ba({type:_}),Pa((ka=t((Da=function(t){function o(){for(var e,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,n(e,"infoContainer",ka,i(e)),e}e(o,t);var r=o.prototype;return r.Open=function(){var e=this;t.prototype.Open.call(this),this.infoContainer.active=!0,this.animateInfoContainer(),this.scheduleOnce((function(){e.Close()}),3)},r.animateInfoContainer=function(){this.infoContainer.scale=new E(1.2,1.2,1);var t=this.infoContainer.getComponent(Y);t||(t=this.infoContainer.addComponent(Y)),t.opacity=0,G(this.infoContainer).to(.2,{scale:new E(1,1,1)}).start(),G(t).to(.2,{opacity:255}).start()},o}(Wo)).prototype,"infoContainer",[La],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ma=Da));l._RF.pop(),l._RF.push({},"16b50I2dNVB9Z0Y9XMNdt/e","Mafia_WaitingScreen",void 0);var Ua,Wa=c.ccclass;c.property,Wa("MafiaWaitingScreen")(Ha=function(t){function n(){return t.apply(this,arguments)||this}return e(n,t),n}(Wo));l._RF.pop(),l._RF.push({},"b9dd67SajxB973UHAenpXcV","Mafia_WordDescriptionScreen",void 0);var xa=c.ccclass;c.property,xa("MafiaWordDescriptionScreen")(Ua=function(t){function n(){return t.apply(this,arguments)||this}return e(n,t),n}(Wo));l._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/mafia_game', 'chunks:///mafia_game.js'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});