System.register("chunks:///dr_monkey.js",["./rollupPluginModLoBabelHelpers-5eee144e.js","cc","./colyseus.mjs_cjs=&original=-36827661.js"],(function(){var e,t,n,i,o,r,a,s,l,c,u,h,p,d,m,f,g,y,S,v,T,E,_,C,b,A,R,N,w,I,O,P,D,M,L,G,k,H,F,z,U,x,B,J,V,W,K,Y,j,q,X,Z,Q,$,ee;return{setters:[function(c){e=c._,t=c.a,n=c.b,i=c.c,o=c.h,r=c.d,a=c.f,s=c.g,l=c.e},function(e){c=e.cclegacy,u=e._decorator,h=e.sys,p=e.Component,d=e.EventTarget,m=e.CCBoolean,f=e.UITransform,g=e.Camera,y=e.screen,S=e.view,v=e.math,T=e.CCFloat,E=e.director,_=e.Director,C=e.Widget,b=e.Enum,A=e.Size,R=e.Node,N=e.Vec3,w=e.Label,I=e.Sprite,O=e.Color,P=e.tween,D=e.CCInteger,M=e.assetManager,L=e.Texture2D,G=e.SpriteFrame,k=e.Prefab,H=e.game,F=e.Game,z=e.instantiate,U=e.Tween,x=e.Asset,B=e.resources,J=e.CCString,V=e.AudioClip,W=e.AudioSource,K=e.VideoPlayer,Y=e.Animation,j=e.UIOpacity,q=e.Button,X=e.EditBox,Z=e.easing,Q=e.RichText},function(e){$=e._,ee=e.M}],execute:function(){c._RF.push({},"d5bed5yJ51Hg7PKbEO3HZp5","DrMonkey_PBLogger",void 0);var te,ne,ie,oe,re,ae,se,le,ce,ue,he,pe,de,me,fe,ge=function(e){return e[e.Debug=0]="Debug",e[e.Info=1]="Info",e[e.Warning=2]="Warning",e[e.Error=3]="Error",e}({}),ye=function(){function e(){}return e.debug=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this.log(ge.Debug,e,n)},e.info=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this.log(ge.Info,e,n)},e.warning=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this.log(ge.Warning,e,n)},e.error=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this.log(ge.Error,e,n)},e.log=function(e,t,n){if(e>=this.currentLevel){var i,o=ge[e]+": "+t;if((i=console).log.apply(i,[o].concat(n)),this.isProduction&&window.ReactNativeWebView)try{var r={type:"log",level:ge[e],message:o,params:n};window.ReactNativeWebView.postMessage(JSON.stringify(r))}catch(e){console.error("Failed to send log to ReactNativeWebView:",e)}}},e.setLevel=function(e){this.currentLevel=e},e.setProductionMode=function(e){this.isProduction=e},e}();ye.currentLevel=ge.Debug,ye.isProduction=!1,c._RF.pop(),c._RF.push({},"80cbbK8AJ5NPZgppY66OGie","DrMonkey_NetworkConfig",void 0);var Se=u.ccclass,ve=u.property,Te=(te=Se("DrMonkeyNetworkConfig"),ne=ve({tooltip:"Server host address"}),ie=ve({tooltip:"Server port number"}),oe=ve({tooltip:"Use SSL for connections"}),re=ve({tooltip:"Player identifier"}),ae=ve({tooltip:"Room identifier"}),se=ve({tooltip:"Name of the game"}),te((ue=e((ce=function(e){function o(){for(var t,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,n(t,"serverHost",ue,i(t)),n(t,"serverPort",he,i(t)),n(t,"useSSL",pe,i(t)),n(t,"userId",de,i(t)),n(t,"roomId",me,i(t)),n(t,"gameName",fe,i(t)),t}t(o,e);var r=o.prototype;return r.initNetworkConfig=function(){if(h.isBrowser){var e=new URLSearchParams(window.location.search),t="true"===e.get("debug");ye.debug("Initializing network config (debug="+t+")"),t?this.parseQueryParams(e):this.parseInjectedConfig(),ye.debug("Final network config:",{serverHost:this.serverHost,serverPort:this.serverPort,useSSL:this.useSSL,userId:this.userId,roomId:this.roomId,gameName:this.gameName})}},r.parseQueryParams=function(e){var t=this;ye.debug("Parsing config from query parameters"),this.updateConfigFromQueryParam(e,"userId",(function(e){return t.userId=e})),this.updateConfigFromQueryParam(e,"roomId",(function(e){return t.roomId=e})),this.updateConfigFromQueryParam(e,"apiUrl",(function(e){return t.serverHost=e})),this.updateConfigFromQueryParam(e,"apiPort",(function(e){var n=parseInt(e);isNaN(n)||(t.serverPort=n)})),this.updateConfigFromQueryParam(e,"useSSL",(function(e){return t.useSSL="true"===e}))},r.parseInjectedConfig=function(){ye.debug("Parsing config from injected GameConfig");try{var e=window.GameConfig;if(!e)return void ye.debug("No injected GameConfig found");var t="string"==typeof e?JSON.parse(e):e;this.applyConfig(t)}catch(e){ye.debug("Failed to parse injected GameConfig:",e)}},r.applyConfig=function(e){var t,n,i,o,r;e&&(this.userId=null!=(t=e.userId)?t:this.userId,this.roomId=null!=(n=e.roomId)?n:this.roomId,this.serverHost=null!=(i=e.apiUrl)?i:this.serverHost,this.serverPort=Number(null!=(o=e.apiPort)?o:this.serverPort),this.useSSL=null!=(r=e.useSSL)?r:this.useSSL)},r.updateConfigFromQueryParam=function(e,t,n){var i=e.get(t);null!=i&&n(i)},o}(p)).prototype,"serverHost",[ne],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"localhost"}}),he=e(ce.prototype,"serverPort",[ie],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2567}}),pe=e(ce.prototype,"useSSL",[oe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),de=e(ce.prototype,"userId",[re],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),me=e(ce.prototype,"roomId",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"testroom1"}}),fe=e(ce.prototype,"gameName",[se],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"Pictionary"}}),le=ce))||le);c._RF.pop(),c._RF.push({},"8f10e5P7RBLvY4KTVlDifSk","DrMonkey_NetworkTypes",void 0);var Ee=function(e){return e[e.SERVER_ROOM_STATE_CHANGE=0]="SERVER_ROOM_STATE_CHANGE",e[e.CONNECTION_STATE_CHANGE=1]="CONNECTION_STATE_CHANGE",e[e.ROOM_STATUS_CHANGE=2]="ROOM_STATUS_CHANGE",e[e.GAME_STATE_CHANGE=3]="GAME_STATE_CHANGE",e[e.SERVER_MESSAGE=4]="SERVER_MESSAGE",e}({}),_e=function(e){return e[e.INITIALIZING=0]="INITIALIZING",e[e.CONNECTING=1]="CONNECTING",e[e.CONNECTED=2]="CONNECTED",e[e.LOBBY=3]="LOBBY",e[e.JOINED_ROOM=4]="JOINED_ROOM",e[e.DISCONNECTED=5]="DISCONNECTED",e[e.RECONNECTING=6]="RECONNECTING",e[e.KICKED_OUT=7]="KICKED_OUT",e}({}),Ce=function(e){return e.NONE="none",e.KICKED_OUT="kicked_out",e.PLAYER_CAMEBACK="player_cameback",e.PLAYER_JOINED="player_joined",e}({});c._RF.pop(),c._RF.push({},"28c20+MmmxIqYXVZqdhn7tU","DrMonkey_PlayerTypes",void 0);var be,Ae=function(e){return e[e.HUMAN=0]="HUMAN",e[e.BOT=1]="BOT",e[e.SPECTATOR=2]="SPECTATOR",e}({});c._RF.pop(),c._RF.push({},"4909fUlx45MObum/rmfzcxr","DrMonkey_PbSaveSystem",void 0);var Re,Ne,we,Ie,Oe,Pe,De,Me,Le=(0,u.ccclass)("DrMonkeyPbSaveSystem")(be=function(){function e(){}return e.SaveData=function(e,t){ye.info("============ Saving data in pb save system ========="),h.localStorage.setItem(e,JSON.stringify(t))},e.LoadData=function(e){return JSON.parse(h.localStorage.getItem(e))},e.RemoveData=function(e){h.localStorage.removeItem(e)},e.ClearAllData=function(){h.localStorage.clear()},e}())||be;c._RF.pop(),c._RF.push({},"837a9Fz1TtFDqKc2CMnXFBH","DrMonkey_NetworkManager",void 0);var Ge,ke,He,Fe,ze,Ue,xe,Be,Je,Ve,We,Ke,Ye=u.ccclass,je=u.property,qe={roomId:"testroom1",reconnectionToken:"eyJ"},Xe=new d,Ze=new d,Qe=new d,$e=(Re=Ye("DrMonkeyNetworkManager"),Ne=je({type:m,tooltip:"Enable development mode for additional logging"}),we=je({type:Te,tooltip:"Network configuration settings"}),Re(((Me=function(e){function l(){for(var t,r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return t=e.call.apply(e,[this].concat(a))||this,n(t,"isDevMode",Pe,i(t)),n(t,"networkConfig",De,i(t)),t._client=void 0,t._room=void 0,t._currentConnectionState=_e.INITIALIZING,t._reconnectionData=o({},qe),t}t(l,e);var c=l.prototype;return c.onLoad=function(){l._instance&&(this.log("NetworkManager instance already exists. Destroying duplicate."),this.node.destroy()),l._instance=this,this.networkConfig.initNetworkConfig(),this.isDevMode||ye.setProductionMode(!0)},c.start=function(){this.initializeClient(),ye.info("============ Initializing client ========="),ye.info("============ Connecting to room ========="),this.connect(this.networkConfig.roomId,this.networkConfig.userId)},c.onDestroy=function(){this.cleanup()},c.cleanup=function(){this._room&&(this.leaveRoom(),this._room=null),this._client&&(this._client=null),this._currentConnectionState=_e.INITIALIZING,this._reconnectionData=o({},qe),l._instance===this&&(l._instance=null)},c.initializeClient=function(){var e=this.networkConfig.useSSL?"wss":"ws",t="";t=0==this.networkConfig.serverPort?e+"://"+this.networkConfig.serverHost:e+"://"+this.networkConfig.serverHost+":"+this.networkConfig.serverPort,this.log("Initializing client with endpoint: "+t),this._client=new $.Client(t)},c.shouldRejoin=function(){return!this.isDevMode&&(this._reconnectionData=Le.LoadData(this.networkConfig.gameName),!!(this._reconnectionData&&this._reconnectionData.roomId&&this._reconnectionData.reconnectionToken)&&this._reconnectionData.roomId===this.networkConfig.roomId)},c.connect=function(){var e=a(s().mark((function e(t,n){var i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ye.info("============ Connecting to room from connect function ========="),this.updateConnectionState(_e.CONNECTING),!this.shouldRejoin()){e.next=7;break}return this.log("Rejoining room",t),e.next=6,this.rejoin();case 6:return e.abrupt("return");case 7:return e.prev=7,i=this.createPlayerData(n),this.log("Joining with options ",{player:i}),e.next=12,this._client.joinById(t,{player:i});case 12:this._room=e.sent,this.initAfterJoin(t),e.next=20;break;case 16:throw e.prev=16,e.t0=e.catch(7),this.handleConnectionError(e.t0),e.t0;case 20:case"end":return e.stop()}}),e,this,[[7,16]])})));return function(t,n){return e.apply(this,arguments)}}(),c.initAfterJoin=function(e){this.updateConnectionState(_e.JOINED_ROOM),this.log("Joined room "+e+" with sessionId: "+this._room.sessionId),this.initializeRoomCallbacks(),this.saveReconnectionData()},c.createAndJoinRoom=function(){var e=a(s().mark((function e(t,n){var i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.log("Creating room",t),this.updateConnectionState(_e.CONNECTING),e.prev=2,i=this.createPlayerData(n),e.next=6,this._client.create("PictionaryRoom",{roomId:t,player:i,roomSettings:{maxClients:10}});case 6:this._room=e.sent,this.initAfterJoin(t),e.next=14;break;case 10:throw e.prev=10,e.t0=e.catch(2),this.handleConnectionError(e.t0),e.t0;case 14:case"end":return e.stop()}}),e,this,[[2,10]])})));return function(t,n){return e.apply(this,arguments)}}(),c.createPlayerData=function(e){return{userId:e,name:e,avatar:"randomProfilePicture",type:Ae.HUMAN}},c.initializeRoomCallbacks=function(){var e=this;console.log("============ Initializing room callbacks ========="),this._room?(this._room.onStateChange((function(e){Ze.emit(Ee.SERVER_ROOM_STATE_CHANGE,e)})),this._room.onLeave((function(t){4001===t?e.updateConnectionState(_e.KICKED_OUT):e.updateConnectionState(_e.DISCONNECTED)})),this._room.onMessage(Ce.KICKED_OUT,(function(){e.updateConnectionState(_e.KICKED_OUT)})),this._room.onMessage("*",(function(e,t){Qe.emit(Ee.SERVER_MESSAGE,e,t)}))):this.log("Cannot initialize callbacks: Room is not defined")},c.updateConnectionState=function(e){if(this._currentConnectionState!==e){var t=this._currentConnectionState;this._currentConnectionState=e,this.log("Connection state changed: "+_e[t]+" -> "+_e[e]),Xe.emit(Ee.CONNECTION_STATE_CHANGE,t,e)}},c.reconnect=function(){var e=a(s().mark((function e(t,n,i){var o,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===t&&(t=1),void 0===n&&(n=10),void 0===i&&(i=2e3),this._currentConnectionState===_e.DISCONNECTED||this._currentConnectionState===_e.RECONNECTING){e.next=6;break}return this.log("Cannot reconnect: Current state is "+_e[this._currentConnectionState]),e.abrupt("return");case 6:return this._room&&this._room.state&&(o=this._room.state).roomSettings&&o.roomSettings.maxReconnectionAttempts&&(n=o.roomSettings.maxReconnectionAttempts),this.updateConnectionState(_e.RECONNECTING),this.log("Reconnect attempt "+t+"/"+n),e.prev=9,e.next=12,this.delay(i);case 12:if(this._room&&this._room.reconnectionToken){e.next=14;break}throw new Error("Reconnection token not available");case 14:return e.next=16,this._client.reconnect(this._room.reconnectionToken);case 16:r=e.sent,this._room=r,this.saveReconnectionData(),this.initializeRoomCallbacks(),this.updateConnectionState(_e.JOINED_ROOM),this.log("Reconnected successfully."),e.next=27;break;case 24:e.prev=24,e.t0=e.catch(9),this.handleReconnectionError(e.t0,t,n,i);case 27:case"end":return e.stop()}}),e,this,[[9,24]])})));return function(t,n,i){return e.apply(this,arguments)}}(),c.rejoin=function(){var e=a(s().mark((function e(t,n,i){var o,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===t&&(t=1),void 0===n&&(n=10),void 0===i&&(i=2e3),this.log("Rejoin attempt "+t+"/"+n),e.prev=4,e.next=7,this.delay(i);case 7:if(this._reconnectionData&&this._reconnectionData.reconnectionToken){e.next=9;break}throw new Error("Reconnection data not available");case 9:return o=this._reconnectionData.roomId+":"+this._reconnectionData.reconnectionToken,ye.info("Using formatted reconnection token: ",o),e.next=13,this._client.reconnect(o);case 13:r=e.sent,this._room=r,this.saveReconnectionData(),this.initializeRoomCallbacks(),this.updateConnectionState(_e.JOINED_ROOM),this.log("Rejoined successfully."),e.next=24;break;case 21:e.prev=21,e.t0=e.catch(4),this.handleReconnectionError(e.t0,t,n,i,"reJoin");case 24:case"end":return e.stop()}}),e,this,[[4,21]])})));return function(t,n,i){return e.apply(this,arguments)}}(),c.delay=function(){var e=a(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){return setTimeout(e,t)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c.handleConnectionError=function(e){var t=(null==e?void 0:e.message)||"Unknown error";this.log("Error connecting to room:",t),this.updateConnectionState(_e.DISCONNECTED)},c.handleReconnectionError=function(e,t,n,i,o){void 0===o&&(o="reconnect");var r=(null==e?void 0:e.message)||"Unknown error";this.log(o+" attempt "+t+" failed:",r),t<n||-1===n?"reconnect"===o?this.reconnect(t+1,n,i):this.rejoin(t+1,n,i):(this.log("Max reconnection attempts reached. Please check your network or contact support."),this.updateConnectionState(_e.DISCONNECTED))},c.saveReconnectionData=function(){if(ye.info("============ Saving reconnection data ========="),this._room&&this._room.reconnectionToken){var e=this._room.reconnectionToken;e.includes(":")&&(e=e.split(":")[1]),ye.info("saving Reconnection token: ",e),this._reconnectionData={roomId:this.networkConfig.roomId,reconnectionToken:e},Le.SaveData(this.networkConfig.gameName,this._reconnectionData),ye.info("Reconnection data saved")}else this.log("Cannot save reconnection data: Room or reconnection token not available")},c.leaveRoom=function(){var e=this;this._room?(this.log("Leaving room"),this._room.leave(!0).then((function(){return e.log("Left room successfully")})).catch((function(t){return e.log("Error leaving room:",(null==t?void 0:t.message)||"Unknown error")}))):this.log("Cannot leave room: Room is not defined")},c.getMySessionId=function(){return this._room.sessionId},c.sendMessage=function(e,t){this._room?(this.isDevMode&&this.log("Sending message:",e,t),this._room.send(e,t)):this.log("Cannot send message: Room is not defined")},c.log=function(e){if(this.isDevMode){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];n.length>0?ye.info.apply(ye,["[NetworkManager] "+e].concat(n)):ye.info("[NetworkManager] "+e)}},r(l,[{key:"CurrentRoom",get:function(){return this._room}},{key:"CurrentConnectionState",get:function(){return this._currentConnectionState}}],[{key:"Instance",get:function(){if(!this._instance)throw new Error("NetworkManager instance is not initialized.");return this._instance}}]),l}(p))._instance=null,Pe=e((Oe=Me).prototype,"isDevMode",[Ne],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),De=e(Oe.prototype,"networkConfig",[we],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ie=Oe))||Ie);c._RF.pop(),c._RF.push({},"3f3ff+JHhVCB50fEFvbM/3Q","DrMonkey_CameraManger",void 0);var et=u.ccclass,tt=u.property,nt=u.executionOrder,it=new d;nt(-100);var ot,rt,at,st,lt,ct,ut,ht,pt,dt,mt,ft=(Ge=et("DrMonkeyCameraManger"),ke=tt({type:f}),Ge(((Ke=function(e){function o(){for(var t,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,n(t,"canvasUITransform",ze,i(t)),n(t,"designHeight",Ue,i(t)),n(t,"designWidth",xe,i(t)),n(t,"defaultOrthoHeight",Be,i(t)),n(t,"minOrthoHeight",Je,i(t)),n(t,"maxOrthoHeight",Ve,i(t)),n(t,"safeAreaPadding",We,i(t)),t.designAspectRatio=void 0,t.currentAspectRatio=void 0,t.camera=null,t.windowWidth=1080,t.windowHeight=1920,t.effectiveWidth=0,t.effectiveHeight=0,t.effectiveAspectRatio=0,t}t(o,e);var r=o.prototype;return r.onLoad=function(){o.instance=this,this.designAspectRatio=this.designWidth/this.designHeight,this.camera=this.node.getComponent(g)},r.start=function(){var e=this;this.updateScreenSize(),this.adaptCameraToScreen(),window.addEventListener("resize",(function(){e.updateScreenSize(),e.adaptCameraToScreen()}))},r.updateScreenSize=function(){this.windowWidth=y.windowSize.width||window.innerWidth,this.windowHeight=y.windowSize.height||window.innerHeight,this.currentAspectRatio=this.windowWidth/this.windowHeight},r.adaptCameraToScreen=function(){if(this.camera){var e=0,t=0,n=0,i=0;if(h.os===h.OS.IOS||h.os===h.OS.ANDROID){var o=S.getVisibleSize(),r=S.getVisibleOrigin();o&&(e=r.y,t=this.windowHeight-(r.y+o.height),n=r.x,i=this.windowWidth-(r.x+o.width))}this.effectiveHeight=this.windowHeight-e-t-2*this.safeAreaPadding,this.effectiveWidth=this.windowWidth-n-i-2*this.safeAreaPadding,this.effectiveAspectRatio=this.effectiveWidth/this.effectiveHeight;var a=this.currentAspectRatio>=1,s=this.defaultOrthoHeight;if(a)s=this.defaultOrthoHeight*(1/this.currentAspectRatio)*1.5;else{var l=.6/Math.min(this.currentAspectRatio,.6);s=this.defaultOrthoHeight*l}s=v.clamp(s,this.minOrthoHeight,this.maxOrthoHeight),this.camera.orthoHeight=s,it.emit("CameraOrthoSizeChange",s)}},r.getWidth=function(){return 2*this.camera.orthoHeight*this.currentAspectRatio},r.getCurrentOrthoHeight=function(){return this.camera.orthoHeight},r.refreshCameraAdaptation=function(){this.updateScreenSize(),this.adaptCameraToScreen()},o}(p)).instance=null,ze=e((Fe=Ke).prototype,"canvasUITransform",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ue=e(Fe.prototype,"designHeight",[tt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1920}}),xe=e(Fe.prototype,"designWidth",[tt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1080}}),Be=e(Fe.prototype,"defaultOrthoHeight",[tt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 820}}),Je=e(Fe.prototype,"minOrthoHeight",[tt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 750}}),Ve=e(Fe.prototype,"maxOrthoHeight",[tt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1080}}),We=e(Fe.prototype,"safeAreaPadding",[tt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),He=Fe))||He);c._RF.pop(),c._RF.push({},"b7133qOTDxJzq9m066wFCuW","DrMonkey_FitToScreen",void 0);var gt,yt,St,vt,Tt,Et,_t,Ct,bt,At,Rt,Nt,wt,It,Ot,Pt=u.ccclass,Dt=u.property;ot=Pt("DrMonkeyFitToScreen"),rt=Dt({type:m}),at=Dt({type:m}),st=Dt({visible:function(){return this.preserveAspectRatio}}),lt=Dt({type:T}),ot((ht=e((ut=function(e){function o(){for(var t,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,n(t,"updateWidgetsRecursively",ht,i(t)),n(t,"preserveAspectRatio",pt,i(t)),n(t,"aspectRatio",dt,i(t)),n(t,"extraScale",mt,i(t)),t}t(o,e);var r=o.prototype;return r.onEnable=function(){var e=this;E.once(_.EVENT_AFTER_UPDATE,(function(){e.refresh()}))},r.setUiTransformToScreenSize=function(){var e=this.node.getComponent(f),t=ft.instance.getCurrentOrthoHeight()/ft.instance.defaultOrthoHeight,n=y.windowSize.width||window.innerWidth,i=y.windowSize.height||window.innerHeight,o=ft.instance.designHeight*t,r=o*n/i;if(this.preserveAspectRatio)if(r/o>=this.aspectRatio){var a=o*this.aspectRatio;e.setContentSize(a,o)}else{var s=r/this.aspectRatio;e.setContentSize(r,s)}else e.setContentSize(r,o);1!=this.extraScale&&e.setContentSize(e.width*this.extraScale,e.height*this.extraScale)},r.refresh=function(){this.setUiTransformToScreenSize(),this.updateWidgetsRecursively&&this.updateWidgetsInHierarchy()},r.updateWidgetsInHierarchy=function(){this.updateWidgetAndDescendants(this.node)},r.updateWidgetAndDescendants=function(e){var t=this,n=e.getComponent(C);n&&this.node.uuid!=e.uuid&&n.updateAlignment(),e.children.forEach((function(e){t.updateWidgetAndDescendants(e)}))},o}(p)).prototype,"updateWidgetsRecursively",[rt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pt=e(ut.prototype,"preserveAspectRatio",[at],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dt=e(ut.prototype,"aspectRatio",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),mt=e(ut.prototype,"extraScale",[lt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),ct=ut));c._RF.pop(),c._RF.push({},"d65e7H1dZFOQ7NtJTrzsofD","DrMonkey_MiloLayout",void 0);var Mt=u.ccclass,Lt=u.property,Gt=function(e){return e[e.HORIZONTAL=0]="HORIZONTAL",e[e.VERTICAL=1]="VERTICAL",e[e.GRID=2]="GRID",e}({}),kt=function(e){return e[e.LEFT_TOP=0]="LEFT_TOP",e[e.CENTER_TOP=1]="CENTER_TOP",e[e.RIGHT_TOP=2]="RIGHT_TOP",e[e.LEFT_CENTER=3]="LEFT_CENTER",e[e.CENTER=4]="CENTER",e[e.RIGHT_CENTER=5]="RIGHT_CENTER",e[e.LEFT_BOTTOM=6]="LEFT_BOTTOM",e[e.CENTER_BOTTOM=7]="CENTER_BOTTOM",e[e.RIGHT_BOTTOM=8]="RIGHT_BOTTOM",e}({});gt=Mt("DrMonkeyMiloLayout"),yt=Lt({type:b(Gt)}),St=Lt({type:b(Gt)}),vt=Lt({type:b(kt)}),Tt=Lt({type:b(kt)}),Et=Lt({visible:function(){return this._layoutType===Gt.GRID}}),gt((bt=e((Ct=function(e){function o(){for(var t,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,n(t,"_layoutType",bt,i(t)),n(t,"_alignment",At,i(t)),n(t,"_spacingX",Rt,i(t)),n(t,"_spacingY",Nt,i(t)),n(t,"_columns",wt,i(t)),n(t,"_padding",It,i(t)),n(t,"_autoResize",Ot,i(t)),t._activeChildCount=0,t._layoutSize=new A(0,0),t._lastChildActiveState=[],t}t(o,e);var a=o.prototype;return a.onLoad=function(){this.node.on(R.EventType.CHILD_ADDED,this.onChildAdded,this),this.node.on(R.EventType.CHILD_REMOVED,this.onChildRemoved,this)},a.onDestroy=function(){this.node.off(R.EventType.CHILD_ADDED,this.onChildAdded,this),this.node.off(R.EventType.CHILD_REMOVED,this.onChildRemoved,this),this.removeAllChildListeners()},a.onChildRemoved=function(e){this.removeChildListener(e),this.updateLayout()},a.removeAllChildListeners=function(){var e=this;this.node.children.forEach((function(t){e.removeChildListener(t)}))},a.removeChildListener=function(e){e.__miloLayoutActiveHandler&&(e.off(R.EventType.ACTIVE_IN_HIERARCHY_CHANGED,e.__miloLayoutActiveHandler),e.__miloLayoutActiveHandler=null)},a.start=function(){this._lastChildActiveState=this.node.children.map((function(e){return e.active})),this.updateLayout(),this.addChildActiveListeners()},a.addChildActiveListeners=function(){var e=this;this.node.children.forEach((function(t){e.addChildActiveListener(t)}))},a.addChildActiveListener=function(e){var t=this;e.off(R.EventType.ACTIVE_IN_HIERARCHY_CHANGED,this.onChildActiveChanged,this);var n=function(){t.scheduleOnce((function(){t.updateLayout()}),0)};e.__miloLayoutActiveHandler=n,e.on(R.EventType.ACTIVE_IN_HIERARCHY_CHANGED,n)},a.onChildActiveChanged=function(e){},a.onEnable=function(){this.updateLayout()},a.getAlignmentOffset=function(e){var t,n=new N,i=(null==(t=this.node.getComponent(f))?void 0:t.contentSize)||new A(0,0);switch(this._alignment){case kt.LEFT_TOP:case kt.LEFT_CENTER:case kt.LEFT_BOTTOM:n.x=this._padding;break;case kt.CENTER_TOP:case kt.CENTER:case kt.CENTER_BOTTOM:n.x=(i.width-e.width)/2;break;case kt.RIGHT_TOP:case kt.RIGHT_CENTER:case kt.RIGHT_BOTTOM:n.x=i.width-e.width-this._padding}switch(this._alignment){case kt.LEFT_TOP:case kt.CENTER_TOP:case kt.RIGHT_TOP:n.y=-this._padding;break;case kt.LEFT_CENTER:case kt.CENTER:case kt.RIGHT_CENTER:n.y=-(i.height-e.height)/2;break;case kt.LEFT_BOTTOM:case kt.CENTER_BOTTOM:case kt.RIGHT_BOTTOM:n.y=-i.height+e.height+this._padding}return n},a.updateLayout=function(){if(this.node){var e=this.node.children.filter((function(e){return e.active}));if(this._activeChildCount=e.length,0!==this._activeChildCount)switch(this._layoutType){case Gt.HORIZONTAL:this.updateHorizontalLayout(e);break;case Gt.VERTICAL:this.updateVerticalLayout(e);break;case Gt.GRID:this.updateGridLayout(e)}}},a.updateHorizontalLayout=function(e){var t=this,n=2*this._padding,i=0;e.forEach((function(o,r){var a=o.getComponent(f);a&&(n+=a.width,r<e.length-1&&(n+=t._spacingX),i=Math.max(i,a.height))}));var o=new A(n,i+2*this._padding),r=this.getAlignmentOffset(o),a=r.x;if(e.forEach((function(e){var n=e.getComponent(f);if(n){var o=n.height,s=n.width,l=r.y;switch(t._alignment){case kt.LEFT_TOP:case kt.CENTER_TOP:case kt.RIGHT_TOP:l=r.y-t._padding;break;case kt.LEFT_CENTER:case kt.CENTER:case kt.RIGHT_CENTER:l=r.y-(i-o)/2;break;case kt.LEFT_BOTTOM:case kt.CENTER_BOTTOM:case kt.RIGHT_BOTTOM:l=r.y-i+o}e.position=new N(a+s/2,l-o/2,0),a+=s+t._spacingX}})),this._layoutSize=o,this._autoResize){var s=this.node.getComponent(f);s&&s.setContentSize(o)}},a.updateVerticalLayout=function(e){var t=this,n=2*this._padding,i=0;e.forEach((function(o,r){var a=o.getComponent(f);a&&(n+=a.height,r<e.length-1&&(n+=t._spacingY),i=Math.max(i,a.width))}));var o=new A(i+2*this._padding,n),r=this.getAlignmentOffset(o),a=r.y;if(e.forEach((function(e){var n=e.getComponent(f);if(n){var o=n.height,s=n.width,l=r.x;switch(t._alignment){case kt.LEFT_TOP:case kt.LEFT_CENTER:case kt.LEFT_BOTTOM:l=r.x+t._padding;break;case kt.CENTER_TOP:case kt.CENTER:case kt.CENTER_BOTTOM:l=r.x+(i-s)/2+t._padding;break;case kt.RIGHT_TOP:case kt.RIGHT_CENTER:case kt.RIGHT_BOTTOM:l=r.x+i-s+t._padding}e.position=new N(l+s/2,a-o/2,0),a-=o+t._spacingY}})),this._layoutSize=o,this._autoResize){var s=this.node.getComponent(f);s&&s.setContentSize(o)}},a.updateGridLayout=function(e){if(!(this._columns<=0)){var t=Math.ceil(e.length/this._columns),n=0,i=0;e.forEach((function(e){var t=e.getComponent(f);t&&(n=Math.max(n,t.width),i=Math.max(i,t.height))}));for(var o=2*this._padding+n*this._columns+this._spacingX*(this._columns-1),r=2*this._padding+i*t+this._spacingY*(t-1),a=new A(o,r),s=this.getAlignmentOffset(a),l=0;l<t;l++){var c=Math.min(this._columns,e.length-l*this._columns),u=c*n+(c-1)*this._spacingX,h=0;switch(this._alignment){case kt.CENTER_TOP:case kt.CENTER:case kt.CENTER_BOTTOM:h=(this._columns*n+(this._columns-1)*this._spacingX-u)/2;break;case kt.RIGHT_TOP:case kt.RIGHT_CENTER:case kt.RIGHT_BOTTOM:h=this._columns*n+(this._columns-1)*this._spacingX-u}for(var p=0;p<c;p++){var d=l*this._columns+p;if(d>=e.length)break;var m=e[d],g=m.getComponent(f);if(g){var y=g.width,S=g.height,v=s.x+this._padding+p*(n+this._spacingX)+h,T=s.y-this._padding-l*(i+this._spacingY),E=v,_=T;switch(this._alignment){case kt.LEFT_TOP:case kt.LEFT_CENTER:case kt.LEFT_BOTTOM:E=v;break;case kt.CENTER_TOP:case kt.CENTER:case kt.CENTER_BOTTOM:E=v+(n-y)/2;break;case kt.RIGHT_TOP:case kt.RIGHT_CENTER:case kt.RIGHT_BOTTOM:E=v+n-y}switch(this._alignment){case kt.LEFT_TOP:case kt.CENTER_TOP:case kt.RIGHT_TOP:_=T;break;case kt.LEFT_CENTER:case kt.CENTER:case kt.RIGHT_CENTER:_=T-(i-S)/2;break;case kt.LEFT_BOTTOM:case kt.CENTER_BOTTOM:case kt.RIGHT_BOTTOM:_=T-i+S}m.position=new N(E+y/2,_-S/2,0)}}}if(this._layoutSize=a,this._autoResize){var C=this.node.getComponent(f);C&&C.setContentSize(a)}}},a.update=function(e){if(this.node&&this.node.children.length>0){var t=this.node.children.map((function(e){return e.active})),n=!1;if(this._lastChildActiveState.length!==t.length)n=!0;else for(var i=0;i<t.length;i++)if(this._lastChildActiveState[i]!==t[i]){n=!0;break}n&&(this._lastChildActiveState=t,this.updateLayout())}},a.onChildAdded=function(e){this.addChildActiveListener(e),this.updateLayout()},r(o,[{key:"layoutType",get:function(){return this._layoutType},set:function(e){this._layoutType=e,this.updateLayout()}},{key:"alignment",get:function(){return this._alignment},set:function(e){this._alignment=e,this.updateLayout()}},{key:"spacingX",get:function(){return this._spacingX},set:function(e){this._spacingX=e,this.updateLayout()}},{key:"spacingY",get:function(){return this._spacingY},set:function(e){this._spacingY=e,this.updateLayout()}},{key:"columns",get:function(){return this._columns},set:function(e){this._columns=e,this.updateLayout()}},{key:"padding",get:function(){return this._padding},set:function(e){this._padding=e,this.updateLayout()}},{key:"autoResize",get:function(){return this._autoResize},set:function(e){this._autoResize=e,this.updateLayout()}}]),o}(p)).prototype,"_layoutType",[yt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Gt.HORIZONTAL}}),e(Ct.prototype,"layoutType",[St],Object.getOwnPropertyDescriptor(Ct.prototype,"layoutType"),Ct.prototype),At=e(Ct.prototype,"_alignment",[vt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return kt.LEFT_TOP}}),e(Ct.prototype,"alignment",[Tt],Object.getOwnPropertyDescriptor(Ct.prototype,"alignment"),Ct.prototype),Rt=e(Ct.prototype,"_spacingX",[Lt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),e(Ct.prototype,"spacingX",[Lt],Object.getOwnPropertyDescriptor(Ct.prototype,"spacingX"),Ct.prototype),Nt=e(Ct.prototype,"_spacingY",[Lt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),e(Ct.prototype,"spacingY",[Lt],Object.getOwnPropertyDescriptor(Ct.prototype,"spacingY"),Ct.prototype),wt=e(Ct.prototype,"_columns",[Lt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 3}}),e(Ct.prototype,"columns",[Et],Object.getOwnPropertyDescriptor(Ct.prototype,"columns"),Ct.prototype),It=e(Ct.prototype,"_padding",[Lt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),e(Ct.prototype,"padding",[Lt],Object.getOwnPropertyDescriptor(Ct.prototype,"padding"),Ct.prototype),Ot=e(Ct.prototype,"_autoResize",[Lt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),e(Ct.prototype,"autoResize",[Lt],Object.getOwnPropertyDescriptor(Ct.prototype,"autoResize"),Ct.prototype),_t=Ct));c._RF.pop(),c._RF.push({},"c8e9c8xjURGFraN6OiA8+OF","DrMonkey_PbExtensions",void 0),N.prototype.clampMagnitude=function(e,t){if(!(e>t)){var n=this.length();return n>t?(this.normalize(),this.multiplyScalar(t)):n<e&&(this.normalize(),this.multiplyScalar(e)),this}console.error("min should be less than max")},p.prototype.log=function(){for(var e=this.constructor.name,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];ye.info.apply(ye,[e+" "].concat(n))},c._RF.pop(),c._RF.push({},"22b9bHcFltOfq6ReZrEN7Rd","DrMonkey_Utils",void 0);var Ht=function(){function e(){}return e.roundNumber=function(e,t){void 0===t&&(t=2);var n=Math.pow(10,t);return Math.round((e+Number.EPSILON)*n)/n},e.truncateName=function(e,t){if(void 0===t&&(t=10),!e)return"";var n=e.split(" ")[0],i=n.charAt(0).toUpperCase()+n.slice(1);return i.length<=t?i:i.slice(0,t)+".."},e}();c._RF.pop(),c._RF.push({},"9384eYnVbdAdIj0/PY3yqZq","DrMonkey_BasePlayerData",void 0);var Ft=function(){function e(){this.userId=void 0,this.name=void 0,this.avatar=void 0,this.sessionId=void 0,this.playerNumber=void 0,this.type=void 0,this.isOnline=void 0,this.isConnected=void 0,this.isReplacedByBot=void 0,this.isKickedOut=void 0,this.isReady=void 0,this.score=void 0}return e.prototype.copyFrom=function(e){this.userId=e.userId,this.name=e.name,this.avatar=e.avatar,this.sessionId=e.sessionId,this.playerNumber=e.playerNumber,this.type=e.type,this.isOnline=e.isOnline,this.isConnected=e.isConnected,this.isReplacedByBot=e.isReplacedByBot,this.isKickedOut=e.isKickedOut,this.isReady=e.isReady,this.score=e.score},e}();c._RF.pop(),c._RF.push({},"9210d69+T9OjIjFOkPmehuV","DrMonkey_BaseRoomSettings",void 0);var zt=function(){function e(){this.maxPlayers=void 0,this.minPlayers=void 0,this.maxClients=void 0,this.countdownTimeInSeconds=void 0,this.allowLateJoin=void 0,this.maxReconnectionAttempts=void 0,this.reconnectionAttemptInterval=void 0,this.reconnectionTime=void 0,this.gameFPS=void 0,this.serverFPS=void 0,this.patchRate=void 0}return e.prototype.copyFrom=function(e){this.maxPlayers=e.maxPlayers,this.minPlayers=e.minPlayers,this.maxClients=e.maxClients,this.countdownTimeInSeconds=e.countdownTimeInSeconds,this.allowLateJoin=e.allowLateJoin,this.reconnectionTime=e.reconnectionTime,this.gameFPS=e.gameFPS,this.serverFPS=e.serverFPS,this.patchRate=e.patchRate},e}();c._RF.pop(),c._RF.push({},"a7968k7sxJF146vWwZAkJqg","DrMonkey_RoomTypes",void 0);var Ut=function(e){return e[e.NONE=0]="NONE",e[e.WAITING_FOR_PLAYERS=1]="WAITING_FOR_PLAYERS",e[e.COUNTDOWN=2]="COUNTDOWN",e[e.GAME_SIMULATION=3]="GAME_SIMULATION",e[e.END_GAME=4]="END_GAME",e[e.KICKED_OUT=5]="KICKED_OUT",e}({});c._RF.pop(),c._RF.push({},"beba3vZ96NIbpZoydKeMTYZ","DrMonkey_BaseRoomState",void 0);var xt,Bt,Jt,Vt,Wt,Kt,Yt,jt=function(){function e(e,t){this.currentRoomStatus=Ut.WAITING_FOR_PLAYERS,this.previousRoomStatus=Ut.NONE,this.roomSettings=void 0,this.playersData=void 0,this.spectatorsData=void 0,this.roomSettings=e,this.playersData=t,this.spectatorsData=[]}return e.prototype.copyFrom=function(e){this.currentRoomStatus=e.currentRoomStatus,this.previousRoomStatus=e.previousRoomStatus,this.roomSettings.copyFrom(e.roomSettings)},e}();c._RF.pop(),c._RF.push({},"46ed0dFwG9HVIxa5Y7HHHH5","DrMonkey_Timer",void 0);var qt=u.ccclass,Xt=u.property,Zt=(xt=qt("DrMonkeyTimer"),Bt=Xt(w),Jt=Xt(I),xt((Kt=e((Wt=function(e){function o(){for(var t,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,n(t,"timeUiLabel",Kt,i(t)),n(t,"timerFillSprite",Yt,i(t)),t.elapsedTime=0,t.maxTime=0,t.isRunning=!1,t.onTimerEndCallback=null,t.isInCriticalTime=!1,t.originalColor=new O(255,255,255,255),t.originalSpriteColor=new O(255,255,255,255),t.criticalColor=new O(255,0,0,255),t.heartbeatTween=null,t}t(o,e);var r=o.prototype;return r.start=function(){this.timeUiLabel&&(this.originalColor=this.timeUiLabel.color.clone()),this.timerFillSprite&&(this.originalSpriteColor=this.timerFillSprite.color.clone())},r.update=function(e){this.isRunning&&(this.elapsedTime-=e,this.elapsedTime<=0&&(this.elapsedTime=0,this.stopTimer(),this.onTimerEndCallback&&this.onTimerEndCallback()),this.updateTimeLabel(),this.updateFillSprite(),this.checkCriticalTime())},r.startTimer=function(){this.isRunning||(this.isRunning=!0)},r.stopTimer=function(){this.isRunning&&(this.isRunning=!1,this.stopHeartbeatAnimation(),this.isInCriticalTime=!1,this.timeUiLabel&&(this.timeUiLabel.color=this.originalColor),this.timerFillSprite&&(this.timerFillSprite.color=this.originalSpriteColor))},r.reset=function(){this.elapsedTime=0,this.stopHeartbeatAnimation(),this.isInCriticalTime=!1,this.timeUiLabel&&(this.timeUiLabel.color=this.originalColor),this.timerFillSprite&&(this.timerFillSprite.color=this.originalSpriteColor),this.updateTimeLabel()},r.setStartTime=function(e){console.log("[Timer] Setting start time to:",e),this.elapsedTime=e,this.maxTime=e,this.updateTimeLabel(),this.updateFillSprite()},r.setOnTimerEndCallback=function(e){this.onTimerEndCallback=e},r.updateTimeLabel=function(){var e=Math.floor(this.elapsedTime);this.timeUiLabel.string=""+e},r.updateFillSprite=function(){if(this.timerFillSprite){var e=this.maxTime>0?this.elapsedTime/this.maxTime:0;this.timerFillSprite.fillRange=e}},r.formatTime=function(e){return e<10?"0"+e:""+e},r.formatMilliseconds=function(e){return e<10?"00"+e:e<100?"0"+e:""+e},r.checkCriticalTime=function(){this.elapsedTime<=10&&!this.isInCriticalTime?(this.isInCriticalTime=!0,this.timeUiLabel.color=this.criticalColor,this.timerFillSprite&&(this.timerFillSprite.color=this.criticalColor),this.startHeartbeatAnimation()):this.elapsedTime>10&&this.isInCriticalTime&&(this.isInCriticalTime=!1,this.timeUiLabel.color=this.originalColor,this.timerFillSprite&&(this.timerFillSprite.color=this.originalSpriteColor),this.stopHeartbeatAnimation())},r.startHeartbeatAnimation=function(){this.stopHeartbeatAnimation(),this.heartbeatTween=P(this.timeUiLabel.node).repeatForever(P(this.timeUiLabel.node).to(.3,{scale:new N(1.2,1.2,1)}).to(.3,{scale:new N(1,1,1)}).delay(.6)).start()},r.stopHeartbeatAnimation=function(){this.heartbeatTween&&(this.heartbeatTween.stop(),this.heartbeatTween=null),this.timeUiLabel&&this.timeUiLabel.node&&(this.timeUiLabel.node.scale=new N(1,1,1))},o}(p)).prototype,"timeUiLabel",[Bt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Yt=e(Wt.prototype,"timerFillSprite",[Jt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Vt=Wt))||Vt);c._RF.pop(),c._RF.push({},"d1838dSarZOXr7fW6M9rXt2","DrMonkey_GameState",void 0);var Qt=function(e){return e[e.NONE=0]="NONE",e[e.WAITING_FOR_PLAYERS=1]="WAITING_FOR_PLAYERS",e[e.START_ROUND=2]="START_ROUND",e[e.DEATH_SCENARIO=3]="DEATH_SCENARIO",e[e.SHOW_SCENARIO=4]="SHOW_SCENARIO",e[e.PLAYER_ANSWERING=5]="PLAYER_ANSWERING",e[e.AI_JUDGEMENT=6]="AI_JUDGEMENT",e[e.ROUND_RESULTS=7]="ROUND_RESULTS",e[e.ROUND_END=8]="ROUND_END",e[e.GAME_OVER=9]="GAME_OVER",e}({});c._RF.pop(),c._RF.push({},"9e2e5n+SWlOqpfgrsbjDtOu","DrMonkey_RoomState",void 0);var $t=function(){function e(){this.roundNumber=0,this.score=0,this.survived=!0}return e.prototype.copyFrom=function(e){this.roundNumber=e.roundNumber,this.score=e.score,this.survived=e.survived},e}(),en=function(e){function n(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))||this).currentAnswer="",t.aiJudgement="",t.roundScores=[],t}return t(n,e),n.prototype.copyFrom=function(t){e.prototype.copyFrom.call(this,t),this.currentAnswer=t.currentAnswer,this.aiJudgement=t.aiJudgement,this.roundScores=t.roundScores.map((function(e){var t=new $t;return t.copyFrom(e),t}))},n}(Ft),tn=function(e){function n(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))||this).promptTimeLimit=void 0,t.showScenarioTimeLimit=void 0,t.answerTimeLimit=void 0,t.timePerChar=void 0,t.rounds=void 0,t}return t(n,e),n.prototype.copyFrom=function(t){e.prototype.copyFrom.call(this,t),this.promptTimeLimit=t.promptTimeLimit,this.showScenarioTimeLimit=t.showScenarioTimeLimit,this.answerTimeLimit=t.answerTimeLimit,this.timePerChar=t.timePerChar,this.rounds=t.rounds},n}(zt),nn=function(){function e(){this.inputType=void 0,this.inputValue=void 0}return e.prototype.copyFrom=function(e){this.inputType=e.inputType,this.inputValue=e.inputValue},e}(),on=function(e){function n(){var t;return(t=e.call(this,new tn,[])||this).inputPayload=new nn,t.currentGameState=Qt.NONE,t.previousGameState=Qt.NONE,t.deathScenario="",t.currentJudgingPlayerNumber=-1,t.currentScenarioPickingPlayerNumber=-1,t.serverTick=0,t.currentRound=1,t}t(n,e);var i=n.prototype;return i.copyFrom=function(t){e.prototype.copyFrom.call(this,t),this.playersData=t.playersData.map((function(e){var t=new en;return t.copyFrom(e),t})),this.spectatorsData=t.spectatorsData.map((function(e){var t=new Ft;return t.copyFrom(e),t})),this.currentRoomStatus=t.currentRoomStatus,this.previousRoomStatus=t.previousRoomStatus,this.currentGameState=t.currentGameState,this.previousGameState=t.previousGameState,this.roomSettings.copyFrom(t.roomSettings),this.inputPayload.copyFrom(t.inputPayload),this.deathScenario=t.deathScenario,this.currentJudgingPlayerNumber=t.currentJudgingPlayerNumber,this.currentScenarioPickingPlayerNumber=t.currentScenarioPickingPlayerNumber,this.currentRound=t.currentRound,this.serverTick=t.serverTick},i.getPlayerByUserId=function(e){return this.playersData.find((function(t){return t.userId===e}))||null},i.getOnlinePlayersCount=function(){return this.playersData.filter((function(e){return e.isOnline})).length},i.getPlayerByIndex=function(e){return this.playersData.find((function(t){return t.playerNumber===e}))||null},i.getPlayerBySessionId=function(e){return this.playersData.find((function(t){return t.sessionId===e}))||null},i.isMyTurnInScenarioPicking=function(e){return this.currentScenarioPickingPlayerNumber===e},i.isMyTurnInJudging=function(e){return this.currentJudgingPlayerNumber===e},n}(jt);c._RF.pop(),c._RF.push({},"8e55c+9OhNGdYfoRpxMb3h0","DrMonkey_GameMessageType",void 0);var rn,an,sn,ln,cn,un,hn,pn,dn,mn=function(e){return e.NONE="none",e.SET_STATE="set_state",e.PLAYER_ANSWER="player_answer",e.AI_JUDGEMENT="ai_judgement",e.SCENARIO_UPDATE="scenario_update",e.SUBMIT_SCENARIO="submit_scenario",e.REFETCH_SCENARIO="refetch_scenario",e.CONTINUE_SCENARIO="continue_scenario",e.FATE_HAS_BEEN_SEALED="fate_has_been_sealed",e}({});c._RF.pop(),c._RF.push({},"672fe3UAndCvoSI908p/UHF","DrMonkey_Player",void 0);var fn,gn,yn,Sn,vn,Tn,En,_n,Cn,bn,An,Rn,Nn,wn=u.ccclass,In=u.property,On=function(e){return e[e.IDLE=0]="IDLE",e[e.PICKING_SCENARIO=1]="PICKING_SCENARIO",e[e.ANSWERING=2]="ANSWERING",e[e.JUDGING=3]="JUDGING",e}({}),Pn=(rn=wn("DrMonkeyPlayer"),an=In({type:D,tooltip:"Player's index in the game"}),sn=In({type:w,tooltip:"Label to display player's name"}),ln=In({type:I,tooltip:"Sprite for player's profile image"}),rn((hn=e((un=function(e){function o(){for(var t,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return(t=e.call.apply(e,[this].concat(r))||this).userId="",t.playerName="",n(t,"index",hn,i(t)),n(t,"nameLabel",pn,i(t)),n(t,"profileImage",dn,i(t)),t.playerState=On.IDLE,t.isLocal=!1,t.isProfileInitialized=!1,t.profileImageUrl="",t}t(o,e);var r=o.prototype;return r.onDisable=function(){this.removeEventListeners()},r.initialize=function(e,t){if(e){console.log("Initializing Player: "+t),this.index=t;var n=e.getPlayerByIndex(this.index);n?(this.userId=n.userId,this.playerName=n.name,this.loadProfile(n),this.checkIfLocalPlayer(n),this.updatePlayerState(e)):console.error("[Player] No profile data found for player index "+this.index)}else console.error("[Player] Failed to initialize: Invalid room state")},r.checkIfLocalPlayer=function(e){this.isLocal=e.sessionId===$e.Instance.CurrentRoom.sessionId},r.resetState=function(){this.playerState=On.IDLE},r.loadProfile=function(e){!this.isProfileInitialized&&e&&(this.nameLabel.string=Ht.truncateName(e.name,12),this.profileImageUrl=e.avatar,this.loadProfileImage(),this.addEventListeners(),this.isProfileInitialized=!0)},r.addEventListeners=function(){this.profileImage&&this.profileImage.node&&this.profileImage.node.on(R.EventType.TOUCH_START,this.openProfile,this)},r.removeEventListeners=function(){this.profileImage&&this.profileImage.node&&this.profileImage.node.off(R.EventType.TOUCH_START,this.openProfile,this)},r.loadProfileImage=function(){var e=this;if(this.profileImageUrl){var t=M.assets.get(this.profileImageUrl);t?this.applyProfileTexture(t):M.loadRemote(this.profileImageUrl,{ext:".png"},(function(t,n){if(t)console.error("[Player] Failed to load profile image: "+t);else try{var i=new L;i.image=n,e.applyProfileTexture(i)}catch(e){console.error("[Player] Error creating sprite frame: "+e)}}))}else console.warn("[Player] No profile image URL provided")},r.applyProfileTexture=function(e){var t=new G;t.texture=e,this.profileImage.spriteFrame=t},r.onServerRoomStateChange=function(e){e?this.updatePlayerState(e):console.error("[Player] Invalid room state")},r.updatePlayerState=function(e){switch(e.currentGameState){case Qt.PLAYER_ANSWERING:this.playerState=On.ANSWERING;break;case Qt.DEATH_SCENARIO:this.playerState=e.isMyTurnInScenarioPicking(this.index)?On.PICKING_SCENARIO:On.IDLE;break;case Qt.AI_JUDGEMENT:this.playerState=e.isMyTurnInJudging(this.index)?On.JUDGING:On.IDLE;break;default:this.playerState=On.IDLE}},r.onReconnection=function(e){if(e){var t=e.getPlayerByIndex(this.index);t?(this.loadProfile(t),this.updatePlayerState(e),this.handleReconnectionByGameState(e,t),console.log("[Player] Player "+this.index+" reconnection complete, state: "+this.playerState)):console.error("[Player] No player data found for index "+this.index+" during reconnection")}else console.error("[Player] Invalid room state for reconnection")},r.handleReconnectionByGameState=function(e,t){switch(e.currentGameState){case Qt.PLAYER_ANSWERING:t.currentAnswer&&""!==t.currentAnswer&&console.log("[Player] Restoring previous answer for player "+this.index+": "+t.currentAnswer);break;case Qt.DEATH_SCENARIO:e.isMyTurnInScenarioPicking(this.index)&&console.log("[Player] Restoring scenario picking state for player "+this.index);break;case Qt.AI_JUDGEMENT:e.isMyTurnInJudging(this.index)&&console.log("[Player] Restoring judging state for player "+this.index)}},r.isMyTurn=function(e){return this.index===e},r.setPlayerNumber=function(e){this.index=e},r.getProfileSpriteFrame=function(){return this.profileImage?this.profileImage.spriteFrame:null},r.openProfile=function(){this.userId?console.log("Opening profile for user: "+this.userId):console.warn("[Player] Cannot open profile: No user ID available")},r.getPlayerState=function(){return this.playerState},r.isLocalPlayer=function(){return this.isLocal},o}(p)).prototype,"index",[an],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),pn=e(un.prototype,"nameLabel",[sn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),dn=e(un.prototype,"profileImage",[ln],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),cn=un))||cn);c._RF.pop(),c._RF.push({},"f5ad9rc0z5Hu7pz4fTpvQ8r","DrMonkeyGameHandler",void 0);var Dn,Mn,Ln,Gn,kn,Hn,Fn,zn,Un,xn,Bn,Jn,Vn,Wn=u.ccclass,Kn=u.property,Yn=u.executionOrder,jn=new d,qn=(fn=Wn("DrMonkeyGameHandler"),gn=Yn(-1),yn=Kn({type:k,tooltip:"Prefab for player instances"}),Sn=Kn({type:R,tooltip:"Container node for player instances"}),vn=Kn({type:Zt,tooltip:"Reference to game timer component"}),Tn=Kn({type:[Pn],visible:!1}),fn(En=gn(((Nn=function(e){function o(){for(var t,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,n(t,"playerPrefab",Cn,i(t)),n(t,"playersContainer",bn,i(t)),n(t,"timer",An,i(t)),n(t,"players",Rn,i(t)),t.currentRoomState=null,t.localPlayerNumber=-1,t.hasReconnected=!1,t}t(o,e);var a=o.prototype;return a.onLoad=function(){o._instance&&this.node.destroy(),o._instance=this,this.validateRequiredComponents(),this.registerNetworkEvents(),this.registerGameEvents(),this.handleBrowserClose()},a.onDestroy=function(){this.unregisterNetworkEvents(),this.unregisterGameEvents(),window.removeEventListener("beforeunload",this.onGameClose.bind(this)),o._instance===this&&(o._instance=null)},a.validateRequiredComponents=function(){this.playerPrefab||ye.error("Player prefab not assigned to DrMonkeyGameHandler"),this.playersContainer||ye.error("Players container not assigned to DrMonkeyGameHandler"),this.timer||ye.error("Timer component not assigned to DrMonkeyGameHandler")},a.initialize=function(e){ye.info("DrMonkeyGameHandler initialized with room settings",e)},a.registerNetworkEvents=function(){Xe.on(Ee.CONNECTION_STATE_CHANGE,this.onConnectionStateChange,this),Ze.on(Ee.SERVER_ROOM_STATE_CHANGE,this.onServerRoomStateChange,this),Qe.on(Ee.SERVER_MESSAGE,this.onServerMessage,this)},a.unregisterNetworkEvents=function(){Xe.off(Ee.CONNECTION_STATE_CHANGE,this.onConnectionStateChange,this),Ze.off(Ee.SERVER_ROOM_STATE_CHANGE,this.onServerRoomStateChange,this),Qe.off(Ee.SERVER_MESSAGE,this.onServerMessage,this)},a.registerGameEvents=function(){H.on(F.EVENT_HIDE,this.onGameHide,this),H.on(F.EVENT_SHOW,this.onGameShow,this),H.on(F.EVENT_RESTART,this.onGameRestart,this),H.on(F.EVENT_CLOSE,this.onGameClose,this)},a.unregisterGameEvents=function(){H.off(F.EVENT_HIDE,this.onGameHide,this),H.off(F.EVENT_SHOW,this.onGameShow,this),H.off(F.EVENT_RESTART,this.onGameRestart,this),H.off(F.EVENT_CLOSE,this.onGameClose,this)},a.handleBrowserClose=function(){window.addEventListener("beforeunload",this.onGameClose.bind(this))},a.onServerMessage=function(e,t){ye.info("Server message received:",e,t),this.log("Unhandled server message type:",e)},a.onServerRoomStateChange=function(e){this.currentRoomState?(this.currentRoomState.copyFrom(e),this.currentRoomState.currentRoomStatus!==Ut.END_GAME?this.hasReconnected?this.handleReconnection(this.currentRoomState):(this.handleRoomStateUpdate(this.currentRoomState),this.sendRoomStateToAllPlayers(this.currentRoomState)):this.handleEndGameState()):this.initializeRoomState(e)},a.initializeRoomState=function(e){e?(this.currentRoomState=new on,this.currentRoomState.copyFrom(e),this.initializePlayers(this.currentRoomState),this.currentRoomState.currentGameState!==Qt.NONE&&this.currentRoomState.currentGameState!==Qt.WAITING_FOR_PLAYERS&&(ye.info("Joined game in progress with state:",this.currentRoomState.currentGameState),jn.emit(Ee.GAME_STATE_CHANGE,this.currentRoomState.currentGameState),this.handleJoiningInProgressGame(this.currentRoomState))):ye.error("Attempted to initialize with null room state")},a.handleJoiningInProgressGame=function(e){e.currentGameState!==Qt.PLAYER_ANSWERING&&e.currentGameState!==Qt.DEATH_SCENARIO||(this.timer.reset(),this.timer.startTimer()),this.sendReconnectionStateToAllPlayers(e)},a.handleEndGameState=function(){console.log("Game Over - State Change:",this.currentRoomState)},a.handleReconnection=function(e){ye.info("Reconnection detected - Syncing game state:",e.currentGameState),e.currentGameState===Qt.PLAYER_ANSWERING||e.currentGameState===Qt.DEATH_SCENARIO?(this.timer.reset(),this.timer.startTimer()):(this.timer.reset(),this.timer.stopTimer()),this.sendReconnectionStateToAllPlayers(e),jn.emit(Ee.GAME_STATE_CHANGE,e.currentGameState),this.hasReconnected=!1},a.handleRoomStateUpdate=function(e){ye.info("[DrMonkeyGameHandler] ==== Game State Change ==== :",e.currentGameState);var t=e.inputPayload.inputType;t===mn.SET_STATE?this.handleSetState(e):t===mn.SCENARIO_UPDATE&&this.handleScenarioUpdate(e)},a.handleSetState=function(e){ye.info("Handling SET STATE"),this.timer.reset(),this.timer.stopTimer(),console.log("[DrMonkeyGameHandler] ==== Game State Change ==== :",e.currentGameState),jn.emit(Ee.GAME_STATE_CHANGE,e.currentGameState)},a.handleScenarioUpdate=function(e){ye.info("Handling SCENARIO UPDATE")},a.initializePlayers=function(e){var t=this;this.log("Initializing "+e.playersData.length+" players"),this.assignMyPlayerNumber(e),e.playersData.forEach((function(n,i){t.createPlayer(i).initialize(e,i)}))},a.sendChatMessageToServer=function(e){},a.onConnectionStateChange=function(e,t){t===_e.DISCONNECTED?this.onGameDisconnect():e===_e.RECONNECTING&&t===_e.JOINED_ROOM&&(this.hasReconnected=!0,this.onGameReconnect())},a.sendRoomStateToAllPlayers=function(e){},a.sendReconnectionStateToAllPlayers=function(e){ye.info("Syncing reconnection state to all players"),this.players.forEach((function(t){t&&t.onReconnection&&t.onReconnection(e)})),e.currentGameState===Qt.PLAYER_ANSWERING&&ye.info("Restoring player answer state after reconnection"),e.currentGameState===Qt.SHOW_SCENARIO&&ye.info("Restoring scenario display after reconnection")},a.createPlayer=function(e){if(!this.playerPrefab||!this.playersContainer)throw ye.error("Cannot create player: playerPrefab or playersContainer is null"),new Error("Cannot create player: missing required components");var t=z(this.playerPrefab);t.setParent(this.playersContainer);var n=t.getComponent(Pn);if(!n)throw ye.error("Player component not found on instantiated player prefab"),new Error("Player component not found on instantiated player prefab");return this.players.push(n),n},a.getPlayer=function(e){if(e)return this.players.find((function(t){return t.userId===e}));ye.warning("Attempted to get player with empty ID")},a.getLocalPlayerNumber=function(){return this.localPlayerNumber},a.getRoomState=function(){return this.currentRoomState},a.isMyTurn=function(){return!1},a.assignMyPlayerNumber=function(e){var t=this;e.playersData.forEach((function(e,n){e.sessionId===$e.Instance.CurrentRoom.sessionId&&(t.localPlayerNumber=n)}))},a.allPlayersFinished=function(){return!1},a.anyPlayerFinished=function(){return!1},a.getPlayerName=function(e){var t;return(null==(t=this.players.find((function(t){return t.userId===e})))?void 0:t.playerName)||e},a.onGameHide=function(){ye.info("Game hidden"),U.stopAll()},a.onGameShow=function(){ye.info("Game shown")},a.onGameRestart=function(){ye.info("Game restarted")},a.onGameClose=function(){ye.info("Game closed")},a.onGameDisconnect=function(){ye.info("Game disconnected")},a.onGameReconnect=function(){ye.info("Game reconnected")},a.log=function(e,t,n){void 0===n&&(n="info");var i="[DrMonkeyGameHandler] "+e;switch(n){case"error":ye.error(i,t);break;case"warn":ye.warning(i,t);break;case"debug":ye.debug(i,t);break;default:ye.info(i,t)}},r(o,null,[{key:"Instance",get:function(){if(!this._instance)throw ye.error("DrMonkeyGameHandler instance not initialized"),new Error("DrMonkeyGameHandler instance not initialized");return this._instance}}]),o}(p))._instance=null,Cn=e((_n=Nn).prototype,"playerPrefab",[yn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bn=e(_n.prototype,"playersContainer",[Sn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),An=e(_n.prototype,"timer",[vn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Rn=e(_n.prototype,"players",[Tn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),En=_n))||En)||En);c._RF.pop(),c._RF.push({},"f8a0fzJaFRFCpqdw9H17mjL","DrMonkey_AnimationAssets",void 0);var Xn,Zn,Qn,$n,ei,ti,ni,ii,oi,ri,ai,si,li,ci,ui,hi,pi,di,mi,fi,gi,yi,Si,vi=u.ccclass,Ti=u.property,Ei=function(e){return e.IDLE="idle",e.THINKING="thinking",e.TALKING="talking",e.LOOKING_UP="looking_up",e.LOOKING_DOWN="looking_down",e.LAUGHING="laughing",e}({}),_i=(Dn=vi("DrMonkeyAnimationAssetMapping"),Mn=Ti({type:b(Ei),tooltip:"Animation type from MonkeyAnimationType"}),Ln=Ti({type:x,tooltip:"Asset for this animation type"}),Dn((Hn=e((kn=function(){n(this,"type",Hn,this),n(this,"asset",Fn,this),this.callback=null}).prototype,"type",[Mn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ei.IDLE}}),Fn=e(kn.prototype,"asset",[Ln],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Gn=kn))||Gn);zn=vi("DrMonkeyAnimationAssets"),Un=Ti({type:[_i],tooltip:"List of animation assets mapped to animation types"}),zn(((Vn=function(e){function o(){for(var t,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,n(t,"animationMappings",Jn,i(t)),t._animationAssetMap=new Map,t._animationCallbackMap=new Map,t._currentVideo=null,t}t(o,e);var a=o.prototype;return a.onLoad=function(){o._instance=this,this._updateInternalMap()},a._updateInternalMap=function(){this._animationAssetMap.clear(),this._animationCallbackMap.clear();for(var e,t=l(this.animationMappings);!(e=t()).done;){var n=e.value;n.type&&n.asset&&(this._animationAssetMap.set(n.type,n.asset),n.callback&&this._animationCallbackMap.set(n.type,n.callback))}},a.getAnimationAsset=function(e){return this._animationAssetMap.get(e)||null},a.setAnimationAsset=function(e,t,n){this._animationAssetMap.set(e,t),n&&this._animationCallbackMap.set(e,n);for(var i,o=!1,r=l(this.animationMappings);!(i=r()).done;){var a=i.value;if(a.type===e){a.asset=t,a.callback=n||null,o=!0;break}}if(!o){var s=new _i;s.type=e,s.asset=t,s.callback=n||null,this.animationMappings.push(s)}},a.setAnimationEndedCallback=function(e,t){if(t){this._animationCallbackMap.set(e,t);for(var n,i=l(this.animationMappings);!(n=i()).done;){var o=n.value;if(o.type===e){o.callback=t;break}}}},a.executeCallback=function(e){var t=this._animationCallbackMap.get(e);t&&t()},a.playAnimation=function(e,t){var n=this,i=this.getAnimationAsset(e);i&&t?(this._currentVideo=e,t.setVideoEndedCallback((function(){n._currentVideo===e&&(n.executeCallback(e),n._currentVideo=null)})),t.configureVideoSource(i.nativeUrl),t.playVideo()):console.error("[MonkeyAnimationAssets] Cannot play animation: asset or video player not found for type "+e)},a.hasAnimationAsset=function(e){return this._animationAssetMap.has(e)},a.getAvailableAnimationTypes=function(){return Array.from(this._animationAssetMap.keys())},a.loadAnimationAsset=function(e,t,n,i){var o=this;B.load(t,x,(function(r,a){if(r)return console.error("[MonkeyAnimationAssets] Failed to load asset at path: "+t,r),void(null==n||n(!1));o.setAnimationAsset(e,a,i),null==n||n(!0)}))},a.loadAnimationAssetFromRemote=function(e,t,n,i){var o=this;M.loadRemote(t,(function(r,a){if(r)return console.error("[MonkeyAnimationAssets] Failed to load remote asset: "+t,r),void(null==n||n(!1));o.setAnimationAsset(e,a,i),null==n||n(!0)}))},a.clearAnimationAssets=function(){this._animationAssetMap.clear(),this._animationCallbackMap.clear(),this.animationMappings=[]},a._loadDefaultAssets=function(){},a.onDestroy=function(){o._instance===this&&(o._instance=null)},r(o,null,[{key:"Instance",get:function(){return this._instance}}]),o}(p))._instance=null,Jn=e((Bn=Vn).prototype,"animationMappings",[Un],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),xn=Bn));c._RF.pop(),c._RF.push({},"289a5GSwBtNjJrWx9nSuRCh","DrMonkey_AudioManager",void 0);var Ci,bi,Ai,Ri,Ni,wi,Ii,Oi=u.ccclass,Pi=u.property,Di=(Xn=Oi("DrMonkeyAudioClipData"),Zn=Pi({type:J}),Qn=Pi({type:V}),$n=Pi({type:T}),ei=Pi({type:T}),ti=Pi({type:m}),Xn((oi=e((ii=function(){function e(){n(this,"name",oi,this),n(this,"audioClips",ri,this),n(this,"delayBetweenClips",ai,this),n(this,"volume",si,this),n(this,"loop",li,this),this.isLoopPlaying=void 0,this.lastPlayedTime=0,this.clipIndex=0}var t=e.prototype;return t.GetClip=function(){var e=this.audioClips[this.clipIndex];if(this.clipIndex=(this.clipIndex+1)%this.audioClips.length,this.CanPlay())return this.lastPlayedTime=Date.now(),e},t.CanPlay=function(){return Date.now()-this.lastPlayedTime>1e3*this.delayBetweenClips},e}()).prototype,"name",[Zn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ri=e(ii.prototype,"audioClips",[Qn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ai=e(ii.prototype,"delayBetweenClips",[$n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),si=e(ii.prototype,"volume",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),li=e(ii.prototype,"loop",[ti],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ni=ii))||ni),Mi=(ci=Oi("DrMonkeyAudioManager"),ui=Pi({type:Di}),hi=Pi({type:W}),pi=Pi({type:k}),ci(((Si=function(e){function o(){for(var t,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,n(t,"audioClipData",fi,i(t)),n(t,"backgroundAudioSource",gi,i(t)),t.localStorageAudioEnabledKey="PBCRAudioEnabled",n(t,"audioSourcePrefab",yi,i(t)),t.audioSources=[],t._isAudioEnabled="true",t}t(o,e);var a=o.prototype;return a.onLoad=function(){o.instance=this,this.ReadAudioEnabledFromLocalStorage()},a.start=function(){this.SetAudioEnabled(this.IsAudioEnabled)},a.playSound=function(e){if("false"!=this.IsAudioEnabled){var t=this.audioClipData.find((function(t){return t.name==e}));if(null!=t){var n=t.GetClip();if(n){if(t.isLoopPlaying)return;var i=this.getEmptyAudioSource();i.loop=t.loop,t.isLoopPlaying=t.loop,i.volume=t.volume,i.clip=n,t.loop?i.play():i.playOneShot(n)}else console.warn("Audio Clip is in use ",e)}}},a.stopSound=function(e){var t=this.audioClipData.find((function(t){return t.name==e}));t?this.audioSources.forEach((function(e){e.clip==t.audioClips[t.clipIndex]&&(t.isLoopPlaying=!1,e.stop())})):console.warn("Audio Clip not found for ",e)},a.stopAllSounds=function(){this.audioSources.forEach((function(e){e.stop()})),this.audioClipData.forEach((function(e){e.isLoopPlaying=!1}))},a.ToggleAudio=function(){"true"==this.IsAudioEnabled?this.SetAudioEnabled("false"):this.SetAudioEnabled("true")},a.SetAudioEnabled=function(e){this._isAudioEnabled=e,this.UpdateBackgroundMusic(),this.WriteAudioEnabledToLocalStorage()},a.WriteAudioEnabledToLocalStorage=function(){h.localStorage.setItem(this.localStorageAudioEnabledKey,this.IsAudioEnabled)},a.ReadAudioEnabledFromLocalStorage=function(){var e=h.localStorage.getItem(this.localStorageAudioEnabledKey);this._isAudioEnabled=null==e?"true":e},a.UpdateBackgroundMusic=function(){var e,t;"true"==this.IsAudioEnabled?null==(e=this.backgroundAudioSource)||e.play():null==(t=this.backgroundAudioSource)||t.stop()},a.printAllPlayingAudioSources=function(){this.audioSources.forEach((function(e){e.playing&&console.log("Playing audio source: ",e.playing,e.clip.name,e.uuid)}))},a.getEmptyAudioSource=function(){var e=this.audioSources.find((function(e){return!e.playing}));return null==e&&(e=this.createAudioSource()),e},a.createAudioSource=function(){var e=z(this.audioSourcePrefab).getComponent(W);return e.node.setParent(this.node),this.audioSources.push(e),console.log("==== Created new audio source: ",this.audioSources.length),e},a.onDestroy=function(){o.instance===this&&(o.instance=null)},r(o,[{key:"IsAudioEnabled",get:function(){return this._isAudioEnabled}}]),o}(p)).instance=null,fi=e((mi=Si).prototype,"audioClipData",[ui],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),gi=e(mi.prototype,"backgroundAudioSource",[hi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),yi=e(mi.prototype,"audioSourcePrefab",[pi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),di=mi))||di);c._RF.pop(),c._RF.push({},"65f32S5T7dHOJazpSKjLZDq","DrMonkey_LocalVideo",void 0);var Li,Gi,ki=u.ccclass,Hi=u.property;Ci=ki("DrMonkeyLocalVideo"),bi=Hi({type:K}),Ai=Hi({type:x}),Ci((wi=e((Ni=function(e){function o(){for(var t,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,n(t,"videoPlayer",wi,i(t)),n(t,"asset",Ii,i(t)),t.onVideoEndedCallback=null,t}t(o,e);var r=o.prototype;return r.start=function(){this.asset&&this.configureVideoSource(this.asset.nativeUrl)},r.onEnable=function(){this.setupEventListeners()},r.onDisable=function(){this.removeEventListeners(),this.onVideoEndedCallback=null},r.onDestroy=function(){this.removeEventListeners(),this.onVideoEndedCallback=null},r.setupEventListeners=function(){this.videoPlayer&&this.videoPlayer.node.on(K.EventType.COMPLETED,this.onVideoEnded,this)},r.removeEventListeners=function(){this.videoPlayer&&this.videoPlayer.node&&this.videoPlayer.node.off(K.EventType.COMPLETED,this.onVideoEnded,this)},r.setVideoPlayerLoop=function(e){this.videoPlayer&&(this.videoPlayer.loop=e)},r.onVideoEnded=function(){this.onVideoEndedCallback&&this.onVideoEndedCallback()},r.setVideoEndedCallback=function(e){this.onVideoEndedCallback=e},r.configureVideoSource=function(e){this.videoPlayer&&(this.stopVideo(),this.videoPlayer.remoteURL=e)},r.playVideo=function(){this.videoPlayer&&this.videoPlayer.play()},r.stopVideo=function(){this.videoPlayer&&this.videoPlayer.stop()},r.pauseVideo=function(){this.videoPlayer&&this.videoPlayer.pause()},r.resumeVideo=function(){this.videoPlayer&&this.videoPlayer.play()},r.isPlaying=function(){return!!this.videoPlayer&&this.videoPlayer.isPlaying},o}(p)).prototype,"videoPlayer",[bi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ii=e(Ni.prototype,"asset",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ri=Ni));c._RF.pop(),c._RF.push({},"753e07j7plHYY5hxI80wsa3","DrMonkey_GameManager",void 0);var Fi,zi,Ui,xi,Bi,Ji,Vi,Wi=u.ccclass,Ki=u.executionOrder,Yi=new d,ji=Wi("DrMonkeyGameManager")(Li=Ki(-2)(((Gi=function(e){function n(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))||this)._roomStatus=Ut.NONE,t._won=!1,t._handledGameOverCallbacks=!1,t._serverStateCopy=null,t.miloGameSDK=new ee,t._gameStartTime=0,t}t(n,e);var i=n.prototype;return i.onLoad=function(){n._instance&&this.node.destroy(),n._instance=this,this.initializeMiloGameSDK(),this.registerEvents()},i.onDestroy=function(){this.unregisterEvents(),n._instance===this&&(n._instance=null)},i.registerEvents=function(){Xe.on(Ee.CONNECTION_STATE_CHANGE,this.onConnectionStateChange,this),Ze.on(Ee.SERVER_ROOM_STATE_CHANGE,this.onServerRoomStateChange,this)},i.unregisterEvents=function(){Xe.off(Ee.CONNECTION_STATE_CHANGE,this.onConnectionStateChange,this),Ze.off(Ee.SERVER_ROOM_STATE_CHANGE,this.onServerRoomStateChange,this)},i.onConnectionStateChange=function(e,t){switch(t){case _e.DISCONNECTED:this._roomStatus!==Ut.END_GAME&&$e.Instance.reconnect();break;case _e.KICKED_OUT:}},i.onServerRoomStateChange=function(e){this.log("ServerRoomStateChange Message: "+e.currentRoomStatus),this.log(!this._serverStateCopy),this._serverStateCopy||(this._serverStateCopy=new on,this._serverStateCopy.copyFrom(e)),e.currentRoomStatus===Ut.END_GAME&&(console.log("Game Over"),this.handleWon(e)),this.log("Setting room status to: ",e.currentRoomStatus),this.setRoomStatus(e.currentRoomStatus)},i.resetServerState=function(e){this._serverStateCopy||(this._serverStateCopy=new on),this._serverStateCopy.copyFrom(e)},i.handleWon=function(e){},i.setRoomStatus=function(e){if(this._roomStatus!==e){console.log("[GameManager] ==== Room Status Change ==== :",e);var t=this._roomStatus;this._roomStatus=e,this.OnRemoteGameStateChange(e),console.log("[GameManager] Emitting room status change event"),Yi.emit(Ee.ROOM_STATUS_CHANGE,t,e)}},i.GetMyPlayerData=function(){var e,t=$e.Instance.CurrentRoom.sessionId;return null==(e=this._serverStateCopy)?void 0:e.playersData.find((function(e){return e.sessionId===t}))},i.GetWinnerPlayerData=function(){return null},i.OnRemoteGameStateChange=function(e){switch(console.log("RemoteGameStateChange Message: "+e),e){case Ut.NONE:case Ut.WAITING_FOR_PLAYERS:Mi.instance.playSound("Bgm");break;case Ut.COUNTDOWN:break;case Ut.GAME_SIMULATION:this._gameStartTime=Date.now();var t={timestamp:this._gameStartTime};this.miloGameSDK.gameStarted(t),console.log("[GameManager] Game started event sent to MiloGameSDK");break;case Ut.END_GAME:var n=Date.now()-this._gameStartTime,i={duration:n,hasWinningScreen:!1};this.miloGameSDK.gameEnded(i),console.log("[GameManager] Game ended event sent to MiloGameSDK with duration:",n),this.HandleGameOverCallbacks();break;default:console.warn("Unhandled room status: "+e)}},i.HandleGameOverCallbacks=function(){this._handledGameOverCallbacks?console.log("Already handled game over callbacks"):this._handledGameOverCallbacks=!0},i.initializeMiloGameSDK=function(){this.miloGameSDK.init({gameId:"dr-monkey",debug:!0});var e={timestamp:Date.now()};this.miloGameSDK.gameLoaded(e),console.log("[GameManager] Game loaded event sent to MiloGameSDK")},r(n,null,[{key:"Instance",get:function(){return this._instance}}]),n}(p))._instance=null,Li=Gi))||Li)||Li;c._RF.pop(),c._RF.push({},"0ef79D3HT1Jq6fktUxy9N4k","DrMonkey_Menu",void 0);var qi,Xi,Zi,Qi,$i,eo,to,no,io,oo,ro=u.ccclass,ao=u.property,so=(Fi=ro("DrMonkeyMenu"),zi=ao({type:R}),Ui=ao({type:J}),Fi((Ji=e((Bi=function(e){function o(){for(var t,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,n(t,"content",Ji,i(t)),n(t,"menuName",Vi,i(t)),t.isOpened=!1,t}t(o,e);var r=o.prototype;return r.onLoad=function(){null==this.content&&(this.content=this.node.getChildByName("Content"))},r.Open=function(){this.content.active=!0,this.isOpened=!0},r.Close=function(){this.content.active=!1,this.isOpened=!1},r.initialize=function(){ye.info("Menu initialize called")},o}(p)).prototype,"content",[zi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Vi=e(Bi.prototype,"menuName",[Ui],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xi=Bi))||xi);c._RF.pop(),c._RF.push({},"d0730UuwPBGhqdkqs1njq/g","DrMonkey_UIManager",void 0);var lo,co,uo,ho,po,mo,fo,go,yo,So,vo,To,Eo,_o,Co,bo,Ao,Ro,No,wo,Io,Oo,Po,Do,Mo,Lo,Go,ko,Ho,Fo,zo,Uo,xo,Bo,Jo,Vo=u.ccclass,Wo=u.property,Ko=(qi=Vo("DrMonkeyUIManager"),Xi=Wo({type:g}),Zi=Wo({type:[so]}),Qi=Wo({type:R}),qi(((oo=function(e){function o(){for(var t,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,n(t,"uiCamera",to,i(t)),n(t,"menus",no,i(t)),n(t,"flashNode",io,i(t)),t.showMuteButton=!0,t.showResultScreen=!0,t.showFAQ=!0,t}t(o,e);var r=o.prototype;return r.onLoad=function(){o.instance=this,Xe.on(Ee.CONNECTION_STATE_CHANGE,this.onConnectionStateChange,this),Yi.on(Ee.ROOM_STATUS_CHANGE,this.onRoomStatusChange,this),Qe.on(Ee.SERVER_MESSAGE,this.onServerMessage,this),jn.on(Ee.GAME_STATE_CHANGE,this.onGameStateChange,this)},r.onDestroy=function(){Xe.off(Ee.CONNECTION_STATE_CHANGE,this.onConnectionStateChange,this),Yi.off(Ee.ROOM_STATUS_CHANGE,this.onRoomStatusChange,this),Qe.off(Ee.SERVER_MESSAGE,this.onServerMessage,this),jn.off(Ee.GAME_STATE_CHANGE,this.onGameStateChange,this)},r.start=function(){},r.onCameraOrthoSizeChange=function(e){console.log("[UIManager] Camera ortho size changed: ",e),this.uiCamera.orthoHeight=e},r.OpenHowToPlay=function(){this.OpenMenu("HowToPlay")},r.OpenMenu=function(e){for(var t=0;t<this.menus.length;t++)this.menus[t].menuName==e&&this.menus[t].Open()},r.CloseMenu=function(e){for(var t=0;t<this.menus.length;t++)this.menus[t].menuName==e&&this.menus[t].Close()},r.GetMenu=function(e){for(var t=0;t<this.menus.length;t++)if(this.menus[t].menuName==e)return this.menus[t];return null},r.CloseAllMenus=function(){for(var e=0;e<this.menus.length;e++)this.menus[e].Close()},r.onConnectionStateChange=function(e,t){switch(console.log("[UIManager] Connection state changed: ",t),t){case _e.CONNECTING:this.CloseAllMenus(),this.OpenMenu("InGameMenu")}},r.onGameStateChange=function(e){switch(e){case Qt.START_ROUND:this.handleStartRoundState();break;case Qt.DEATH_SCENARIO:this.handleDeathScenarioState();break;case Qt.SHOW_SCENARIO:console.log("[UIManager] Showing scenario state"),this.handleShowScenarioState();break;case Qt.PLAYER_ANSWERING:this.handlePlayerAnswerState();break;case Qt.AI_JUDGEMENT:this.handleAiJudgementState();break;case Qt.ROUND_RESULTS:this.handleRoundResultsState();break;case Qt.GAME_OVER:this.handleGameOverState()}},r.handleStartRoundState=function(){console.log("[UIManager] Handling start round state"),this.CloseAllMenus(),this.OpenMenu("StartRoundScreen")},r.handleDeathScenarioState=function(){console.log("[UIManager] Handling death scenario state"),this.CloseAllMenus(),this.OpenMenu("DeathScenarioScreen")},r.handleShowScenarioState=function(){console.log("[UIManager] Handling show scenario state"),this.CloseAllMenus(),this.OpenMenu("ShowScenarioScreen")},r.handlePlayerAnswerState=function(){console.log("[UIManager] Handling player answer state"),this.CloseMenu("ShowScenarioScreen"),this.OpenMenu("PlayerAnswerScreen")},r.handleAiJudgementState=function(){console.log("[UIManager] Handling ai judgement state"),this.CloseMenu("PlayerAnswerScreen"),this.OpenMenu("AiJudgementScreen")},r.handleRoundResultsState=function(){console.log("[UIManager] Handling round results state"),this.CloseAllMenus(),this.OpenMenu("ResultsScreen")},r.handleGameOverState=function(){console.log("[UIManager] Handling game over state"),this.CloseAllMenus(),this.OpenMenu("GameOverScreen")},r.onServerMessage=function(e,t){switch(e){case mn.AI_JUDGEMENT:var n=this.GetMenu("AiJudgementScreen"),i="object"==typeof t?t:JSON.parse(t);n.setAiJudgement(i);break;case mn.FATE_HAS_BEEN_SEALED:this.GetMenu("AiJudgementScreen").setFateSealed();break;case mn.SCENARIO_UPDATE:this.GetMenu("DeathScenarioScreen").updateScenarioLabel()}},r.onRoomStatusChange=function(e,t){var n=this;switch(console.log("[UIManager] Room status changed: ",t),t){case Ut.WAITING_FOR_PLAYERS:console.log("Opening waiting screen"),this.OpenMenu("WaitingScreen");break;case Ut.COUNTDOWN:console.log("Opening countdown screen"),this.CloseAllMenus(),this.OpenMenu("CountDownScreen");break;case Ut.GAME_SIMULATION:this.scheduleOnce((function(){n.CloseMenu("CountdownScreen"),n.OpenMenu("InGameMenu")}),1);break;case Ut.END_GAME:console.log("[UIManager] End Game State handling in UI Manager"),this.CloseAllMenus(),console.log("[UIManager] Opening end game menu"),this.OpenMenu("EndGameMenu");break;default:console.warn("[UIManager] Unhandled RoomStatus: "+t)}},r.playFlashEffect=function(e){var t=this;void 0===e&&(e=new O(197,8,8)),this.flashNode.active=!0;var n=this.flashNode.getComponent(I);n?(n.color=new O(e.r,e.g,e.b,0),P(n).to(.2,{color:new O(e.r,e.g,e.b,255)}).delay(.05).to(.3,{color:new O(e.r,e.g,e.b,0)}).call((function(){t.flashNode.active=!1})).start()):console.error("No Sprite component found on flashNode")},o}(p)).instance=null,to=e((eo=oo).prototype,"uiCamera",[Xi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),no=e(eo.prototype,"menus",[Zi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),io=e(eo.prototype,"flashNode",[Qi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$i=eo))||$i);c._RF.pop(),c._RF.push({},"a04e5zgMo5B6rK/mWqFA7xY","DrMonkey_AiJudgementScreen",void 0);var Yo,jo,qo,Xo,Zo,Qo,$o,er,tr,nr,ir=u.ccclass,or=u.property,rr=function(e){return e.JUDGING="judging",e.TALKING_UP="talking_up",e.TALKING_DOWN="talking_down",e.USER_NOT_SURVIVED="user_not_survived",e.USER_SURVIVED="user_survived",e}(rr||{});lo=ir("DrMonkeyAiJudgementScreen"),co=or({type:R}),uo=or({type:w}),ho=or({type:R}),po=or({type:w}),mo=or({type:w}),fo=or({type:R}),go=or({type:w}),yo=or({type:w}),So=or({type:w}),vo=or({type:I}),To=or({type:G}),Eo=or({type:G}),_o=or({type:R}),Co=or({type:R}),bo=or({type:R}),Ao=or({type:R}),lo((wo=e((No=function(e){function o(){for(var t,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return(t=e.call.apply(e,[this].concat(r))||this).TRANSITION_DELAY_SEC=6,t.DOTS_ANIMATION_INTERVAL=.5,n(t,"loadingParent",wo,i(t)),n(t,"judgingMessageLabel",Io,i(t)),n(t,"playerAnswerParent",Oo,i(t)),n(t,"playerAnswerTriesTooLabel",Po,i(t)),n(t,"playerAnswerLabel",Do,i(t)),n(t,"aiJudgementParent",Mo,i(t)),n(t,"aiAnswerTriesTooLabel",Lo,i(t)),n(t,"aiJudgementLabel",Go,i(t)),n(t,"aiSurvivedOrNotLabel",ko,i(t)),n(t,"aiSurvivedOrNotSprite",Ho,i(t)),n(t,"aiSurvivedSpriteFrame",Fo,i(t)),n(t,"aiDidNotSurviveSpriteFrame",zo,i(t)),t.drChaosAnimation=null,n(t,"drChaosNode",Uo,i(t)),n(t,"drChaosPlayerAnswerStateParentNode",xo,i(t)),n(t,"drChaosAiJudgementStateParentNode",Bo,i(t)),n(t,"drChaosLoadingStateParentNode",Jo,i(t)),t.currentPlayerData=null,t.currentPlayerName="",t.currentPlayerAnswer="",t.currentAiJudgement="",t.currentAiSurvivedOrNot=!1,t.judgementReadTime=0,t.activeTypeEffectCallbacks=new Map,t}t(o,e);var r=o.prototype;return r.Open=function(){e.prototype.Open.call(this),this.resetUIElements(),this.loadingParent.active=!0,this.startJudgingDotsAnimation()},r.Close=function(){e.prototype.Close.call(this),this.resetUIElements()},r.onLoad=function(){this.drChaosAnimation=this.drChaosNode.getComponent(Y)},r.onDestroy=function(){this.clearPreviousAnimations(),this.currentPlayerData=null,this.currentPlayerName="",this.currentPlayerAnswer="",this.currentAiJudgement="",this.judgementReadTime=0,this.activeTypeEffectCallbacks.clear(),e.prototype.onDestroy&&e.prototype.onDestroy.call(this)},r.setAiJudgement=function(e){this.clearPreviousAnimations(),this.storeJudgementData(e),this.showPlayerAnswer(),this.scheduleAiJudgementTransition()},r.setFateSealed=function(){this.clearPreviousAnimations(),this.loadingParent.active=!0,this.judgingMessageLabel.string="YOUR FATE\nHAS BEEN\nSEALED",this.drChaosNode.setParent(this.drChaosLoadingStateParentNode),this.drChaosAnimation.play(rr.TALKING_UP)},r.startJudgingDotsAnimation=function(){var e=this;if(this.judgingMessageLabel&&this.loadingParent.active){this.judgingMessageLabel.string="JUDGING";var t=0,n="judgingDotsAnimation",i=function(){if(!e.loadingParent.active)return e.unschedule(o),void e.activeTypeEffectCallbacks.delete(n);var i=".".repeat(t=t%3+1);e.judgingMessageLabel.string="JUDGING"+i},o=function(){return i()};this.activeTypeEffectCallbacks.has(n)&&this.unschedule(this.activeTypeEffectCallbacks.get(n)),this.activeTypeEffectCallbacks.set(n,o),this.schedule(o,this.DOTS_ANIMATION_INTERVAL),this.drChaosNode.setParent(this.drChaosLoadingStateParentNode),this.drChaosAnimation.play(rr.JUDGING)}},r.clearPreviousAnimations=function(){this.unscheduleAllCallbacks(),this.cancelAllTypeEffects(),this.clearVideoCallbacks()},r.cancelAllTypeEffects=function(){var e=this;this.activeTypeEffectCallbacks.forEach((function(t,n){e.unschedule(t)})),this.activeTypeEffectCallbacks.clear()},r.clearVideoCallbacks=function(){},r.resetUIElements=function(){this.loadingParent.active=!1,this.playerAnswerParent.active=!1,this.aiJudgementParent.active=!1,this.judgingMessageLabel&&(this.judgingMessageLabel.string=""),this.playerAnswerLabel&&(this.playerAnswerLabel.string=""),this.playerAnswerTriesTooLabel&&(this.playerAnswerTriesTooLabel.string=""),this.aiJudgementLabel&&(this.aiJudgementLabel.string=""),this.aiAnswerTriesTooLabel&&(this.aiAnswerTriesTooLabel.string=""),this.aiSurvivedOrNotLabel&&(this.aiSurvivedOrNotLabel.string=""),this.aiSurvivedOrNotSprite&&(this.aiSurvivedOrNotSprite.spriteFrame=null)},r.storeJudgementData=function(e){this.currentPlayerData=qn.Instance.getRoomState().getPlayerBySessionId(e.playerSessionId),this.currentPlayerName=Ht.truncateName(e.playerName,10),this.currentPlayerAnswer=this.currentPlayerData.currentAnswer,this.currentAiJudgement=this.currentPlayerData.aiJudgement,this.currentAiSurvivedOrNot=e.survived,this.judgementReadTime=e.judgementReadTime},r.showPlayerAnswer=function(){this.clearVideoCallbacks(),this.loadingParent.active=!1,this.aiJudgementParent.active=!1,this.playerAnswerParent.active=!0,this.playerAnswerTriesTooLabel.string=Ht.truncateName(this.currentPlayerName,10)+" tries too:";var e=qn.Instance.getRoomState().roomSettings.timePerChar;this.applyTypeEffect(this.playerAnswerLabel,this.currentPlayerAnswer,e),this.drChaosNode.setParent(this.drChaosPlayerAnswerStateParentNode),this.drChaosAnimation.play(rr.TALKING_DOWN)},r.scheduleAiJudgementTransition=function(){var e=qn.Instance.getRoomState().roomSettings.timePerChar,t=this.calculateReadTime(this.currentPlayerAnswer,e);this.scheduleOnce(this.showAiJudgement.bind(this),this.TRANSITION_DELAY_SEC+t)},r.showAiJudgement=function(){var e=this;this.clearVideoCallbacks(),this.loadingParent.active=!1,this.playerAnswerParent.active=!1,this.aiJudgementParent.active=!0,this.aiAnswerTriesTooLabel.string=Ht.truncateName(this.currentPlayerName)+" tries to..:";var t=qn.Instance.getRoomState().roomSettings.timePerChar;this.aiSurvivedOrNotLabel.color=new O(255,255,255,0),this.drChaosNode.setParent(this.drChaosAiJudgementStateParentNode),this.drChaosAnimation.play(rr.TALKING_UP),this.applyTypeEffect(this.aiJudgementLabel,this.currentAiJudgement,t,(function(){e.aiSurvivedOrNotLabel.string=e.currentAiSurvivedOrNot?"Survived":"Did Not Survive",e.aiSurvivedOrNotSprite&&(e.aiSurvivedOrNotSprite.spriteFrame=e.currentAiSurvivedOrNot?e.aiSurvivedSpriteFrame:e.aiDidNotSurviveSpriteFrame),e.aiSurvivedOrNotLabel.color=new O(255,255,255,0);var t=e.currentAiSurvivedOrNot?new O(0,255,0,255):new O(255,0,0,255),n=e.aiSurvivedOrNotLabel.node.scale.clone();e.aiSurvivedOrNotLabel.node.setScale(new N(2.5*n.x,2.5*n.y,n.z));var i=e.aiSurvivedOrNotLabel.node.position.clone();if(e.aiSurvivedOrNotLabel.node.setPosition(i.x,i.y+50,i.z),!e.currentAiSurvivedOrNot&&e.aiJudgementParent.active){console.log("=== Playing laughing video ===");var o=e.currentAiSurvivedOrNot?rr.USER_SURVIVED:rr.USER_NOT_SURVIVED;e.drChaosNode.setParent(e.drChaosAiJudgementStateParentNode),e.drChaosAnimation.play(o),Mi.instance.playSound("Death"),Ko.instance.playFlashEffect()}else e.currentAiSurvivedOrNot&&(Mi.instance.playSound("Survived"),Ko.instance.playFlashEffect(new O(15,156,4)));e.scheduleOnce((function(){if(e.aiJudgementParent.active){P(e.aiSurvivedOrNotLabel.node).set({angle:10}).to(.15,{position:i,scale:n,angle:-2},{easing:"quartIn"}).to(.1,{scale:new N(1.1*n.x,1.1*n.y,n.z),angle:0},{easing:"bounceOut"}).to(.2,{scale:n},{easing:"elasticOut"}).start(),P(e.aiSurvivedOrNotLabel).to(.05,{color:new O(t.r,t.g,t.b,0)}).to(.1,{color:t}).start();var o=e.aiJudgementParent;if(o){var r=o.position.clone();P(o).to(.02,{position:new N(r.x+5,r.y,r.z)}).to(.02,{position:new N(r.x-5,r.y,r.z)}).to(.02,{position:new N(r.x,r.y,r.z)}).start()}}}),.5)}))},r.applyTypeEffect=function(e,t,n,i){var o=this;if(void 0===n&&(n=.1),Mi.instance.playSound("MonkeyTalking"),e.string="",t){var r=0,a=t.length,s=e.uuid+"_typeEffect";this.activeTypeEffectCallbacks.has(s)&&(this.unschedule(this.activeTypeEffectCallbacks.get(s)),this.activeTypeEffectCallbacks.delete(s));var l=!0;this.activeTypeEffectCallbacks.set(s,(function(){l=!1})),function c(){var u=e.node.parent;if(!u||!u.active||!e.isValid)return l=!1,void o.activeTypeEffectCallbacks.delete(s);r<a?(e.string=t.substring(0,r+1),r++,l&&o.scheduleOnce((function(){return c()}),n)):(l=!1,o.activeTypeEffectCallbacks.delete(s),i&&u.active&&e.isValid&&(Mi.instance.stopSound("MonkeyTalking"),i()))}()}else i&&i()},r.calculateReadTime=function(e,t){if(void 0===t&&(t=.05),!e)return 0;var n=e.replace(/\s+/g,"").length;return Math.max(1,n*t)},o}(so)).prototype,"loadingParent",[co],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Io=e(No.prototype,"judgingMessageLabel",[uo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Oo=e(No.prototype,"playerAnswerParent",[ho],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Po=e(No.prototype,"playerAnswerTriesTooLabel",[po],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Do=e(No.prototype,"playerAnswerLabel",[mo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Mo=e(No.prototype,"aiJudgementParent",[fo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Lo=e(No.prototype,"aiAnswerTriesTooLabel",[go],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Go=e(No.prototype,"aiJudgementLabel",[yo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ko=e(No.prototype,"aiSurvivedOrNotLabel",[So],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ho=e(No.prototype,"aiSurvivedOrNotSprite",[vo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Fo=e(No.prototype,"aiSurvivedSpriteFrame",[To],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),zo=e(No.prototype,"aiDidNotSurviveSpriteFrame",[Eo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Uo=e(No.prototype,"drChaosNode",[_o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xo=e(No.prototype,"drChaosPlayerAnswerStateParentNode",[Co],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Bo=e(No.prototype,"drChaosAiJudgementStateParentNode",[bo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Jo=e(No.prototype,"drChaosLoadingStateParentNode",[Ao],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ro=No));c._RF.pop(),c._RF.push({},"4fcd26hgZdFNq155872CM5b","DrMonkey_CountDownScreen",void 0);var ar,sr,lr,cr,ur,hr,pr,dr,mr,fr,gr,yr,Sr,vr,Tr,Er=u.ccclass,_r=u.property;Yo=Er("DrMonkeyCountdownScreen"),jo=_r({type:w}),Yo((Zo=e((Xo=function(e){function o(){for(var t,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,n(t,"countdownText",Zo,i(t)),n(t,"useColorTransition",Qo,i(t)),n(t,"initialScale",$o,i(t)),n(t,"finalScale",er,i(t)),n(t,"animationDuration",tr,i(t)),n(t,"showGoMessage",nr,i(t)),t._countdownTween=null,t._uiOpacity=null,t._countColors=[new O(255,0,0,255),new O(255,165,0,255),new O(0,255,0,255)],t}t(o,e);var r=o.prototype;return r.onLoad=function(){e.prototype.onLoad.call(this),this._initUIOpacity()},r._initUIOpacity=function(){this._uiOpacity=this.countdownText.node.getComponent(j),this._uiOpacity||(this._uiOpacity=this.countdownText.node.addComponent(j))},r.Open=function(){e.prototype.Open.call(this),this._startCountdown()},r.Close=function(){e.prototype.Close.call(this),this._stopCountdown()},r._stopCountdown=function(){this._countdownTween&&(this._countdownTween.stop(),this._countdownTween=null)},r._startCountdown=function(){var e;this._createCountdownSequence(),null==(e=this._countdownTween)||e.start()},r._createCountdownSequence=function(){var e=this;this.countdownText.node.active=!0,this._countdownTween=P(this.countdownText.node);for(var t=3;t>=1;t--)this._addNumberAnimation(t,3-t);this.showGoMessage&&this._addGoAnimation(),this._countdownTween.call((function(){return e._hideCountdown()}))},r._addNumberAnimation=function(e,t){var n=this,i=1-this.animationDuration-.2;this._countdownTween.call((function(){n._setupTextForAnimation(e.toString(),t)})).to(this.animationDuration,{scale:N.ONE.clone().multiplyScalar(this.finalScale)},{easing:"backOut"}).delay(.1).call((function(){n._fadeTextPartially()})).delay(i)},r._addGoAnimation=function(){var e=this;this._countdownTween.call((function(){e._setupTextForAnimation("GO!",2)})).to(.4,{scale:N.ONE.clone().multiplyScalar(1.2*this.finalScale)},{easing:"bounceOut"}).delay(.3).call((function(){e._fadeTextCompletely()}))},r._setupTextForAnimation=function(e,t){this.countdownText.string=e,this.countdownText.node.scale=N.ONE.clone().multiplyScalar(this.initialScale),this._uiOpacity.opacity=255,this.useColorTransition&&(this.countdownText.color=this._countColors[t])},r._fadeTextPartially=function(){P(this._uiOpacity).to(.1,{opacity:180}).start()},r._fadeTextCompletely=function(){P(this._uiOpacity).to(.3,{opacity:0}).start(),P(this.countdownText.node).to(.3,{scale:N.ONE.clone().multiplyScalar(1.5*this.finalScale)},{easing:"sineOut"}).start()},r._hideCountdown=function(){this.countdownText.string="",this.countdownText.node.active=!1},o}(so)).prototype,"countdownText",[jo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Qo=e(Xo.prototype,"useColorTransition",[_r],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),$o=e(Xo.prototype,"initialScale",[_r],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2.5}}),er=e(Xo.prototype,"finalScale",[_r],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),tr=e(Xo.prototype,"animationDuration",[_r],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.8}}),nr=e(Xo.prototype,"showGoMessage",[_r],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),qo=Xo));c._RF.pop(),c._RF.push({},"bee9e8toI1Dy76M2uZwoUty","DrMonkey_DeathScenarioScreen",void 0);var Cr,br=u.ccclass,Ar=u.property,Rr="[DeathScenarioScreen]";ar=br("DrMonkeyDeathScenarioScreen"),sr=Ar(R),lr=Ar(R),cr=Ar(w),ur=Ar(w),hr=Ar(q),pr=Ar(q),ar((fr=e((mr=function(e){function o(){for(var t,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,n(t,"myTurnRoot",fr,i(t)),n(t,"otherTurnRoot",gr,i(t)),n(t,"whoIsPickingLabel",yr,i(t)),n(t,"scenarioLabel",Sr,i(t)),n(t,"randomizeButton",vr,i(t)),n(t,"continueButton",Tr,i(t)),t}t(o,e);var r=o.prototype;return r.start=function(){this.registerEventListeners()},r.onEnable=function(){this.setupButtonListeners()},r.onDisable=function(){this.removeButtonListeners()},r.displayCurrentDeathScenario=function(){var e=qn.Instance,t=e.getLocalPlayerNumber(),n=e.currentRoomState.isMyTurnInScenarioPicking(t);console.log(Rr+" Local player number: "+t+", Is my turn: "+n),this.updateTurnVisibility(n),this.updateScenarioLabel(),this.updateWhoIsPickingLabel()},r.updateScenarioLabel=function(){this.scenarioLabel.string=qn.Instance.currentRoomState.deathScenario},r.refetchAnotherScenario=function(){console.log(Rr+" Requesting another scenario from server"),$e.Instance.sendMessage(mn.REFETCH_SCENARIO,{}),this.scenarioLabel.string="Getting new scenario..."},r.onContinueScenarioButtonClick=function(){console.log(Rr+" Continuing scenario"),$e.Instance.sendMessage(mn.CONTINUE_SCENARIO,{})},r.registerEventListeners=function(){jn.on(Ee.GAME_STATE_CHANGE,this.onGameStateChange,this)},r.setupButtonListeners=function(){this.randomizeButton&&this.randomizeButton.node.on(q.EventType.CLICK,this.refetchAnotherScenario,this),this.continueButton&&this.continueButton.node.on(q.EventType.CLICK,this.onContinueScenarioButtonClick,this)},r.removeButtonListeners=function(){this.randomizeButton&&this.randomizeButton.node&&this.randomizeButton.node.off(q.EventType.CLICK,this.refetchAnotherScenario,this),this.continueButton&&this.continueButton.node&&this.continueButton.node.off(q.EventType.CLICK,this.onContinueScenarioButtonClick,this)},r.onGameStateChange=function(e){e===Qt.DEATH_SCENARIO&&this.displayCurrentDeathScenario()},r.updateTurnVisibility=function(e){this.myTurnRoot.active=e,this.otherTurnRoot.active=!e},r.updateWhoIsPickingLabel=function(){var e=qn.Instance,t=e.currentRoomState.currentScenarioPickingPlayerNumber,n=e.currentRoomState.getPlayerByIndex(t);console.log(Rr+" Current picking player number: "+t),console.log(Rr+" Current picking player data:",n),this.whoIsPickingLabel.string=Ht.truncateName(n.name,50)+" is picking a scenario"},o}(so)).prototype,"myTurnRoot",[sr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),gr=e(mr.prototype,"otherTurnRoot",[lr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),yr=e(mr.prototype,"whoIsPickingLabel",[cr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Sr=e(mr.prototype,"scenarioLabel",[ur],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),vr=e(mr.prototype,"randomizeButton",[hr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Tr=e(mr.prototype,"continueButton",[pr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),dr=mr));c._RF.pop(),c._RF.push({},"d2dbbE0MKhJuJr/I0vX7bw8","DrMonkey_GameOverScreen",void 0);var Nr,wr,Ir,Or,Pr,Dr,Mr,Lr,Gr,kr,Hr,Fr,zr,Ur,xr,Br=u.ccclass;u.property,Br("DrMonkeyGameOverScreen")(Cr=function(e){function n(){return e.apply(this,arguments)||this}t(n,e);var i=n.prototype;return i.Open=function(){e.prototype.Open.call(this)},i.Close=function(){e.prototype.Close.call(this)},n}(so));c._RF.pop(),c._RF.push({},"cdb0d4bw4dPKYUqwsmTyp/j","DrMonkey_PlayerAnswerScreen",void 0);var Jr,Vr,Wr,Kr,Yr,jr,qr,Xr,Zr,Qr,$r,ea,ta,na,ia,oa=u.ccclass,ra=u.property;Nr=oa("DrMonkeyPlayerAnswerScreen"),wr=ra({type:w}),Ir=ra({type:w}),Or=ra({type:X}),Pr=ra({type:q}),Dr=ra({type:Zt}),Mr=ra({type:w}),Nr((kr=e((Gr=function(e){function o(){for(var t,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,n(t,"prompt",kr,i(t)),n(t,"waitingForOtherPlayers",Hr,i(t)),n(t,"inputEditBox",Fr,i(t)),n(t,"submitButton",zr,i(t)),t.isSubmitted=!1,n(t,"timer",Ur,i(t)),n(t,"answerCharCount",xr,i(t)),t.totalChars=140,t}t(o,e);var r=o.prototype;return r.onLoad=function(){e.prototype.onLoad.call(this)},r.Open=function(){e.prototype.Open.call(this),this.isSubmitted=!1,this.waitingForOtherPlayers.node.active=!1,this.submitButton.node.active=!0,this.inputEditBox.string="",this.timer.reset(),this.timer.setStartTime(qn.Instance.currentRoomState.roomSettings.answerTimeLimit-3),this.timer.setOnTimerEndCallback(this.onTimerEnd.bind(this)),this.timer.startTimer(),this.updateCharCount(0),ji.Instance.miloGameSDK.vibratePreset("medium")},r.start=function(){jn.on(Ee.GAME_STATE_CHANGE,this.onGameStateChange,this),this.submitButton&&this.submitButton.node.on(q.EventType.CLICK,this.onSubmitButtonClick,this),this.inputEditBox&&this.inputEditBox.node.on(X.EventType.TEXT_CHANGED,this.onTextChanged,this)},r.onDestroy=function(){jn.off(Ee.GAME_STATE_CHANGE,this.onGameStateChange,this),this.submitButton&&this.submitButton.node&&this.submitButton.node.off(q.EventType.CLICK,this.onSubmitButtonClick,this),this.inputEditBox&&this.inputEditBox.node&&this.inputEditBox.node.off(X.EventType.TEXT_CHANGED,this.onTextChanged,this)},r.onGameStateChange=function(e){e===Qt.PLAYER_ANSWERING&&this.displayDeathScenario()},r.displayDeathScenario=function(){var e=qn.Instance.currentRoomState.deathScenario;this.prompt.string=e},r.onSubmitButtonClick=function(){var e=this.inputEditBox.string.trim();""!==e?($e.Instance.sendMessage(mn.PLAYER_ANSWER,e),console.log("[PlayerAnswerScreen] Submitted answer:",e),this.submitButton.node.active=!1,this.waitingForOtherPlayers&&(this.waitingForOtherPlayers.node.active=!0),this.isSubmitted=!0):console.warn("[PlayerAnswerScreen] Cannot submit empty answer")},r.onTimerEnd=function(){if(!this.isSubmitted){var e=this.inputEditBox.string.trim();""!==e?($e.Instance.sendMessage(mn.PLAYER_ANSWER,e),console.log("[PlayerAnswerScreen] Time's up! Auto-submitted answer:",e)):console.warn("[PlayerAnswerScreen] Time's up! No answer to submit."),this.submitButton.node.active=!1,this.waitingForOtherPlayers&&(this.waitingForOtherPlayers.node.active=!0),this.isSubmitted=!0}},r.onTextChanged=function(){var e=this.inputEditBox.string.length;this.updateCharCount(e)},r.updateCharCount=function(e){this.answerCharCount.string=e+"/"+this.totalChars},o}(so)).prototype,"prompt",[wr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Hr=e(Gr.prototype,"waitingForOtherPlayers",[Ir],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Fr=e(Gr.prototype,"inputEditBox",[Or],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),zr=e(Gr.prototype,"submitButton",[Pr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ur=e(Gr.prototype,"timer",[Dr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xr=e(Gr.prototype,"answerCharCount",[Mr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Lr=Gr));c._RF.pop(),c._RF.push({},"0ef4cDl9UhB1ai8zk5eBHc/","DrMonkey_ResultsScreen",void 0);var aa,sa,la,ca,ua,ha,pa,da,ma,fa,ga,ya=u.ccclass,Sa=u.property,va={DEATH_STAMP:{INITIAL_ROTATION:10,IMPACT_ROTATION:10,SCALE_IMPACT:1.1,STAMP_DURATION:.25,BOUNCE_DURATION:.1,RESTORE_DURATION:.2,INITIAL_Y_OFFSET:0,INITIAL_SCALE:2.5,DELAY:.5},HEART_BREATHING:{DURATION:1.5,SCALE_MIN:.95,SCALE_MAX:1.05,EASING:Z.sineInOut}};Jr=ya("DrMonkeyResultsScreen"),Vr=Sa(R),Wr=Sa(k),Kr=Sa(k),Yr=Sa({type:G}),jr=Sa({type:G}),qr=Sa({type:G}),Jr((Qr=e((Zr=function(e){function o(){for(var t,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,n(t,"playerScoreContainer",Qr,i(t)),n(t,"playerScorePrefab",$r,i(t)),n(t,"heartPrefab",ea,i(t)),n(t,"survivedHeartSpriteFrame",ta,i(t)),n(t,"skullHeartSpriteFrame",na,i(t)),n(t,"greyDotSpriteFrame",ia,i(t)),t.roomState=null,t}t(o,e);var r=o.prototype;return r.Open=function(){e.prototype.Open.call(this),this.setRoomState(qn.Instance.getRoomState()),this.updateResults()},r.Close=function(){this.clearAnimations(),this.clearScores(),e.prototype.Close.call(this)},r.onEnable=function(){},r.updateResults=function(){var e=this;this.roomState&&(console.log("[ResultsScreen] Updating results RoomState:",this.roomState),this.clearScores(),this.roomState.playersData.forEach((function(t){return e.createPlayerScoreCard(t)})))},r.createPlayerScoreCard=function(e){var t=z(this.playerScorePrefab);t.parent=this.playerScoreContainer,this.setPlayerScoreCardName(t,e.name),this.createRoundIndicators(t,e),this.setPlayerScoreCardTotalScore(t,e.roundScores)},r.setPlayerScoreCardName=function(e,t){var n,i=null==(n=e.getChildByName("PlayerName"))?void 0:n.getComponent(w);i&&(i.string=Ht.truncateName(t,10))},r.createRoundIndicators=function(e,t){var n=this,i=e.getChildByName("HeartsContainer");if(i&&this.roomState){t.roundScores.forEach((function(e){n.addRoundIndicator(i,e)}));for(var o=this.roomState.roomSettings.rounds,r=t.roundScores.length;r<o;r++)this.addUpcomingRoundIndicator(i)}},r.addRoundIndicator=function(e,t){var n=z(this.heartPrefab);n.parent=e;var i=n.getComponent(I);if(i){i.spriteFrame=t.survived?this.survivedHeartSpriteFrame:this.skullHeartSpriteFrame;var o=this.isLatestRound(t);t.survived&&o?this.applyBreathingAnimation(n):!t.survived&&o&&this.applyDeathStampAnimation(n)}},r.isLatestRound=function(e){if(!this.roomState)return!1;var t=this.roomState.currentRound;return e.roundNumber===t},r.applyBreathingAnimation=function(e){P(e).to(va.HEART_BREATHING.DURATION/2,{scale:new N(va.HEART_BREATHING.SCALE_MAX,va.HEART_BREATHING.SCALE_MAX,1)},{easing:va.HEART_BREATHING.EASING}).to(va.HEART_BREATHING.DURATION/2,{scale:new N(va.HEART_BREATHING.SCALE_MIN,va.HEART_BREATHING.SCALE_MIN,1)},{easing:va.HEART_BREATHING.EASING}).union().repeatForever().start()},r.applyDeathStampAnimation=function(e){var t=e.scale.clone(),n=e.position.clone();e.angle=va.DEATH_STAMP.INITIAL_ROTATION,e.scale=new N(t.x*va.DEATH_STAMP.INITIAL_SCALE,t.y*va.DEATH_STAMP.INITIAL_SCALE,t.z),e.position=new N(n.x,n.y+va.DEATH_STAMP.INITIAL_Y_OFFSET,n.z);var i=e.parent,o=i?i.position.clone():null,r=e.getComponent(j);r||(r=e.addComponent(j)),r.opacity=255;var a=e.getComponent(I),s=a?a.color.clone():new O(255,0,0,255);a&&(a.color=new O(s.r,s.g,s.b,0)),this.scheduleOnce((function(){P(e).to(va.DEATH_STAMP.STAMP_DURATION,{position:n,scale:t,angle:va.DEATH_STAMP.IMPACT_ROTATION},{easing:"quartIn"}).to(va.DEATH_STAMP.BOUNCE_DURATION,{scale:new N(t.x*va.DEATH_STAMP.SCALE_IMPACT,t.y*va.DEATH_STAMP.SCALE_IMPACT,t.z),angle:va.DEATH_STAMP.IMPACT_ROTATION},{easing:"bounceOut"}).to(va.DEATH_STAMP.RESTORE_DURATION,{scale:t},{easing:"elasticOut"}).start(),a&&P(a).to(va.DEATH_STAMP.STAMP_DURATION-.05,{color:new O(s.r,s.g,s.b,0)}).to(.1,{color:s}).start(),i&&o&&P(i).to(.02,{position:new N(o.x+5,o.y,o.z)}).to(.02,{position:new N(o.x-5,o.y,o.z)}).to(.02,{position:new N(o.x,o.y,o.z)}).start()}),va.DEATH_STAMP.DELAY)},r.addUpcomingRoundIndicator=function(e){var t=z(this.heartPrefab);t.parent=e,t.scale=new N(.5,.5,1);var n=t.getComponent(I);n&&(n.spriteFrame=this.greyDotSpriteFrame)},r.setPlayerScoreCardTotalScore=function(e,t){var n,i=t.reduce((function(e,t){return e+t.score}),0),o=null==(n=e.getChildByName("Score"))?void 0:n.getComponent(Q);if(o){var r=i>0?"#00ff00":"#ff0000";o.string="<color="+r+">"+(i>=0?"+":"")+i+"</color>"}},r.clearScores=function(){this.playerScoreContainer&&this.playerScoreContainer.removeAllChildren()},r.setRoomState=function(e){this.roomState=e},r.initialize=function(){e.prototype.initialize.call(this)},r.clearAnimations=function(){this.playerScoreContainer&&this.playerScoreContainer.children.forEach((function(e){var t=e.getChildByName("HeartsContainer");t&&t.children.forEach((function(e){U.stopAllByTarget(e)}))}))},o}(so)).prototype,"playerScoreContainer",[Vr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$r=e(Zr.prototype,"playerScorePrefab",[Wr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ea=e(Zr.prototype,"heartPrefab",[Kr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ta=e(Zr.prototype,"survivedHeartSpriteFrame",[Yr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),na=e(Zr.prototype,"skullHeartSpriteFrame",[jr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ia=e(Zr.prototype,"greyDotSpriteFrame",[qr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Xr=Zr));c._RF.pop(),c._RF.push({},"d33bdfKAbZI8Jn8aBY7/nlv","DrMonkey_ShowScenarioScreen",void 0);var Ta,Ea,_a,Ca,ba,Aa,Ra,Na=u.ccclass,wa=u.property;aa=Na("DrMonkeyShowScenarioScreen"),sa=wa(w),la=wa(w),ca=wa(R),ua=wa(w),aa((da=e((pa=function(e){function o(){for(var t,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,n(t,"scenarioIncomingLabel",da,i(t)),n(t,"getReadyLabel",ma,i(t)),n(t,"scenarioRoot",fa,i(t)),n(t,"promptLabel",ga,i(t)),t.scenarioRootOpacity=null,t}t(o,e);var r=o.prototype;return r.Open=function(){e.prototype.Open.call(this),this.promptLabel.string=qn.Instance.currentRoomState.deathScenario,this.scenarioIncomingLabel.node.active=!0,this.getReadyLabel.node.active=!0;var t=S.getVisibleSize(),n=-t.height/2-500,i=t.height/2+500;this.scenarioIncomingLabel.node.position=new N(0,n,0),this.getReadyLabel.node.position=new N(0,n,0),this.scenarioRoot.scale=new N(.3,.3,1),this.scenarioRootOpacity=this.scenarioRoot.getComponent(j),this.scenarioRootOpacity||(this.scenarioRootOpacity=this.scenarioRoot.addComponent(j)),this.scenarioRootOpacity.opacity=0,this.animateLabels(n,0,i)},r.animateLabels=function(e,t,n){var i=this;P(this.scenarioIncomingLabel.node).to(.7,{position:new N(0,t,0)},{easing:"cubicOut"}).delay(1.2).to(.7,{position:new N(0,n,0)},{easing:"cubicIn"}).call((function(){P(i.getReadyLabel.node).to(.7,{position:new N(0,t,0)},{easing:"cubicOut"}).delay(1.2).to(.7,{position:new N(0,n,0)},{easing:"cubicIn"}).call((function(){i.scenarioRoot.active=!0,P(i.scenarioRoot).to(.7,{scale:new N(1,1,1)},{easing:"cubicOut"}).start(),P(i.scenarioRootOpacity).to(.7,{opacity:255}).start()})).start()})).start()},r.Close=function(){e.prototype.Close.call(this),this.scenarioRoot.active=!1},o}(so)).prototype,"scenarioIncomingLabel",[sa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ma=e(pa.prototype,"getReadyLabel",[la],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fa=e(pa.prototype,"scenarioRoot",[ca],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ga=e(pa.prototype,"promptLabel",[ua],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ha=pa));c._RF.pop(),c._RF.push({},"f6d85jESStG7J87As22FAQ0","DrMonkey_StartRoundScreen",void 0);var Ia,Oa=u.ccclass,Pa=u.property,Da={POSITION:{DURATION:.8,EASING:Z.cubicOut},OPACITY:{DURATION:.6,EASING:Z.cubicIn,START:0,END:255},OFFSET_FACTOR:.75};Ta=Oa("DrMonkeyStartRoundScreen"),Ea=Pa(R),_a=Pa(w),Ta((Aa=e((ba=function(e){function o(){for(var t,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,n(t,"roundRootNode",Aa,i(t)),n(t,"roundCountLabel",Ra,i(t)),t.originalPosition=new N,t.positionTween=null,t.opacityTween=null,t}t(o,e);var r=o.prototype;return r.onLoad=function(){this.roundRootNode.getComponent(j)||this.roundRootNode.addComponent(j)},r.Open=function(){e.prototype.Open.call(this),this.updateRoundCount(),this.originalPosition=this.roundRootNode.position.clone(),this.animateRoundNode()},r.Close=function(){this.stopAllAnimations(),e.prototype.Close.call(this)},r.updateRoundCount=function(){var e=qn.Instance.getRoomState().currentRound;this.roundCountLabel.string="Scenario "+e},r.stopAllAnimations=function(){this.positionTween&&this.positionTween.stop(),this.opacityTween&&this.opacityTween.stop()},r.animateRoundNode=function(){this.stopAllAnimations();var e=S.getVisibleSize().width+this.roundRootNode.getComponent(f).width*Da.OFFSET_FACTOR;this.roundRootNode.setPosition(e,this.originalPosition.y,this.originalPosition.z);var t=this.roundRootNode.getComponent(j);t.opacity=Da.OPACITY.START,this.positionTween=P(this.roundRootNode).to(Da.POSITION.DURATION,{position:this.originalPosition},{easing:Da.POSITION.EASING}).start(),this.opacityTween=P(t).to(Da.OPACITY.DURATION,{opacity:Da.OPACITY.END},{easing:Da.OPACITY.EASING}).start()},o}(so)).prototype,"roundRootNode",[Ea],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ra=e(ba.prototype,"roundCountLabel",[_a],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ca=ba));c._RF.pop(),c._RF.push({},"ea277B0GwJBwIk71c4YDI3Q","DrMonkey_WaitingScreen",void 0);var Ma=u.ccclass;u.property,Ma("DrMonkeyWaitingScreen")(Ia=function(e){function n(){return e.apply(this,arguments)||this}return t(n,e),n}(so));c._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/dr_monkey', 'chunks:///dr_monkey.js'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});